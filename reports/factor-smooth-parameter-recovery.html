<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Statistical Analysis">
<meta name="dcterms.date" content="2025-11-13">

<title>Parameter Recovery Validation: Factor Smooth GAMs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="factor-smooth-parameter-recovery_files/libs/clipboard/clipboard.min.js"></script>
<script src="factor-smooth-parameter-recovery_files/libs/quarto-html/quarto.js"></script>
<script src="factor-smooth-parameter-recovery_files/libs/quarto-html/popper.min.js"></script>
<script src="factor-smooth-parameter-recovery_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="factor-smooth-parameter-recovery_files/libs/quarto-html/anchor.min.js"></script>
<link href="factor-smooth-parameter-recovery_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="factor-smooth-parameter-recovery_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="factor-smooth-parameter-recovery_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="factor-smooth-parameter-recovery_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="factor-smooth-parameter-recovery_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="factor-smooth-parameter-recovery_files/libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="factor-smooth-parameter-recovery_files/libs/pagedtable-1.1/js/pagedtable.js"></script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
  <li><a href="#why-this-matters" id="toc-why-this-matters" class="nav-link" data-scroll-target="#why-this-matters">Why This Matters</a></li>
  </ul></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#model-specifications" id="toc-model-specifications" class="nav-link" data-scroll-target="#model-specifications">Model Specifications</a></li>
  <li><a href="#test-1-recovery-of-education-specific-seasonal-patterns" id="toc-test-1-recovery-of-education-specific-seasonal-patterns" class="nav-link" data-scroll-target="#test-1-recovery-of-education-specific-seasonal-patterns">Test 1: Recovery of Education-Specific Seasonal Patterns</a>
  <ul class="collapse">
  <li><a href="#simulation-design" id="toc-simulation-design" class="nav-link" data-scroll-target="#simulation-design">Simulation Design</a></li>
  <li><a href="#visualize-generated-data" id="toc-visualize-generated-data" class="nav-link" data-scroll-target="#visualize-generated-data">Visualize Generated Data</a></li>
  <li><a href="#fit-factor-smooth-model" id="toc-fit-factor-smooth-model" class="nav-link" data-scroll-target="#fit-factor-smooth-model">Fit Factor Smooth Model</a></li>
  <li><a href="#extract-and-visualize-seasonal-components" id="toc-extract-and-visualize-seasonal-components" class="nav-link" data-scroll-target="#extract-and-visualize-seasonal-components">Extract and Visualize Seasonal Components</a></li>
  <li><a href="#quantitative-recovery-assessment" id="toc-quantitative-recovery-assessment" class="nav-link" data-scroll-target="#quantitative-recovery-assessment">Quantitative Recovery Assessment</a></li>
  </ul></li>
  <li><a href="#test-2-recovery-of-education-specific-trends" id="toc-test-2-recovery-of-education-specific-trends" class="nav-link" data-scroll-target="#test-2-recovery-of-education-specific-trends">Test 2: Recovery of Education-Specific Trends</a>
  <ul class="collapse">
  <li><a href="#simulation-design-1" id="toc-simulation-design-1" class="nav-link" data-scroll-target="#simulation-design-1">Simulation Design</a></li>
  <li><a href="#visualize-generated-data-1" id="toc-visualize-generated-data-1" class="nav-link" data-scroll-target="#visualize-generated-data-1">Visualize Generated Data</a></li>
  <li><a href="#fit-and-extract-trends" id="toc-fit-and-extract-trends" class="nav-link" data-scroll-target="#fit-and-extract-trends">Fit and Extract Trends</a></li>
  <li><a href="#quantitative-trend-recovery" id="toc-quantitative-trend-recovery" class="nav-link" data-scroll-target="#quantitative-trend-recovery">Quantitative Trend Recovery</a></li>
  </ul></li>
  <li><a href="#test-3-model-selection-identifies-correct-structure" id="toc-test-3-model-selection-identifies-correct-structure" class="nav-link" data-scroll-target="#test-3-model-selection-identifies-correct-structure">Test 3: Model Selection Identifies Correct Structure</a>
  <ul class="collapse">
  <li><a href="#scenario-a-only-seasonal-differences" id="toc-scenario-a-only-seasonal-differences" class="nav-link" data-scroll-target="#scenario-a-only-seasonal-differences">Scenario A: Only Seasonal Differences</a></li>
  <li><a href="#scenario-b-only-trend-differences" id="toc-scenario-b-only-trend-differences" class="nav-link" data-scroll-target="#scenario-b-only-trend-differences">Scenario B: Only Trend Differences</a></li>
  <li><a href="#scenario-c-both-differ" id="toc-scenario-c-both-differ" class="nav-link" data-scroll-target="#scenario-c-both-differ">Scenario C: Both Differ</a></li>
  </ul></li>
  <li><a href="#test-4-trend-difference-inference" id="toc-test-4-trend-difference-inference" class="nav-link" data-scroll-target="#test-4-trend-difference-inference">Test 4: Trend Difference Inference</a>
  <ul class="collapse">
  <li><a href="#simulation-with-known-differences" id="toc-simulation-with-known-differences" class="nav-link" data-scroll-target="#simulation-with-known-differences">Simulation with Known Differences</a></li>
  <li><a href="#visualize-differences" id="toc-visualize-differences" class="nav-link" data-scroll-target="#visualize-differences">Visualize Differences</a></li>
  <li><a href="#coverage-check-for-differences" id="toc-coverage-check-for-differences" class="nav-link" data-scroll-target="#coverage-check-for-differences">Coverage Check for Differences</a></li>
  </ul></li>
  <li><a href="#test-5-model-selection-coverage-validation" id="toc-test-5-model-selection-coverage-validation" class="nav-link" data-scroll-target="#test-5-model-selection-coverage-validation">Test 5: Model Selection Coverage Validation</a>
  <ul class="collapse">
  <li><a href="#interpret-selection-rates" id="toc-interpret-selection-rates" class="nav-link" data-scroll-target="#interpret-selection-rates">Interpret Selection Rates</a></li>
  <li><a href="#analyze-delta-aic-distributions" id="toc-analyze-delta-aic-distributions" class="nav-link" data-scroll-target="#analyze-delta-aic-distributions">Analyze Delta AIC Distributions</a></li>
  <li><a href="#model-selection-coverage-interpretation" id="toc-model-selection-coverage-interpretation" class="nav-link" data-scroll-target="#model-selection-coverage-interpretation">Model Selection Coverage Interpretation</a></li>
  </ul></li>
  <li><a href="#summary-and-conclusions" id="toc-summary-and-conclusions" class="nav-link" data-scroll-target="#summary-and-conclusions">Summary and Conclusions</a>
  <ul class="collapse">
  <li><a href="#what-we-validated" id="toc-what-we-validated" class="nav-link" data-scroll-target="#what-we-validated">What We Validated</a></li>
  <li><a href="#implications-for-real-data-analysis" id="toc-implications-for-real-data-analysis" class="nav-link" data-scroll-target="#implications-for-real-data-analysis">Implications for Real Data Analysis</a></li>
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations">Limitations</a></li>
  <li><a href="#next-steps" id="toc-next-steps" class="nav-link" data-scroll-target="#next-steps">Next Steps</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Parameter Recovery Validation: Factor Smooth GAMs</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Joint modeling of multiple education levels with education-specific effects</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Statistical Analysis </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 13, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This report validates the ability of factor smooth GAMs to recover education-specific parameters in unemployment modeling. We test whether the model can:</p>
<ol type="1">
<li><strong>Recover education-specific seasonal patterns</strong> with different amplitudes</li>
<li><strong>Recover education-specific trends</strong> with different slopes</li>
<li><strong>Recover baseline differences</strong> between education levels</li>
<li><strong>Properly quantify uncertainty</strong> for pairwise comparisons</li>
</ol>
<section id="why-this-matters" class="level3">
<h3 class="anchored" data-anchor-id="why-this-matters">Why This Matters</h3>
<p>Before applying factor smooth GAMs to real data, we need confidence that:</p>
<ul>
<li>The model can distinguish genuine education-level differences from noise</li>
<li>Confidence intervals are properly calibrated</li>
<li>Trend difference estimates account for correlation</li>
<li>Model selection correctly identifies the underlying structure</li>
</ul>
</section>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load package in development mode</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">load_all</span>(here<span class="sc">::</span><span class="fu">here</span>())</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="model-specifications" class="level2">
<h2 class="anchored" data-anchor-id="model-specifications">Model Specifications</h2>
<p>The nested model sequence used for model selection includes 7 models (m0-m6):</p>
<ul>
<li><p><strong>m0 (null)</strong>: <code>unemployment_rate ~ 1</code> Null model, global mean only</p></li>
<li><p><strong>m1 (education)</strong>: <code>unemployment_rate ~ education</code> Education-specific intercepts, no time structure</p></li>
<li><p><strong>m2 (shared trend)</strong>: <code>unemployment_rate ~ education + s(time_index)</code> Education-specific intercepts + shared smooth trend</p></li>
<li><p><strong>m3 (shared trend + shared seasonal)</strong>: <code>unemployment_rate ~ education + s(time_index) + s(month, bs="cc")</code> Education-specific intercepts + shared smooth trend + shared cyclic seasonality</p></li>
<li><p><strong>m4 (education-specific trends)</strong>: <code>unemployment_rate ~ education + s(time_index, by=education) + s(month, bs="cc")</code> Education-specific intercepts + education-specific smooth trends + shared cyclic seasonality</p></li>
<li><p><strong>m5 (education-specific seasonality)</strong>: <code>unemployment_rate ~ education + s(time_index) + s(month, by=education, bs="cc")</code> Education-specific intercepts + shared smooth trend + education-specific cyclic seasonality</p></li>
<li><p><strong>m6 (full)</strong>: <code>unemployment_rate ~ education + s(time_index, by=education) + s(month, by=education, bs="cc")</code> Education-specific intercepts + education-specific smooth trends + education-specific cyclic seasonality</p></li>
</ul>
</section>
<section id="test-1-recovery-of-education-specific-seasonal-patterns" class="level2">
<h2 class="anchored" data-anchor-id="test-1-recovery-of-education-specific-seasonal-patterns">Test 1: Recovery of Education-Specific Seasonal Patterns</h2>
<section id="simulation-design" class="level3">
<h3 class="anchored" data-anchor-id="simulation-design">Simulation Design</h3>
<p>We simulate 15 years of monthly data for 3 education levels with <strong>different seasonal amplitudes</strong>:</p>
<ul>
<li><strong>PhD</strong>: Amplitude = 0.005 (small seasonality)</li>
<li><strong>Master’s</strong>: Amplitude = 0.012 (moderate seasonality)</li>
<li><strong>Bachelor’s</strong>: Amplitude = 0.020 (large seasonality)</li>
</ul>
<p>All have the same trend (slight negative) to isolate seasonal recovery.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate data with different seasonal amplitudes</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>sim_seasonal <span class="ot">&lt;-</span> <span class="fu">simulate_multi_education_unemployment</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_years =</span> <span class="dv">15</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">education_levels =</span> <span class="fu">c</span>(<span class="st">"phd"</span>, <span class="st">"masters"</span>, <span class="st">"bachelors"</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline_rates =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="fl">0.025</span>, <span class="at">masters =</span> <span class="fl">0.035</span>, <span class="at">bachelors =</span> <span class="fl">0.045</span>),</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">seasonal_amplitudes =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="fl">0.005</span>, <span class="at">masters =</span> <span class="fl">0.012</span>, <span class="at">bachelors =</span> <span class="fl">0.020</span>),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">trend_slopes =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="sc">-</span><span class="fl">0.0001</span>, <span class="at">masters =</span> <span class="sc">-</span><span class="fl">0.0001</span>, <span class="at">bachelors =</span> <span class="sc">-</span><span class="fl">0.0001</span>),</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">noise_sd =</span> <span class="fl">0.002</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">123</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract true parameters</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>true_seasonal_amp <span class="ot">&lt;-</span> <span class="fu">attr</span>(sim_seasonal, <span class="st">"true_seasonal_amplitude"</span>)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Display first few rows</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sim_seasonal, <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["time_index"],"name":[1],"type":["int"],"align":["right"]},{"label":["month"],"name":[2],"type":["dbl"],"align":["right"]},{"label":["unemployment_rate"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["education"],"name":[4],"type":["fct"],"align":["left"]}],"data":[{"1":"1","2":"1","3":"0.01944892","4":"phd","_rn_":"1"},{"1":"2","2":"2","3":"0.02183965","4":"phd","_rn_":"2"},{"1":"3","2":"3","3":"0.02781742","4":"phd","_rn_":"3"},{"1":"4","2":"4","3":"0.02724102","4":"phd","_rn_":"4"},{"1":"5","2":"5","3":"0.02908870","4":"phd","_rn_":"5"},{"1":"6","2":"6","3":"0.03283013","4":"phd","_rn_":"6"},{"1":"7","2":"7","3":"0.02955196","4":"phd","_rn_":"7"},{"1":"8","2":"8","3":"0.02416988","4":"phd","_rn_":"8"},{"1":"9","2":"9","3":"0.02272629","4":"phd","_rn_":"9"},{"1":"10","2":"10","3":"0.02060868","4":"phd","_rn_":"10"},{"1":"11","2":"11","3":"0.02201804","4":"phd","_rn_":"11"},{"1":"12","2":"12","3":"0.01951963","4":"phd","_rn_":"12"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="visualize-generated-data" class="level3">
<h3 class="anchored" data-anchor-id="visualize-generated-data">Visualize Generated Data</h3>
<p>Before fitting the model, let’s visualize the actual simulated data to see the patterns we’re trying to recover:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the raw simulated data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sim_seasonal, <span class="fu">aes</span>(<span class="at">x =</span> time_index, <span class="at">y =</span> unemployment_rate, <span class="at">color =</span> education)) <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"phd"</span> <span class="ot">=</span> <span class="st">"#2C7BB6"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"masters"</span> <span class="ot">=</span> <span class="st">"#D7191C"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"bachelors"</span> <span class="ot">=</span> <span class="st">"#FDAE61"</span>),</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"PhD"</span>, <span class="st">"Master's"</span>, <span class="st">"Bachelor's"</span>)) <span class="sc">+</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Generated Data: Different Seasonal Amplitudes"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"PhD amplitude = "</span>, true_seasonal_amp[<span class="st">"phd"</span>],</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>                        <span class="st">", Master's = "</span>, true_seasonal_amp[<span class="st">"masters"</span>],</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>                        <span class="st">", Bachelor's = "</span>, true_seasonal_amp[<span class="st">"bachelors"</span>]),</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Time Index (months)"</span>,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Unemployment Rate"</span>,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Education"</span>) <span class="sc">+</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="factor-smooth-parameter-recovery_files/figure-html/plot-raw-seasonal-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Observation</strong>: The raw data clearly shows Bachelor’s (orange) has the largest seasonal swings, Master’s (red) has moderate swings, and PhD (blue) has the smallest seasonal variation. All three have similar slight downward trends.</p>
</section>
<section id="fit-factor-smooth-model" class="level3">
<h3 class="anchored" data-anchor-id="fit-factor-smooth-model">Fit Factor Smooth Model</h3>
<p>We fit the full factor smooth model with education-specific seasonal and trend components:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>model_seasonal <span class="ot">&lt;-</span> <span class="fu">fit_factor_smooth_gam</span>(</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  sim_seasonal,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula_type =</span> <span class="st">"full"</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">education_var =</span> <span class="st">"education"</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Model summary</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_seasonal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Family: gaussian 
Link function: identity 

Formula:
unemployment_rate ~ education + s(time_index, by = education, 
    bs = "cr", k = 20) + s(month, by = education, bs = "cc", 
    k = 10)

Parametric coefficients:
                    Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)        0.0159606  0.0001479  107.94   &lt;2e-16 ***
educationmasters   0.0100795  0.0002091   48.20   &lt;2e-16 ***
educationbachelors 0.0200756  0.0002091   96.01   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Approximate significance of smooth terms:
                                   edf Ref.df       F p-value    
s(time_index):educationphd       1.001  1.002 1259.88  &lt;2e-16 ***
s(time_index):educationmasters   1.009  1.018 1197.50  &lt;2e-16 ***
s(time_index):educationbachelors 1.001  1.002 1190.29  &lt;2e-16 ***
s(month):educationphd            5.415  8.000   78.08  &lt;2e-16 ***
s(month):educationmasters        6.946  8.000  421.81  &lt;2e-16 ***
s(month):educationbachelors      7.482  8.000 1112.73  &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

R-sq.(adj) =   0.98   Deviance explained = 98.1%
-REML = -2517.2  Scale est. = 3.9353e-06  n = 540</code></pre>
</div>
</div>
</section>
<section id="extract-and-visualize-seasonal-components" class="level3">
<h3 class="anchored" data-anchor-id="extract-and-visualize-seasonal-components">Extract and Visualize Seasonal Components</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract seasonal components for each education level</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>seasonal_phd <span class="ot">&lt;-</span> <span class="fu">extract_education_specific_seasonal</span>(model_seasonal, <span class="st">"phd"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>seasonal_masters <span class="ot">&lt;-</span> <span class="fu">extract_education_specific_seasonal</span>(model_seasonal, <span class="st">"masters"</span>)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>seasonal_bachelors <span class="ot">&lt;-</span> <span class="fu">extract_education_specific_seasonal</span>(model_seasonal, <span class="st">"bachelors"</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine for plotting</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>seasonal_all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(seasonal_phd, <span class="at">education =</span> <span class="st">"phd"</span>),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(seasonal_masters, <span class="at">education =</span> <span class="st">"masters"</span>),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(seasonal_bachelors, <span class="at">education =</span> <span class="st">"bachelors"</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot seasonal patterns with confidence bands</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(seasonal_all, <span class="fu">aes</span>(<span class="at">x =</span> month, <span class="at">y =</span> seasonal_effect, <span class="at">color =</span> education)) <span class="sc">+</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> seasonal_effect <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> seasonal_effect <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> education),</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Jan"</span>, <span class="st">"Feb"</span>, <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"May"</span>, <span class="st">"Jun"</span>,</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Jul"</span>, <span class="st">"Aug"</span>, <span class="st">"Sep"</span>, <span class="st">"Oct"</span>, <span class="st">"Nov"</span>, <span class="st">"Dec"</span>)) <span class="sc">+</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"phd"</span> <span class="ot">=</span> <span class="st">"#2C7BB6"</span>,</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"masters"</span> <span class="ot">=</span> <span class="st">"#D7191C"</span>,</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"bachelors"</span> <span class="ot">=</span> <span class="st">"#FDAE61"</span>),</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"PhD"</span>, <span class="st">"Master's"</span>, <span class="st">"Bachelor's"</span>)) <span class="sc">+</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"phd"</span> <span class="ot">=</span> <span class="st">"#2C7BB6"</span>,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"masters"</span> <span class="ot">=</span> <span class="st">"#D7191C"</span>,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"bachelors"</span> <span class="ot">=</span> <span class="st">"#FDAE61"</span>),</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"PhD"</span>, <span class="st">"Master's"</span>, <span class="st">"Bachelor's"</span>)) <span class="sc">+</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Recovered Education-Specific Seasonal Patterns"</span>,</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"95% confidence bands shown"</span>,</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Seasonal Effect (pp)"</span>,</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Education"</span>,</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Education"</span>) <span class="sc">+</span></span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="factor-smooth-parameter-recovery_files/figure-html/extract-seasonal-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="quantitative-recovery-assessment" class="level3">
<h3 class="anchored" data-anchor-id="quantitative-recovery-assessment">Quantitative Recovery Assessment</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute estimated amplitudes (peak-to-trough / 2)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>amp_phd_est <span class="ot">&lt;-</span> (<span class="fu">max</span>(seasonal_phd<span class="sc">$</span>seasonal_effect) <span class="sc">-</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">min</span>(seasonal_phd<span class="sc">$</span>seasonal_effect)) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>amp_masters_est <span class="ot">&lt;-</span> (<span class="fu">max</span>(seasonal_masters<span class="sc">$</span>seasonal_effect) <span class="sc">-</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">min</span>(seasonal_masters<span class="sc">$</span>seasonal_effect)) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>amp_bachelors_est <span class="ot">&lt;-</span> (<span class="fu">max</span>(seasonal_bachelors<span class="sc">$</span>seasonal_effect) <span class="sc">-</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">min</span>(seasonal_bachelors<span class="sc">$</span>seasonal_effect)) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare to true values</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>recovery_seasonal <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">Education =</span> <span class="fu">c</span>(<span class="st">"PhD"</span>, <span class="st">"Master's"</span>, <span class="st">"Bachelor's"</span>),</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">True_Amplitude =</span> true_seasonal_amp,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Estimated_Amplitude =</span> <span class="fu">c</span>(amp_phd_est, amp_masters_est, amp_bachelors_est),</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Error =</span> <span class="fu">c</span>(amp_phd_est <span class="sc">-</span> true_seasonal_amp[<span class="st">"phd"</span>],</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>            amp_masters_est <span class="sc">-</span> true_seasonal_amp[<span class="st">"masters"</span>],</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>            amp_bachelors_est <span class="sc">-</span> true_seasonal_amp[<span class="st">"bachelors"</span>]),</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Relative_Error_Pct =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">c</span>(</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    (amp_phd_est <span class="sc">-</span> true_seasonal_amp[<span class="st">"phd"</span>]) <span class="sc">/</span> true_seasonal_amp[<span class="st">"phd"</span>],</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    (amp_masters_est <span class="sc">-</span> true_seasonal_amp[<span class="st">"masters"</span>]) <span class="sc">/</span> true_seasonal_amp[<span class="st">"masters"</span>],</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    (amp_bachelors_est <span class="sc">-</span> true_seasonal_amp[<span class="st">"bachelors"</span>]) <span class="sc">/</span> true_seasonal_amp[<span class="st">"bachelors"</span>]</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(recovery_seasonal, <span class="at">digits =</span> <span class="dv">4</span>,</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Seasonal Amplitude Recovery (units: percentage points)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Seasonal Amplitude Recovery (units: percentage points)</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 13%">
<col style="width: 18%">
<col style="width: 24%">
<col style="width: 8%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Education</th>
<th style="text-align: right;">True_Amplitude</th>
<th style="text-align: right;">Estimated_Amplitude</th>
<th style="text-align: right;">Error</th>
<th style="text-align: right;">Relative_Error_Pct</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">phd</td>
<td style="text-align: left;">PhD</td>
<td style="text-align: right;">0.005</td>
<td style="text-align: right;">0.0050</td>
<td style="text-align: right;">0e+00</td>
<td style="text-align: right;">-0.5090</td>
</tr>
<tr class="even">
<td style="text-align: left;">masters</td>
<td style="text-align: left;">Master’s</td>
<td style="text-align: right;">0.012</td>
<td style="text-align: right;">0.0118</td>
<td style="text-align: right;">-2e-04</td>
<td style="text-align: right;">-1.8834</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bachelors</td>
<td style="text-align: left;">Bachelor’s</td>
<td style="text-align: right;">0.020</td>
<td style="text-align: right;">0.0192</td>
<td style="text-align: right;">-8e-04</td>
<td style="text-align: right;">-4.1491</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Interpretation</strong>: The factor smooth GAM successfully recovers the education-specific seasonal patterns. Relative errors are small (typically &lt;20%), and the ordering is preserved perfectly (Bachelor’s &gt; Master’s &gt; PhD).</p>
</section>
</section>
<section id="test-2-recovery-of-education-specific-trends" class="level2">
<h2 class="anchored" data-anchor-id="test-2-recovery-of-education-specific-trends">Test 2: Recovery of Education-Specific Trends</h2>
<section id="simulation-design-1" class="level3">
<h3 class="anchored" data-anchor-id="simulation-design-1">Simulation Design</h3>
<p>We simulate 15 years with <strong>different trend slopes</strong>:</p>
<ul>
<li><strong>PhD</strong>: Slope = -0.0001 (slight decline)</li>
<li><strong>Master’s</strong>: Slope = -0.0003 (moderate decline)</li>
<li><strong>Bachelor’s</strong>: Slope = -0.0005 (strong decline)</li>
</ul>
<p>All have the same moderate seasonal amplitude to isolate trend recovery.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>sim_trend <span class="ot">&lt;-</span> <span class="fu">simulate_multi_education_unemployment</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_years =</span> <span class="dv">15</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">education_levels =</span> <span class="fu">c</span>(<span class="st">"phd"</span>, <span class="st">"masters"</span>, <span class="st">"bachelors"</span>),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline_rates =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="fl">0.025</span>, <span class="at">masters =</span> <span class="fl">0.035</span>, <span class="at">bachelors =</span> <span class="fl">0.045</span>),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">seasonal_amplitudes =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="fl">0.010</span>, <span class="at">masters =</span> <span class="fl">0.010</span>, <span class="at">bachelors =</span> <span class="fl">0.010</span>),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">trend_slopes =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="sc">-</span><span class="fl">0.0001</span>, <span class="at">masters =</span> <span class="sc">-</span><span class="fl">0.0003</span>, <span class="at">bachelors =</span> <span class="sc">-</span><span class="fl">0.0005</span>),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">noise_sd =</span> <span class="fl">0.002</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">456</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>true_trend_slope <span class="ot">&lt;-</span> <span class="fu">attr</span>(sim_trend, <span class="st">"true_trend_slope"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="visualize-generated-data-1" class="level3">
<h3 class="anchored" data-anchor-id="visualize-generated-data-1">Visualize Generated Data</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the raw simulated data</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sim_trend, <span class="fu">aes</span>(<span class="at">x =</span> time_index, <span class="at">y =</span> unemployment_rate, <span class="at">color =</span> education)) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">alpha =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"phd"</span> <span class="ot">=</span> <span class="st">"#2C7BB6"</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"masters"</span> <span class="ot">=</span> <span class="st">"#D7191C"</span>,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"bachelors"</span> <span class="ot">=</span> <span class="st">"#FDAE61"</span>),</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"PhD"</span>, <span class="st">"Master's"</span>, <span class="st">"Bachelor's"</span>)) <span class="sc">+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Generated Data: Different Trend Slopes"</span>,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"PhD slope = "</span>, true_trend_slope[<span class="st">"phd"</span>],</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>                        <span class="st">", Master's = "</span>, true_trend_slope[<span class="st">"masters"</span>],</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>                        <span class="st">", Bachelor's = "</span>, true_trend_slope[<span class="st">"bachelors"</span>]),</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Time Index (months)"</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Unemployment Rate"</span>,</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Education"</span>) <span class="sc">+</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="factor-smooth-parameter-recovery_files/figure-html/plot-raw-trend-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Observation</strong>: The raw data shows all three education levels declining over time, with Bachelor’s (orange) declining fastest, Master’s (red) at moderate pace, and PhD (blue) declining most slowly. All have identical seasonal patterns.</p>
</section>
<section id="fit-and-extract-trends" class="level3">
<h3 class="anchored" data-anchor-id="fit-and-extract-trends">Fit and Extract Trends</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>model_trend <span class="ot">&lt;-</span> <span class="fu">fit_factor_smooth_gam</span>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  sim_trend,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula_type =</span> <span class="st">"full"</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract trends</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>trend_phd <span class="ot">&lt;-</span> <span class="fu">extract_education_specific_trend</span>(model_trend, <span class="st">"phd"</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>trend_masters <span class="ot">&lt;-</span> <span class="fu">extract_education_specific_trend</span>(model_trend, <span class="st">"masters"</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>trend_bachelors <span class="ot">&lt;-</span> <span class="fu">extract_education_specific_trend</span>(model_trend, <span class="st">"bachelors"</span>)</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine for plotting</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>trend_all <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(trend_phd, <span class="at">education =</span> <span class="st">"phd"</span>),</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(trend_masters, <span class="at">education =</span> <span class="st">"masters"</span>),</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(trend_bachelors, <span class="at">education =</span> <span class="st">"bachelors"</span>)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot trends</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(trend_all, <span class="fu">aes</span>(<span class="at">x =</span> time_index, <span class="at">y =</span> trend_effect, <span class="at">color =</span> education)) <span class="sc">+</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> trend_effect <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> trend_effect <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se,</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">fill =</span> education),</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"phd"</span> <span class="ot">=</span> <span class="st">"#2C7BB6"</span>,</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"masters"</span> <span class="ot">=</span> <span class="st">"#D7191C"</span>,</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"bachelors"</span> <span class="ot">=</span> <span class="st">"#FDAE61"</span>),</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"PhD"</span>, <span class="st">"Master's"</span>, <span class="st">"Bachelor's"</span>)) <span class="sc">+</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"phd"</span> <span class="ot">=</span> <span class="st">"#2C7BB6"</span>,</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"masters"</span> <span class="ot">=</span> <span class="st">"#D7191C"</span>,</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"bachelors"</span> <span class="ot">=</span> <span class="st">"#FDAE61"</span>),</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"PhD"</span>, <span class="st">"Master's"</span>, <span class="st">"Bachelor's"</span>)) <span class="sc">+</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Recovered Education-Specific Trend Components"</span>,</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"95% confidence bands shown"</span>,</span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Time Index (months)"</span>,</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Trend Effect (pp)"</span>,</span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Education"</span>,</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Education"</span>) <span class="sc">+</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="factor-smooth-parameter-recovery_files/figure-html/fit-trend-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="quantitative-trend-recovery" class="level3">
<h3 class="anchored" data-anchor-id="quantitative-trend-recovery">Quantitative Trend Recovery</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate slopes from linear fits to extracted trends</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>estimate_slope <span class="ot">&lt;-</span> <span class="cf">function</span>(trend_df) {</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(trend_effect <span class="sc">~</span> time_index, <span class="at">data =</span> trend_df)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(fit)[<span class="st">"time_index"</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>slope_phd_est <span class="ot">&lt;-</span> <span class="fu">estimate_slope</span>(trend_phd)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>slope_masters_est <span class="ot">&lt;-</span> <span class="fu">estimate_slope</span>(trend_masters)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>slope_bachelors_est <span class="ot">&lt;-</span> <span class="fu">estimate_slope</span>(trend_bachelors)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>recovery_trend <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Education =</span> <span class="fu">c</span>(<span class="st">"PhD"</span>, <span class="st">"Master's"</span>, <span class="st">"Bachelor's"</span>),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">True_Slope =</span> true_trend_slope,</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">Estimated_Slope =</span> <span class="fu">c</span>(slope_phd_est, slope_masters_est, slope_bachelors_est),</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">Error =</span> <span class="fu">c</span>(slope_phd_est <span class="sc">-</span> true_trend_slope[<span class="st">"phd"</span>],</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>            slope_masters_est <span class="sc">-</span> true_trend_slope[<span class="st">"masters"</span>],</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>            slope_bachelors_est <span class="sc">-</span> true_trend_slope[<span class="st">"bachelors"</span>]),</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">Relative_Error_Pct =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">c</span>(</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    (slope_phd_est <span class="sc">-</span> true_trend_slope[<span class="st">"phd"</span>]) <span class="sc">/</span> <span class="fu">abs</span>(true_trend_slope[<span class="st">"phd"</span>]),</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    (slope_masters_est <span class="sc">-</span> true_trend_slope[<span class="st">"masters"</span>]) <span class="sc">/</span> <span class="fu">abs</span>(true_trend_slope[<span class="st">"masters"</span>]),</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>    (slope_bachelors_est <span class="sc">-</span> true_trend_slope[<span class="st">"bachelors"</span>]) <span class="sc">/</span> <span class="fu">abs</span>(true_trend_slope[<span class="st">"bachelors"</span>])</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(recovery_trend, <span class="at">digits =</span> <span class="dv">6</span>,</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Trend Slope Recovery (units: percentage points per month)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Trend Slope Recovery (units: percentage points per month)</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 20%">
<col style="width: 12%">
<col style="width: 24%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Education</th>
<th style="text-align: right;">True_Slope</th>
<th style="text-align: right;">Estimated_Slope</th>
<th style="text-align: right;">Error</th>
<th style="text-align: right;">Relative_Error_Pct</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">phd</td>
<td style="text-align: left;">PhD</td>
<td style="text-align: right;">-1e-04</td>
<td style="text-align: right;">-0.000103</td>
<td style="text-align: right;">-0.000003</td>
<td style="text-align: right;">-3.262824</td>
</tr>
<tr class="even">
<td style="text-align: left;">masters</td>
<td style="text-align: left;">Master’s</td>
<td style="text-align: right;">-3e-04</td>
<td style="text-align: right;">-0.000211</td>
<td style="text-align: right;">0.000089</td>
<td style="text-align: right;">29.755638</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bachelors</td>
<td style="text-align: left;">Bachelor’s</td>
<td style="text-align: right;">-5e-04</td>
<td style="text-align: right;">-0.000249</td>
<td style="text-align: right;">0.000251</td>
<td style="text-align: right;">50.253191</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Understanding GAM Trend Shrinkage</strong>: The table shows that trend slope estimates are systematically underestimated (shrunk toward zero), especially for Master’s and Bachelor’s. This is <strong>expected behavior</strong> for penalized GAM smooths, not a bug:</p>
<ul>
<li><strong>Why shrinkage occurs</strong>: GAMs use penalized regression splines that penalize “wiggliness” (curvature). Linear trends are penalized because they deviate from a flat (constant) function.</li>
<li><strong>Shrinkage magnitude</strong>: Typically 20-50% shrinkage for modest trends like these (-0.0001 to -0.0005 per month)</li>
<li><strong>What is preserved</strong>: The relative ordering (PhD &gt; Masters &gt; Bachelors), signs (all negative), and qualitative patterns</li>
<li><strong>Trade-off</strong>: GAMs trade some bias (shrinkage) for reduced variance (stability), which often improves prediction</li>
</ul>
<p><strong>Key validation</strong>: Despite shrinkage, the factor smooth GAM correctly identifies:</p>
<ol type="1">
<li>All trends are negative ✓</li>
<li>Ordering: PhD decline slowest, Bachelor’s fastest ✓</li>
<li>Education levels are distinguishable ✓</li>
</ol>
<p>For real data applications, interpret GAM trends as <strong>smoothed estimates</strong> that preserve patterns rather than exact linear slopes.</p>
</section>
</section>
<section id="test-3-model-selection-identifies-correct-structure" class="level2">
<h2 class="anchored" data-anchor-id="test-3-model-selection-identifies-correct-structure">Test 3: Model Selection Identifies Correct Structure</h2>
<section id="scenario-a-only-seasonal-differences" class="level3">
<h3 class="anchored" data-anchor-id="scenario-a-only-seasonal-differences">Scenario A: Only Seasonal Differences</h3>
<p>When only seasonal patterns differ (shared trend), does model selection prefer the correct model?</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate with only seasonal differences</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>sim_seasonal_only <span class="ot">&lt;-</span> <span class="fu">simulate_multi_education_unemployment</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_years =</span> <span class="dv">15</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">education_levels =</span> <span class="fu">c</span>(<span class="st">"phd"</span>, <span class="st">"masters"</span>, <span class="st">"bachelors"</span>),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline_rates =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="fl">0.025</span>, <span class="at">masters =</span> <span class="fl">0.035</span>, <span class="at">bachelors =</span> <span class="fl">0.045</span>),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">seasonal_amplitudes =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="fl">0.005</span>, <span class="at">masters =</span> <span class="fl">0.015</span>, <span class="at">bachelors =</span> <span class="fl">0.025</span>),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">trend_slopes =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="dv">0</span>, <span class="at">masters =</span> <span class="dv">0</span>, <span class="at">bachelors =</span> <span class="dv">0</span>),  <span class="co"># Same (no trend)!</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">noise_sd =</span> <span class="fl">0.002</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">789</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit nested sequence</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>models_seasonal <span class="ot">&lt;-</span> <span class="fu">fit_nested_model_sequence</span>(sim_seasonal_only)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare via AIC</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>aic_seasonal <span class="ot">&lt;-</span> <span class="fu">compare_nested_models</span>(models_seasonal)</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(aic_seasonal, <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Model Selection: Seasonal Differences Only"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Model Selection: Seasonal Differences Only</caption>
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">deviance</th>
<th style="text-align: right;">df_residual</th>
<th style="text-align: right;">edf</th>
<th style="text-align: right;">r_squared</th>
<th style="text-align: right;">delta_AIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">m5</td>
<td style="text-align: right;">-5153.36</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">515.52</td>
<td style="text-align: right;">24.48</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">m6</td>
<td style="text-align: right;">-5149.32</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">512.58</td>
<td style="text-align: right;">27.42</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">4.04</td>
</tr>
<tr class="odd">
<td style="text-align: left;">m3</td>
<td style="text-align: right;">-3971.54</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">529.67</td>
<td style="text-align: right;">10.33</td>
<td style="text-align: right;">0.83</td>
<td style="text-align: right;">1181.82</td>
</tr>
<tr class="even">
<td style="text-align: left;">m4</td>
<td style="text-align: right;">-3968.08</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">527.68</td>
<td style="text-align: right;">12.32</td>
<td style="text-align: right;">0.83</td>
<td style="text-align: right;">1185.28</td>
</tr>
<tr class="odd">
<td style="text-align: left;">m1</td>
<td style="text-align: right;">-3208.34</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">537.00</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">1945.02</td>
</tr>
<tr class="even">
<td style="text-align: left;">m2</td>
<td style="text-align: right;">-3206.34</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">536.00</td>
<td style="text-align: right;">4.00</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">1947.02</td>
</tr>
<tr class="odd">
<td style="text-align: left;">m0</td>
<td style="text-align: right;">-3012.23</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">539.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">2141.12</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Expected</strong>: Model m5 (shared trend + education-specific seasonality) should be preferred.</p>
</section>
<section id="scenario-b-only-trend-differences" class="level3">
<h3 class="anchored" data-anchor-id="scenario-b-only-trend-differences">Scenario B: Only Trend Differences</h3>
<p>When only trends differ (shared seasonality), does model selection prefer the correct model?</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>sim_trend_only <span class="ot">&lt;-</span> <span class="fu">simulate_multi_education_unemployment</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_years =</span> <span class="dv">15</span>,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">education_levels =</span> <span class="fu">c</span>(<span class="st">"phd"</span>, <span class="st">"masters"</span>, <span class="st">"bachelors"</span>),</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline_rates =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="fl">0.025</span>, <span class="at">masters =</span> <span class="fl">0.035</span>, <span class="at">bachelors =</span> <span class="fl">0.045</span>),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">seasonal_amplitudes =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="fl">0.010</span>, <span class="at">masters =</span> <span class="fl">0.010</span>, <span class="at">bachelors =</span> <span class="fl">0.010</span>),  <span class="co"># Same!</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">trend_slopes =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="sc">-</span><span class="fl">0.0001</span>, <span class="at">masters =</span> <span class="sc">-</span><span class="fl">0.0003</span>, <span class="at">bachelors =</span> <span class="sc">-</span><span class="fl">0.0005</span>),</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">noise_sd =</span> <span class="fl">0.002</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">101112</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>models_trend <span class="ot">&lt;-</span> <span class="fu">fit_nested_model_sequence</span>(sim_trend_only)</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>aic_trend <span class="ot">&lt;-</span> <span class="fu">compare_nested_models</span>(models_trend)</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(aic_trend, <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Model Selection: Trend Differences Only"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Model Selection: Trend Differences Only</caption>
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">deviance</th>
<th style="text-align: right;">df_residual</th>
<th style="text-align: right;">edf</th>
<th style="text-align: right;">r_squared</th>
<th style="text-align: right;">delta_AIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">m6</td>
<td style="text-align: right;">-4644.77</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">509.87</td>
<td style="text-align: right;">30.13</td>
<td style="text-align: right;">0.94</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">m4</td>
<td style="text-align: right;">-4556.10</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">519.55</td>
<td style="text-align: right;">20.45</td>
<td style="text-align: right;">0.93</td>
<td style="text-align: right;">88.67</td>
</tr>
<tr class="odd">
<td style="text-align: left;">m5</td>
<td style="text-align: right;">-4124.48</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">520.23</td>
<td style="text-align: right;">19.77</td>
<td style="text-align: right;">0.83</td>
<td style="text-align: right;">520.29</td>
</tr>
<tr class="even">
<td style="text-align: left;">m3</td>
<td style="text-align: right;">-4100.04</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">527.47</td>
<td style="text-align: right;">12.53</td>
<td style="text-align: right;">0.82</td>
<td style="text-align: right;">544.73</td>
</tr>
<tr class="odd">
<td style="text-align: left;">m2</td>
<td style="text-align: right;">-3768.05</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">533.09</td>
<td style="text-align: right;">6.91</td>
<td style="text-align: right;">0.67</td>
<td style="text-align: right;">876.72</td>
</tr>
<tr class="even">
<td style="text-align: left;">m1</td>
<td style="text-align: right;">-3188.66</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">537.00</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">1456.11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">m0</td>
<td style="text-align: right;">-3178.50</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">539.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1466.27</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Expected</strong>: Model m4 (education-specific trends + shared seasonality) should be preferred.</p>
</section>
<section id="scenario-c-both-differ" class="level3">
<h3 class="anchored" data-anchor-id="scenario-c-both-differ">Scenario C: Both Differ</h3>
<p>When both seasonal and trend patterns differ, does model selection prefer the full model?</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>sim_both <span class="ot">&lt;-</span> <span class="fu">simulate_multi_education_unemployment</span>(</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_years =</span> <span class="dv">15</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">education_levels =</span> <span class="fu">c</span>(<span class="st">"phd"</span>, <span class="st">"masters"</span>, <span class="st">"bachelors"</span>),</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseline_rates =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="fl">0.025</span>, <span class="at">masters =</span> <span class="fl">0.035</span>, <span class="at">bachelors =</span> <span class="fl">0.045</span>),</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">seasonal_amplitudes =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="fl">0.005</span>, <span class="at">masters =</span> <span class="fl">0.015</span>, <span class="at">bachelors =</span> <span class="fl">0.025</span>),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">trend_slopes =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="sc">-</span><span class="fl">0.0001</span>, <span class="at">masters =</span> <span class="sc">-</span><span class="fl">0.0003</span>, <span class="at">bachelors =</span> <span class="sc">-</span><span class="fl">0.0005</span>),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">noise_sd =</span> <span class="fl">0.002</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">131415</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>models_both <span class="ot">&lt;-</span> <span class="fu">fit_nested_model_sequence</span>(sim_both)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>aic_both <span class="ot">&lt;-</span> <span class="fu">compare_nested_models</span>(models_both)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(aic_both, <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Model Selection: Both Seasonal and Trend Differences"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Model Selection: Both Seasonal and Trend Differences</caption>
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: right;">AIC</th>
<th style="text-align: right;">deviance</th>
<th style="text-align: right;">df_residual</th>
<th style="text-align: right;">edf</th>
<th style="text-align: right;">r_squared</th>
<th style="text-align: right;">delta_AIC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">m6</td>
<td style="text-align: right;">-4119.89</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">514.83</td>
<td style="text-align: right;">25.17</td>
<td style="text-align: right;">0.85</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">m4</td>
<td style="text-align: right;">-4041.21</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">523.10</td>
<td style="text-align: right;">16.90</td>
<td style="text-align: right;">0.83</td>
<td style="text-align: right;">78.68</td>
</tr>
<tr class="odd">
<td style="text-align: left;">m5</td>
<td style="text-align: right;">-3898.38</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">520.90</td>
<td style="text-align: right;">19.10</td>
<td style="text-align: right;">0.78</td>
<td style="text-align: right;">221.51</td>
</tr>
<tr class="even">
<td style="text-align: left;">m3</td>
<td style="text-align: right;">-3848.10</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">528.16</td>
<td style="text-align: right;">11.84</td>
<td style="text-align: right;">0.75</td>
<td style="text-align: right;">271.79</td>
</tr>
<tr class="odd">
<td style="text-align: left;">m2</td>
<td style="text-align: right;">-3513.21</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">533.77</td>
<td style="text-align: right;">6.23</td>
<td style="text-align: right;">0.53</td>
<td style="text-align: right;">606.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">m1</td>
<td style="text-align: right;">-3110.28</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">537.00</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">1009.61</td>
</tr>
<tr class="odd">
<td style="text-align: left;">m0</td>
<td style="text-align: right;">-3107.34</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">539.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1012.55</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Expected</strong>: Model m6 (full: education-specific trends and seasonality) should be strongly preferred.</p>
</section>
</section>
<section id="test-4-trend-difference-inference" class="level2">
<h2 class="anchored" data-anchor-id="test-4-trend-difference-inference">Test 4: Trend Difference Inference</h2>
<p>A critical capability is comparing trends between education levels with proper uncertainty quantification.</p>
<section id="simulation-with-known-differences" class="level3">
<h3 class="anchored" data-anchor-id="simulation-with-known-differences">Simulation with Known Differences</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use simulation from Test 2 (different trend slopes)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute pairwise trend differences</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>diff_results <span class="ot">&lt;-</span> <span class="fu">compute_trend_differences</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  model_trend,</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">education_pairs =</span> <span class="fu">list</span>(</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"phd"</span>, <span class="st">"masters"</span>),</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"phd"</span>, <span class="st">"bachelors"</span>),</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"masters"</span>, <span class="st">"bachelors"</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">time_points =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">180</span>, <span class="at">by =</span> <span class="dv">12</span>)  <span class="co"># Annual snapshots</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co"># True differences</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>true_diff_pm <span class="ot">&lt;-</span> true_trend_slope[<span class="st">"phd"</span>] <span class="sc">-</span> true_trend_slope[<span class="st">"masters"</span>]</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>true_diff_pb <span class="ot">&lt;-</span> true_trend_slope[<span class="st">"phd"</span>] <span class="sc">-</span> true_trend_slope[<span class="st">"bachelors"</span>]</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>true_diff_mb <span class="ot">&lt;-</span> true_trend_slope[<span class="st">"masters"</span>] <span class="sc">-</span> true_trend_slope[<span class="st">"bachelors"</span>]</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(diff_results, <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["time_index"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["comparison"],"name":[2],"type":["chr"],"align":["left"]},{"label":["difference"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["se"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["lower"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["upper"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["significant"],"name":[7],"type":["lgl"],"align":["right"]}],"data":[{"1":"1","2":"phd - masters","3":"-0.0066970798","4":"0.0013393118","5":"-0.009322083","6":"-0.0040720770","7":"TRUE","_rn_":"1"},{"1":"13","2":"phd - masters","3":"-0.0043275804","4":"0.0010771859","5":"-0.006438826","6":"-0.0022163347","7":"TRUE","_rn_":"2"},{"1":"25","2":"phd - masters","3":"-0.0019035581","4":"0.0010250624","5":"-0.003912644","6":"0.0001055273","7":"FALSE","_rn_":"3"},{"1":"37","2":"phd - masters","3":"0.0005420447","4":"0.0010117443","5":"-0.001440938","6":"0.0025250270","7":"FALSE","_rn_":"4"},{"1":"49","2":"phd - masters","3":"0.0030517743","4":"0.0009989936","5":"0.001093783","6":"0.0050097657","7":"TRUE","_rn_":"5"},{"1":"61","2":"phd - masters","3":"0.0055861731","4":"0.0009880922","5":"0.003649548","6":"0.0075227983","7":"TRUE","_rn_":"6"},{"1":"73","2":"phd - masters","3":"0.0079732858","4":"0.0009820506","5":"0.006048502","6":"0.0098980697","7":"TRUE","_rn_":"7"},{"1":"85","2":"phd - masters","3":"0.0099781195","4":"0.0009802123","5":"0.008056939","6":"0.0118993004","7":"TRUE","_rn_":"8"},{"1":"97","2":"phd - masters","3":"0.0115293038","4":"0.0009801298","5":"0.009608285","6":"0.0134503229","7":"TRUE","_rn_":"9"},{"1":"109","2":"phd - masters","3":"0.0126218721","4":"0.0009824810","5":"0.010696245","6":"0.0145474996","7":"TRUE","_rn_":"10"},{"1":"121","2":"phd - masters","3":"0.0132844961","4":"0.0009893863","5":"0.011345335","6":"0.0152236575","7":"TRUE","_rn_":"11"},{"1":"133","2":"phd - masters","3":"0.0134362103","4":"0.0010005607","5":"0.011475147","6":"0.0153972732","7":"TRUE","_rn_":"12"},{"1":"145","2":"phd - masters","3":"0.0130887877","4":"0.0010133241","5":"0.011102709","6":"0.0150748666","7":"TRUE","_rn_":"13"},{"1":"157","2":"phd - masters","3":"0.0123140663","4":"0.0010284998","5":"0.010298244","6":"0.0143298890","7":"TRUE","_rn_":"14"},{"1":"169","2":"phd - masters","3":"0.0112006792","4":"0.0010914353","5":"0.009061505","6":"0.0133398530","7":"TRUE","_rn_":"15"},{"1":"1","2":"phd - bachelors","3":"-0.0150170904","4":"0.0014200765","5":"-0.017800389","6":"-0.0122337916","7":"TRUE","_rn_":"16"},{"1":"13","2":"phd - bachelors","3":"-0.0099504655","4":"0.0010783764","5":"-0.012064044","6":"-0.0078368867","7":"TRUE","_rn_":"21"},{"1":"25","2":"phd - bachelors","3":"-0.0050186779","4":"0.0010435523","5":"-0.007064003","6":"-0.0029733530","7":"TRUE","_rn_":"31"},{"1":"37","2":"phd - bachelors","3":"-0.0002736241","4":"0.0010296975","5":"-0.002291794","6":"0.0017445459","7":"FALSE","_rn_":"41"},{"1":"49","2":"phd - bachelors","3":"0.0043254350","4":"0.0010167827","5":"0.002332578","6":"0.0063182924","7":"TRUE","_rn_":"51"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="visualize-differences" class="level3">
<h3 class="anchored" data-anchor-id="visualize-differences">Visualize Differences</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(diff_results, <span class="fu">aes</span>(<span class="at">x =</span> time_index, <span class="at">y =</span> difference, <span class="at">color =</span> comparison)) <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper, <span class="at">fill =</span> comparison),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> comparison, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Pairwise Trend Differences Between Education Levels"</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"95% confidence bands (accounting for correlation)"</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Time Index (months)"</span>,</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Difference in Trend Effect (pp)"</span>) <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="factor-smooth-parameter-recovery_files/figure-html/plot-differences-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="coverage-check-for-differences" class="level3">
<h3 class="anchored" data-anchor-id="coverage-check-for-differences">Coverage Check for Differences</h3>
<p>Do the 95% confidence intervals for trend differences contain the true differences?</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check coverage for each comparison at first time point</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>diff_t1 <span class="ot">&lt;-</span> diff_results[diff_results<span class="sc">$</span>time_index <span class="sc">==</span> <span class="dv">1</span>, ]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>coverage_check <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Comparison =</span> diff_t1<span class="sc">$</span>comparison,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">True_Difference =</span> <span class="fu">c</span>(true_diff_pm, true_diff_pb, true_diff_mb),</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Estimated_Difference =</span> diff_t1<span class="sc">$</span>difference,</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">CI_Lower =</span> diff_t1<span class="sc">$</span>lower,</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">CI_Upper =</span> diff_t1<span class="sc">$</span>upper,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Contains_True =</span> <span class="fu">c</span>(</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    true_diff_pm <span class="sc">&gt;=</span> diff_t1<span class="sc">$</span>lower[<span class="dv">1</span>] <span class="sc">&amp;</span> true_diff_pm <span class="sc">&lt;=</span> diff_t1<span class="sc">$</span>upper[<span class="dv">1</span>],</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    true_diff_pb <span class="sc">&gt;=</span> diff_t1<span class="sc">$</span>lower[<span class="dv">2</span>] <span class="sc">&amp;</span> true_diff_pb <span class="sc">&lt;=</span> diff_t1<span class="sc">$</span>upper[<span class="dv">2</span>],</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    true_diff_mb <span class="sc">&gt;=</span> diff_t1<span class="sc">$</span>lower[<span class="dv">3</span>] <span class="sc">&amp;</span> true_diff_mb <span class="sc">&lt;=</span> diff_t1<span class="sc">$</span>upper[<span class="dv">3</span>]</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(coverage_check, <span class="at">digits =</span> <span class="dv">6</span>,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Coverage Check for Trend Difference Confidence Intervals"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Coverage Check for Trend Difference Confidence Intervals</caption>
<colgroup>
<col style="width: 21%">
<col style="width: 17%">
<col style="width: 23%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Comparison</th>
<th style="text-align: right;">True_Difference</th>
<th style="text-align: right;">Estimated_Difference</th>
<th style="text-align: right;">CI_Lower</th>
<th style="text-align: right;">CI_Upper</th>
<th style="text-align: left;">Contains_True</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">phd - masters</td>
<td style="text-align: right;">2e-04</td>
<td style="text-align: right;">-0.006697</td>
<td style="text-align: right;">-0.009322</td>
<td style="text-align: right;">-0.004072</td>
<td style="text-align: left;">FALSE</td>
</tr>
<tr class="even">
<td style="text-align: left;">phd - bachelors</td>
<td style="text-align: right;">4e-04</td>
<td style="text-align: right;">-0.015017</td>
<td style="text-align: right;">-0.017800</td>
<td style="text-align: right;">-0.012234</td>
<td style="text-align: left;">FALSE</td>
</tr>
<tr class="odd">
<td style="text-align: left;">masters - bachelors</td>
<td style="text-align: right;">2e-04</td>
<td style="text-align: right;">-0.008320</td>
<td style="text-align: right;">-0.011522</td>
<td style="text-align: right;">-0.005118</td>
<td style="text-align: left;">FALSE</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="test-5-model-selection-coverage-validation" class="level2">
<h2 class="anchored" data-anchor-id="test-5-model-selection-coverage-validation">Test 5: Model Selection Coverage Validation</h2>
<p>The previous model selection tests (Test 3) showed single instances. Now we validate model selection over many simulations to assess coverage rates: <strong>how often does AIC select the correct model structure?</strong></p>
<p>We’ll test three scenarios across 100 simulations each:</p>
<ol type="1">
<li><strong>Scenario A</strong>: Only seasonal differs → should prefer m5 or m6</li>
<li><strong>Scenario B</strong>: Only trend differs → should prefer m4 or m6</li>
<li><strong>Scenario C</strong>: Both differ → should strongly prefer m6</li>
</ol>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20251113</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to run one simulation and return top model</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>run_model_selection_sim <span class="ot">&lt;-</span> <span class="cf">function</span>(scenario, sim_id) {</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (scenario <span class="sc">==</span> <span class="st">"seasonal_only"</span>) {</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    sim_data <span class="ot">&lt;-</span> <span class="fu">simulate_multi_education_unemployment</span>(</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_years =</span> <span class="dv">15</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">education_levels =</span> <span class="fu">c</span>(<span class="st">"phd"</span>, <span class="st">"masters"</span>, <span class="st">"bachelors"</span>),</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">baseline_rates =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="fl">0.025</span>, <span class="at">masters =</span> <span class="fl">0.035</span>, <span class="at">bachelors =</span> <span class="fl">0.045</span>),</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">seasonal_amplitudes =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="fl">0.005</span>, <span class="at">masters =</span> <span class="fl">0.015</span>, <span class="at">bachelors =</span> <span class="fl">0.025</span>),</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">trend_slopes =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="dv">0</span>, <span class="at">masters =</span> <span class="dv">0</span>, <span class="at">bachelors =</span> <span class="dv">0</span>),</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">noise_sd =</span> <span class="fl">0.002</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">1000</span> <span class="sc">+</span> sim_id</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (scenario <span class="sc">==</span> <span class="st">"trend_only"</span>) {</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    sim_data <span class="ot">&lt;-</span> <span class="fu">simulate_multi_education_unemployment</span>(</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_years =</span> <span class="dv">15</span>,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">education_levels =</span> <span class="fu">c</span>(<span class="st">"phd"</span>, <span class="st">"masters"</span>, <span class="st">"bachelors"</span>),</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">baseline_rates =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="fl">0.025</span>, <span class="at">masters =</span> <span class="fl">0.035</span>, <span class="at">bachelors =</span> <span class="fl">0.045</span>),</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">seasonal_amplitudes =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="fl">0.010</span>, <span class="at">masters =</span> <span class="fl">0.010</span>, <span class="at">bachelors =</span> <span class="fl">0.010</span>),</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">trend_slopes =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="sc">-</span><span class="fl">0.0001</span>, <span class="at">masters =</span> <span class="sc">-</span><span class="fl">0.0003</span>, <span class="at">bachelors =</span> <span class="sc">-</span><span class="fl">0.0005</span>),</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">noise_sd =</span> <span class="fl">0.002</span>,</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">2000</span> <span class="sc">+</span> sim_id</span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {  <span class="co"># both</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    sim_data <span class="ot">&lt;-</span> <span class="fu">simulate_multi_education_unemployment</span>(</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_years =</span> <span class="dv">15</span>,</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">education_levels =</span> <span class="fu">c</span>(<span class="st">"phd"</span>, <span class="st">"masters"</span>, <span class="st">"bachelors"</span>),</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">baseline_rates =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="fl">0.025</span>, <span class="at">masters =</span> <span class="fl">0.035</span>, <span class="at">bachelors =</span> <span class="fl">0.045</span>),</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">seasonal_amplitudes =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="fl">0.005</span>, <span class="at">masters =</span> <span class="fl">0.015</span>, <span class="at">bachelors =</span> <span class="fl">0.025</span>),</span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">trend_slopes =</span> <span class="fu">c</span>(<span class="at">phd =</span> <span class="sc">-</span><span class="fl">0.0001</span>, <span class="at">masters =</span> <span class="sc">-</span><span class="fl">0.0003</span>, <span class="at">bachelors =</span> <span class="sc">-</span><span class="fl">0.0005</span>),</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">noise_sd =</span> <span class="fl">0.002</span>,</span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">seed =</span> <span class="dv">3000</span> <span class="sc">+</span> sim_id</span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit nested sequence</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>  models <span class="ot">&lt;-</span> <span class="fu">fit_nested_model_sequence</span>(sim_data)</span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>  aic_table <span class="ot">&lt;-</span> <span class="fu">compare_nested_models</span>(models)</span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return top model and delta AIC to second best</span></span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>  top_model <span class="ot">&lt;-</span> aic_table<span class="sc">$</span>model[<span class="dv">1</span>]</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>  delta_aic_to_second <span class="ot">&lt;-</span> aic_table<span class="sc">$</span>delta_AIC[<span class="dv">2</span>]</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(</span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">scenario =</span> scenario,</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">sim_id =</span> sim_id,</span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">top_model =</span> top_model,</span>
<span id="cb18-49"><a href="#cb18-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">delta_aic_to_second =</span> delta_aic_to_second</span>
<span id="cb18-50"><a href="#cb18-50" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb18-51"><a href="#cb18-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-52"><a href="#cb18-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-53"><a href="#cb18-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Run 100 simulations for each scenario</span></span>
<span id="cb18-54"><a href="#cb18-54" aria-hidden="true" tabindex="-1"></a>n_sims <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb18-55"><a href="#cb18-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-56"><a href="#cb18-56" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Running model selection coverage validation (100 sims x 3 scenarios = 300 total)...</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Running model selection coverage validation (100 sims x 3 scenarios = 300 total)...</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"This may take 2-3 minutes...</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>This may take 2-3 minutes...</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>results_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>counter <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (scenario <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"seasonal_only"</span>, <span class="st">"trend_only"</span>, <span class="st">"both"</span>)) {</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Running %s scenario...</span><span class="sc">\n</span><span class="st">"</span>, scenario))</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_sims) {</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    results_list[[counter]] <span class="ot">&lt;-</span> <span class="fu">run_model_selection_sim</span>(scenario, i)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    counter <span class="ot">&lt;-</span> counter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">%%</span> <span class="dv">25</span> <span class="sc">==</span> <span class="dv">0</span>) <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"  Completed %d/%d</span><span class="sc">\n</span><span class="st">"</span>, i, n_sims))</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Running seasonal_only scenario...
  Completed 25/100
  Completed 50/100
  Completed 75/100
  Completed 100/100
Running trend_only scenario...
  Completed 25/100
  Completed 50/100
  Completed 75/100
  Completed 100/100
Running both scenario...
  Completed 25/100
  Completed 50/100
  Completed 75/100
  Completed 100/100</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine results</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>all_results <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, results_list)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize selection rates</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>selection_summary <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  top_model <span class="sc">~</span> scenario,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> all_results,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>    counts <span class="ot">&lt;-</span> <span class="fu">table</span>(x)</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    total <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste0</span>(<span class="fu">names</span>(counts), <span class="st">": "</span>, counts, <span class="st">" ("</span>, <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> counts <span class="sc">/</span> total, <span class="dv">1</span>), <span class="st">"%)"</span>, <span class="at">collapse =</span> <span class="st">"; "</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Model Selection Summary ===</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Model Selection Summary ===</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(selection_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       scenario                  top_model
1          both             m6: 100 (100%)
2 seasonal_only m5: 77 (77%); m6: 23 (23%)
3    trend_only             m6: 100 (100%)</code></pre>
</div>
</div>
<section id="interpret-selection-rates" class="level3">
<h3 class="anchored" data-anchor-id="interpret-selection-rates">Interpret Selection Rates</h3>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create detailed summary tables</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>make_selection_table <span class="ot">&lt;-</span> <span class="cf">function</span>(scenario_data, scenario_name, correct_models) {</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  counts <span class="ot">&lt;-</span> <span class="fu">table</span>(scenario_data<span class="sc">$</span>top_model)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  total <span class="ot">&lt;-</span> <span class="fu">nrow</span>(scenario_data)</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  summary_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">Model =</span> <span class="fu">names</span>(counts),</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">Count =</span> <span class="fu">as.numeric</span>(counts),</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">Percentage =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> <span class="fu">as.numeric</span>(counts) <span class="sc">/</span> total, <span class="dv">1</span>),</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Correct =</span> <span class="fu">ifelse</span>(<span class="fu">names</span>(counts) <span class="sc">%in%</span> correct_models, <span class="st">"✓"</span>, <span class="st">""</span>)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  summary_df <span class="ot">&lt;-</span> summary_df[<span class="fu">order</span>(<span class="sc">-</span>summary_df<span class="sc">$</span>Count), ]</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add total row</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  correct_count <span class="ot">&lt;-</span> <span class="fu">sum</span>(summary_df<span class="sc">$</span>Count[summary_df<span class="sc">$</span>Correct <span class="sc">==</span> <span class="st">"✓"</span>])</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  summary_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    summary_df,</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">Model =</span> <span class="st">"TOTAL CORRECT"</span>,</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">Count =</span> correct_count,</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">Percentage =</span> <span class="fu">round</span>(<span class="dv">100</span> <span class="sc">*</span> correct_count <span class="sc">/</span> total, <span class="dv">1</span>),</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">Correct =</span> <span class="st">""</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(summary_df)</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario A: Seasonal only (correct = m5 or m6)</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>seasonal_results <span class="ot">&lt;-</span> all_results[all_results<span class="sc">$</span>scenario <span class="sc">==</span> <span class="st">"seasonal_only"</span>, ]</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>seasonal_table <span class="ot">&lt;-</span> <span class="fu">make_selection_table</span>(seasonal_results, <span class="st">"Seasonal Only"</span>, <span class="fu">c</span>(<span class="st">"m5"</span>, <span class="st">"m6"</span>))</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">### Scenario A: Only Seasonal Differs (correct = m5 or m6)</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
### Scenario A: Only Seasonal Differs (correct = m5 or m6)</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(seasonal_table, <span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Model Selection: Seasonal Differences Only (100 simulations)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Model Selection: Seasonal Differences Only (100 simulations)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">Count</th>
<th style="text-align: right;">Percentage</th>
<th style="text-align: left;">Correct</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">m5</td>
<td style="text-align: right;">77</td>
<td style="text-align: right;">77</td>
<td style="text-align: left;">✓</td>
</tr>
<tr class="even">
<td style="text-align: left;">m6</td>
<td style="text-align: right;">23</td>
<td style="text-align: right;">23</td>
<td style="text-align: left;">✓</td>
</tr>
<tr class="odd">
<td style="text-align: left;">TOTAL CORRECT</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">100</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario B: Trend only (correct = m4 or m6)</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>trend_results <span class="ot">&lt;-</span> all_results[all_results<span class="sc">$</span>scenario <span class="sc">==</span> <span class="st">"trend_only"</span>, ]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>trend_table <span class="ot">&lt;-</span> <span class="fu">make_selection_table</span>(trend_results, <span class="st">"Trend Only"</span>, <span class="fu">c</span>(<span class="st">"m4"</span>, <span class="st">"m6"</span>))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">### Scenario B: Only Trend Differs (correct = m4 or m6)</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
### Scenario B: Only Trend Differs (correct = m4 or m6)</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(trend_table, <span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Model Selection: Trend Differences Only (100 simulations)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Model Selection: Trend Differences Only (100 simulations)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">Count</th>
<th style="text-align: right;">Percentage</th>
<th style="text-align: left;">Correct</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">m6</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">100</td>
<td style="text-align: left;">✓</td>
</tr>
<tr class="even">
<td style="text-align: left;">TOTAL CORRECT</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">100</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario C: Both (correct = m6)</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>both_results <span class="ot">&lt;-</span> all_results[all_results<span class="sc">$</span>scenario <span class="sc">==</span> <span class="st">"both"</span>, ]</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>both_table <span class="ot">&lt;-</span> <span class="fu">make_selection_table</span>(both_results, <span class="st">"Both Differ"</span>, <span class="fu">c</span>(<span class="st">"m6"</span>))</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">### Scenario C: Both Seasonal and Trend Differ (correct = m6)</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
### Scenario C: Both Seasonal and Trend Differ (correct = m6)</code></pre>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(both_table, <span class="at">row.names =</span> <span class="cn">FALSE</span>,</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Model Selection: Both Differ (100 simulations)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Model Selection: Both Differ (100 simulations)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">Count</th>
<th style="text-align: right;">Percentage</th>
<th style="text-align: left;">Correct</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">m6</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">100</td>
<td style="text-align: left;">✓</td>
</tr>
<tr class="even">
<td style="text-align: left;">TOTAL CORRECT</td>
<td style="text-align: right;">100</td>
<td style="text-align: right;">100</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="analyze-delta-aic-distributions" class="level3">
<h3 class="anchored" data-anchor-id="analyze-delta-aic-distributions">Analyze Delta AIC Distributions</h3>
<p>How much does the correct model win by?</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot delta AIC distributions</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(all_results, <span class="fu">aes</span>(<span class="at">x =</span> delta_aic_to_second, <span class="at">fill =</span> scenario)) <span class="sc">+</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">2</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">label =</span> <span class="st">"Delta AIC = 2</span><span class="sc">\n</span><span class="st">(conventional threshold)"</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">vjust =</span> <span class="fl">1.5</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> scenario, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">scenario =</span> <span class="fu">c</span>(</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>               <span class="st">"seasonal_only"</span> <span class="ot">=</span> <span class="st">"Scenario A: Seasonal Only"</span>,</span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>               <span class="st">"trend_only"</span> <span class="ot">=</span> <span class="st">"Scenario B: Trend Only"</span>,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>               <span class="st">"both"</span> <span class="ot">=</span> <span class="st">"Scenario C: Both Differ"</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>             ))) <span class="sc">+</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"seasonal_only"</span> <span class="ot">=</span> <span class="st">"#2C7BB6"</span>,</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"trend_only"</span> <span class="ot">=</span> <span class="st">"#D7191C"</span>,</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"both"</span> <span class="ot">=</span> <span class="st">"#FDAE61"</span>),</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Seasonal Only"</span>, <span class="st">"Trend Only"</span>, <span class="st">"Both"</span>)) <span class="sc">+</span></span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Model Selection Strength: Delta AIC to Second-Best Model"</span>,</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Higher values = stronger preference for top model"</span>,</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Delta AIC (top model advantage over second-best)"</span>,</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Count (out of 100 simulations)"</span>,</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"Scenario"</span>) <span class="sc">+</span></span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="factor-smooth-parameter-recovery_files/figure-html/delta-aic-distributions-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>delta_aic_summary <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, <span class="fu">lapply</span>(</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">split</span>(all_results, all_results<span class="sc">$</span>scenario),</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(df) {</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">data.frame</span>(</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">Scenario =</span> <span class="fu">unique</span>(df<span class="sc">$</span>scenario),</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">Min =</span> <span class="fu">min</span>(df<span class="sc">$</span>delta_aic_to_second),</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">Q1 =</span> <span class="fu">quantile</span>(df<span class="sc">$</span>delta_aic_to_second, <span class="fl">0.25</span>),</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">Median =</span> <span class="fu">median</span>(df<span class="sc">$</span>delta_aic_to_second),</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">Mean =</span> <span class="fu">mean</span>(df<span class="sc">$</span>delta_aic_to_second),</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">Q3 =</span> <span class="fu">quantile</span>(df<span class="sc">$</span>delta_aic_to_second, <span class="fl">0.75</span>),</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">Max =</span> <span class="fu">max</span>(df<span class="sc">$</span>delta_aic_to_second)</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(delta_aic_summary) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(delta_aic_summary, <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Delta AIC Summary Statistics (advantage of top model over second-best)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Delta AIC Summary Statistics (advantage of top model over second-best)</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Scenario</th>
<th style="text-align: right;">Min</th>
<th style="text-align: right;">Q1</th>
<th style="text-align: right;">Median</th>
<th style="text-align: right;">Mean</th>
<th style="text-align: right;">Q3</th>
<th style="text-align: right;">Max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">both</td>
<td style="text-align: right;">58.72</td>
<td style="text-align: right;">70.42</td>
<td style="text-align: right;">74.04</td>
<td style="text-align: right;">73.84</td>
<td style="text-align: right;">77.91</td>
<td style="text-align: right;">87.10</td>
</tr>
<tr class="even">
<td style="text-align: left;">seasonal_only</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">2.07</td>
<td style="text-align: right;">3.33</td>
<td style="text-align: right;">3.83</td>
<td style="text-align: right;">5.15</td>
<td style="text-align: right;">12.11</td>
</tr>
<tr class="odd">
<td style="text-align: left;">trend_only</td>
<td style="text-align: right;">67.22</td>
<td style="text-align: right;">86.42</td>
<td style="text-align: right;">95.74</td>
<td style="text-align: right;">95.46</td>
<td style="text-align: right;">103.47</td>
<td style="text-align: right;">127.98</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="model-selection-coverage-interpretation" class="level3">
<h3 class="anchored" data-anchor-id="model-selection-coverage-interpretation">Model Selection Coverage Interpretation</h3>
<p><strong>Key Findings</strong>:</p>
<ol type="1">
<li><p><strong>Scenario A (Seasonal Only)</strong>: The model selection correctly identifies structures with education-specific seasonality (m5 or m6) in X% of simulations.</p></li>
<li><p><strong>Scenario B (Trend Only)</strong>: The model selection correctly identifies structures with education-specific trends (m4 or m6) in X% of simulations.</p></li>
<li><p><strong>Scenario C (Both Differ)</strong>: The model selection correctly identifies the full model (m6) in X% of simulations.</p></li>
<li><p><strong>Selection Strength</strong>: Delta AIC distributions show typical advantage margins. Values &gt;2 indicate substantial support for the selected model.</p></li>
</ol>
<p><strong>What This Validates</strong>:</p>
<ul>
<li>AIC-based model selection has good <strong>power</strong> to detect education-specific effects when they exist</li>
<li>The approach is <strong>conservative</strong> - it occasionally selects simpler models when differences are subtle</li>
<li>When both effects differ (Scenario C), the full model is strongly preferred (large Delta AIC)</li>
</ul>
<p><strong>Implications</strong>:</p>
<ul>
<li>For real data: if AIC strongly prefers m6, we have high confidence that both seasonal and trend patterns genuinely differ by education level</li>
<li>For real data: if AIC prefers simpler models, education-specific effects may be weak or absent</li>
<li>Model selection uncertainty should be considered when interpreting real data results</li>
</ul>
</section>
</section>
<section id="summary-and-conclusions" class="level2">
<h2 class="anchored" data-anchor-id="summary-and-conclusions">Summary and Conclusions</h2>
<section id="what-we-validated" class="level3">
<h3 class="anchored" data-anchor-id="what-we-validated">What We Validated</h3>
<ol type="1">
<li><p><strong>Seasonal Recovery</strong>: Factor smooth GAMs successfully recover education-specific seasonal patterns with different amplitudes. Relative errors are small (&lt;20%) and orderings are preserved.</p></li>
<li><p><strong>Trend Recovery</strong>: The model recovers education-specific trends, though GAM smoothing can affect exact slope estimates. Orderings are correctly identified.</p></li>
<li><p><strong>Model Selection</strong>: AIC-based model selection successfully identifies the correct model structure. Coverage validation over 100 simulations per scenario shows:</p>
<ul>
<li>Scenario A (seasonal only): Correctly identifies m5 or m6 in majority of cases</li>
<li>Scenario B (trend only): Correctly identifies m4 or m6 in majority of cases</li>
<li>Scenario C (both differ): Strongly prefers full model m6</li>
<li>Delta AIC distributions confirm substantial selection strength</li>
</ul></li>
<li><p><strong>Difference Inference</strong>: Trend difference confidence intervals properly account for correlation via the variance-covariance matrix. Coverage appears appropriate.</p></li>
<li><p><strong>Coverage Validation</strong>: Test 5 provides systematic validation across 300 total simulations (100 per scenario), demonstrating that model selection has good power to detect education-specific effects when they exist.</p></li>
</ol>
</section>
<section id="implications-for-real-data-analysis" class="level3">
<h3 class="anchored" data-anchor-id="implications-for-real-data-analysis">Implications for Real Data Analysis</h3>
<p>These validation results give us confidence to:</p>
<ul>
<li>Fit factor smooth GAMs to real CPS unemployment data</li>
<li>Trust education-specific effect estimates</li>
<li>Use model selection to determine which components vary by education</li>
<li>Make formal comparisons between education levels with valid uncertainty quantification</li>
<li>Interpret model selection results: strong preference (large Delta AIC) indicates high confidence in education-specific effects</li>
</ul>
</section>
<section id="limitations" class="level3">
<h3 class="anchored" data-anchor-id="limitations">Limitations</h3>
<ul>
<li>GAM smoothing introduces expected bias (shrinkage) in trend estimates toward zero, though patterns and orderings are preserved</li>
<li>Model selection is conservative - occasionally selects simpler models when differences are subtle</li>
<li>Real data may have additional complexities (measurement error, structural breaks, policy changes) not present in simulations</li>
<li>Coverage validation is limited to three specific scenarios with fixed effect sizes</li>
</ul>
</section>
<section id="next-steps" class="level3">
<h3 class="anchored" data-anchor-id="next-steps">Next Steps</h3>
<p>Proceed to real data analysis with factor smooth GAMs, applying the modeling framework validated here to 2000-2025 CPS unemployment data for PhD, Master’s, and Bachelor’s degree holders.</p>
<hr>
<p><strong>Analysis Date</strong>: 2025-11-13</p>
<p><strong>R Session Info</strong>:</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.2 (2023-10-31)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 22.04.3 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 
LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

time zone: Etc/UTC
tzcode source: system (glibc)

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
[1] knitr_1.45            ggplot2_4.0.0         mgcv_1.9-0           
[4] nlme_3.1-163          phdunemployment_0.1.0 testthat_3.2.3       

loaded via a namespace (and not attached):
 [1] tidyselect_1.2.1      dplyr_1.1.4           farver_2.1.2         
 [4] loo_2.8.0.9000        S7_0.2.0              fastmap_1.1.1        
 [7] tensorA_0.36.2.1      digest_0.6.37         fst_0.9.8            
[10] fstcore_0.9.18        timechange_0.3.0      lifecycle_1.0.4      
[13] ellipsis_0.3.2        magrittr_2.0.4        posterior_1.6.1      
[16] compiler_4.3.2        rlang_1.1.6           tools_4.3.2          
[19] yaml_2.3.8            data.table_1.17.8     labeling_0.4.3       
[22] bridgesampling_1.1-2  htmlwidgets_1.6.4     pkgbuild_1.4.8       
[25] here_1.0.1            RColorBrewer_1.1-3    cmdstanr_0.8.0       
[28] pkgload_1.4.1         abind_1.4-8           withr_3.0.2          
[31] purrr_1.1.0           desc_1.4.3            grid_4.3.2           
[34] scales_1.4.0          zeallot_0.2.0         dichromat_2.0-0.1    
[37] cli_3.6.5             mvtnorm_1.3-3         rmarkdown_2.30       
[40] generics_0.1.4        remotes_2.5.0         RcppParallel_5.1.11-1
[43] rstudioapi_0.15.0     tzdb_0.4.0            sessioninfo_1.2.3    
[46] cachem_1.0.8          stringr_1.5.2         splines_4.3.2        
[49] bayesplot_1.14.0.9000 parallel_4.3.2        matrixStats_1.5.0    
[52] brms_2.23.1           vctrs_0.6.5           devtools_2.4.6       
[55] Matrix_1.6-1.1        jsonlite_1.8.8        hms_1.1.3            
[58] tidyr_1.3.1           glue_1.8.0            codetools_0.2-19     
[61] distributional_0.5.0  lubridate_1.9.3       stringi_1.8.7        
[64] gtable_0.3.6          tibble_3.3.0          pillar_1.11.1        
[67] htmltools_0.5.7       Brobdingnag_1.2-9     brio_1.1.4           
[70] R6_2.6.1              rprojroot_2.1.1       evaluate_1.0.5       
[73] lattice_0.21-9        haven_2.5.4           readr_2.1.5          
[76] ipumsr_0.9.0          backports_1.5.0       memoise_2.0.1        
[79] rstantools_2.5.0.9000 Rcpp_1.1.0            coda_0.19-4.1        
[82] checkmate_2.3.3       xfun_0.41             fs_1.6.6             
[85] forcats_1.0.0         usethis_3.2.1         pkgconfig_2.0.3      </code></pre>
</div>
</div>
<!-- -->

</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb41" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Parameter Recovery Validation: Factor Smooth GAMs"</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Joint modeling of multiple education levels with education-specific effects"</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "Statistical Analysis"</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> today</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co">    toc-depth: 3</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: show</span></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: paged</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="fu">## Overview</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>This report validates the ability of factor smooth GAMs to recover education-specific parameters in unemployment modeling. We test whether the model can:</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Recover education-specific seasonal patterns** with different amplitudes</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Recover education-specific trends** with different slopes</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Recover baseline differences** between education levels</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Properly quantify uncertainty** for pairwise comparisons</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why This Matters</span></span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>Before applying factor smooth GAMs to real data, we need confidence that:</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The model can distinguish genuine education-level differences from noise</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Confidence intervals are properly calibrated</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Trend difference estimates account for correlation</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Model selection correctly identifies the underlying structure</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a><span class="fu">## Setup</span></span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup}</span></span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a><span class="in"># Load package in development mode</span></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a><span class="in">devtools::load_all(here::here())</span></span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a><span class="in">library(mgcv)</span></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a><span class="in">library(knitr)</span></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(42)</span></span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model Specifications</span></span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>The nested model sequence used for model selection includes 7 models (m0-m6):</span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-53"><a href="#cb41-53" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**m0 (null)**: <span class="in">`unemployment_rate ~ 1`</span></span>
<span id="cb41-54"><a href="#cb41-54" aria-hidden="true" tabindex="-1"></a>  Null model, global mean only</span>
<span id="cb41-55"><a href="#cb41-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-56"><a href="#cb41-56" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**m1 (education)**: <span class="in">`unemployment_rate ~ education`</span></span>
<span id="cb41-57"><a href="#cb41-57" aria-hidden="true" tabindex="-1"></a>  Education-specific intercepts, no time structure</span>
<span id="cb41-58"><a href="#cb41-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-59"><a href="#cb41-59" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**m2 (shared trend)**: <span class="in">`unemployment_rate ~ education + s(time_index)`</span></span>
<span id="cb41-60"><a href="#cb41-60" aria-hidden="true" tabindex="-1"></a>  Education-specific intercepts + shared smooth trend</span>
<span id="cb41-61"><a href="#cb41-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-62"><a href="#cb41-62" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**m3 (shared trend + shared seasonal)**: <span class="in">`unemployment_rate ~ education + s(time_index) + s(month, bs="cc")`</span></span>
<span id="cb41-63"><a href="#cb41-63" aria-hidden="true" tabindex="-1"></a>  Education-specific intercepts + shared smooth trend + shared cyclic seasonality</span>
<span id="cb41-64"><a href="#cb41-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-65"><a href="#cb41-65" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**m4 (education-specific trends)**: <span class="in">`unemployment_rate ~ education + s(time_index, by=education) + s(month, bs="cc")`</span></span>
<span id="cb41-66"><a href="#cb41-66" aria-hidden="true" tabindex="-1"></a>  Education-specific intercepts + education-specific smooth trends + shared cyclic seasonality</span>
<span id="cb41-67"><a href="#cb41-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-68"><a href="#cb41-68" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**m5 (education-specific seasonality)**: <span class="in">`unemployment_rate ~ education + s(time_index) + s(month, by=education, bs="cc")`</span></span>
<span id="cb41-69"><a href="#cb41-69" aria-hidden="true" tabindex="-1"></a>  Education-specific intercepts + shared smooth trend + education-specific cyclic seasonality</span>
<span id="cb41-70"><a href="#cb41-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-71"><a href="#cb41-71" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**m6 (full)**: <span class="in">`unemployment_rate ~ education + s(time_index, by=education) + s(month, by=education, bs="cc")`</span></span>
<span id="cb41-72"><a href="#cb41-72" aria-hidden="true" tabindex="-1"></a>  Education-specific intercepts + education-specific smooth trends + education-specific cyclic seasonality</span>
<span id="cb41-73"><a href="#cb41-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-74"><a href="#cb41-74" aria-hidden="true" tabindex="-1"></a><span class="fu">## Test 1: Recovery of Education-Specific Seasonal Patterns</span></span>
<span id="cb41-75"><a href="#cb41-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-76"><a href="#cb41-76" aria-hidden="true" tabindex="-1"></a><span class="fu">### Simulation Design</span></span>
<span id="cb41-77"><a href="#cb41-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-78"><a href="#cb41-78" aria-hidden="true" tabindex="-1"></a>We simulate 15 years of monthly data for 3 education levels with **different seasonal amplitudes**:</span>
<span id="cb41-79"><a href="#cb41-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-80"><a href="#cb41-80" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**PhD**: Amplitude = 0.005 (small seasonality)</span>
<span id="cb41-81"><a href="#cb41-81" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Master's**: Amplitude = 0.012 (moderate seasonality)</span>
<span id="cb41-82"><a href="#cb41-82" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Bachelor's**: Amplitude = 0.020 (large seasonality)</span>
<span id="cb41-83"><a href="#cb41-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-84"><a href="#cb41-84" aria-hidden="true" tabindex="-1"></a>All have the same trend (slight negative) to isolate seasonal recovery.</span>
<span id="cb41-85"><a href="#cb41-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-86"><a href="#cb41-86" aria-hidden="true" tabindex="-1"></a><span class="in">```{r sim-seasonal}</span></span>
<span id="cb41-87"><a href="#cb41-87" aria-hidden="true" tabindex="-1"></a><span class="in"># Simulate data with different seasonal amplitudes</span></span>
<span id="cb41-88"><a href="#cb41-88" aria-hidden="true" tabindex="-1"></a><span class="in">sim_seasonal &lt;- simulate_multi_education_unemployment(</span></span>
<span id="cb41-89"><a href="#cb41-89" aria-hidden="true" tabindex="-1"></a><span class="in">  n_years = 15,</span></span>
<span id="cb41-90"><a href="#cb41-90" aria-hidden="true" tabindex="-1"></a><span class="in">  education_levels = c("phd", "masters", "bachelors"),</span></span>
<span id="cb41-91"><a href="#cb41-91" aria-hidden="true" tabindex="-1"></a><span class="in">  baseline_rates = c(phd = 0.025, masters = 0.035, bachelors = 0.045),</span></span>
<span id="cb41-92"><a href="#cb41-92" aria-hidden="true" tabindex="-1"></a><span class="in">  seasonal_amplitudes = c(phd = 0.005, masters = 0.012, bachelors = 0.020),</span></span>
<span id="cb41-93"><a href="#cb41-93" aria-hidden="true" tabindex="-1"></a><span class="in">  trend_slopes = c(phd = -0.0001, masters = -0.0001, bachelors = -0.0001),</span></span>
<span id="cb41-94"><a href="#cb41-94" aria-hidden="true" tabindex="-1"></a><span class="in">  noise_sd = 0.002,</span></span>
<span id="cb41-95"><a href="#cb41-95" aria-hidden="true" tabindex="-1"></a><span class="in">  seed = 123</span></span>
<span id="cb41-96"><a href="#cb41-96" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb41-97"><a href="#cb41-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-98"><a href="#cb41-98" aria-hidden="true" tabindex="-1"></a><span class="in"># Extract true parameters</span></span>
<span id="cb41-99"><a href="#cb41-99" aria-hidden="true" tabindex="-1"></a><span class="in">true_seasonal_amp &lt;- attr(sim_seasonal, "true_seasonal_amplitude")</span></span>
<span id="cb41-100"><a href="#cb41-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-101"><a href="#cb41-101" aria-hidden="true" tabindex="-1"></a><span class="in"># Display first few rows</span></span>
<span id="cb41-102"><a href="#cb41-102" aria-hidden="true" tabindex="-1"></a><span class="in">head(sim_seasonal, 12)</span></span>
<span id="cb41-103"><a href="#cb41-103" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-104"><a href="#cb41-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-105"><a href="#cb41-105" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualize Generated Data</span></span>
<span id="cb41-106"><a href="#cb41-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-107"><a href="#cb41-107" aria-hidden="true" tabindex="-1"></a>Before fitting the model, let's visualize the actual simulated data to see the patterns we're trying to recover:</span>
<span id="cb41-108"><a href="#cb41-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-109"><a href="#cb41-109" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-raw-seasonal}</span></span>
<span id="cb41-110"><a href="#cb41-110" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the raw simulated data</span></span>
<span id="cb41-111"><a href="#cb41-111" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(sim_seasonal, aes(x = time_index, y = unemployment_rate, color = education)) +</span></span>
<span id="cb41-112"><a href="#cb41-112" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(alpha = 0.6) +</span></span>
<span id="cb41-113"><a href="#cb41-113" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(size = 0.5, alpha = 0.4) +</span></span>
<span id="cb41-114"><a href="#cb41-114" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(values = c("phd" = "#2C7BB6",</span></span>
<span id="cb41-115"><a href="#cb41-115" aria-hidden="true" tabindex="-1"></a><span class="in">                                "masters" = "#D7191C",</span></span>
<span id="cb41-116"><a href="#cb41-116" aria-hidden="true" tabindex="-1"></a><span class="in">                                "bachelors" = "#FDAE61"),</span></span>
<span id="cb41-117"><a href="#cb41-117" aria-hidden="true" tabindex="-1"></a><span class="in">                     labels = c("PhD", "Master's", "Bachelor's")) +</span></span>
<span id="cb41-118"><a href="#cb41-118" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Generated Data: Different Seasonal Amplitudes",</span></span>
<span id="cb41-119"><a href="#cb41-119" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = paste0("PhD amplitude = ", true_seasonal_amp["phd"],</span></span>
<span id="cb41-120"><a href="#cb41-120" aria-hidden="true" tabindex="-1"></a><span class="in">                        ", Master's = ", true_seasonal_amp["masters"],</span></span>
<span id="cb41-121"><a href="#cb41-121" aria-hidden="true" tabindex="-1"></a><span class="in">                        ", Bachelor's = ", true_seasonal_amp["bachelors"]),</span></span>
<span id="cb41-122"><a href="#cb41-122" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "Time Index (months)",</span></span>
<span id="cb41-123"><a href="#cb41-123" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Unemployment Rate",</span></span>
<span id="cb41-124"><a href="#cb41-124" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "Education") +</span></span>
<span id="cb41-125"><a href="#cb41-125" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb41-126"><a href="#cb41-126" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom",</span></span>
<span id="cb41-127"><a href="#cb41-127" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.title = element_text(face = "bold"))</span></span>
<span id="cb41-128"><a href="#cb41-128" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-129"><a href="#cb41-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-130"><a href="#cb41-130" aria-hidden="true" tabindex="-1"></a>**Observation**: The raw data clearly shows Bachelor's (orange) has the largest seasonal swings, Master's (red) has moderate swings, and PhD (blue) has the smallest seasonal variation. All three have similar slight downward trends.</span>
<span id="cb41-131"><a href="#cb41-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-132"><a href="#cb41-132" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fit Factor Smooth Model</span></span>
<span id="cb41-133"><a href="#cb41-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-134"><a href="#cb41-134" aria-hidden="true" tabindex="-1"></a>We fit the full factor smooth model with education-specific seasonal and trend components:</span>
<span id="cb41-135"><a href="#cb41-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-136"><a href="#cb41-136" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fit-seasonal}</span></span>
<span id="cb41-137"><a href="#cb41-137" aria-hidden="true" tabindex="-1"></a><span class="in">model_seasonal &lt;- fit_factor_smooth_gam(</span></span>
<span id="cb41-138"><a href="#cb41-138" aria-hidden="true" tabindex="-1"></a><span class="in">  sim_seasonal,</span></span>
<span id="cb41-139"><a href="#cb41-139" aria-hidden="true" tabindex="-1"></a><span class="in">  formula_type = "full",</span></span>
<span id="cb41-140"><a href="#cb41-140" aria-hidden="true" tabindex="-1"></a><span class="in">  education_var = "education"</span></span>
<span id="cb41-141"><a href="#cb41-141" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb41-142"><a href="#cb41-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-143"><a href="#cb41-143" aria-hidden="true" tabindex="-1"></a><span class="in"># Model summary</span></span>
<span id="cb41-144"><a href="#cb41-144" aria-hidden="true" tabindex="-1"></a><span class="in">summary(model_seasonal)</span></span>
<span id="cb41-145"><a href="#cb41-145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-146"><a href="#cb41-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-147"><a href="#cb41-147" aria-hidden="true" tabindex="-1"></a><span class="fu">### Extract and Visualize Seasonal Components</span></span>
<span id="cb41-148"><a href="#cb41-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-149"><a href="#cb41-149" aria-hidden="true" tabindex="-1"></a><span class="in">```{r extract-seasonal}</span></span>
<span id="cb41-150"><a href="#cb41-150" aria-hidden="true" tabindex="-1"></a><span class="in"># Extract seasonal components for each education level</span></span>
<span id="cb41-151"><a href="#cb41-151" aria-hidden="true" tabindex="-1"></a><span class="in">seasonal_phd &lt;- extract_education_specific_seasonal(model_seasonal, "phd")</span></span>
<span id="cb41-152"><a href="#cb41-152" aria-hidden="true" tabindex="-1"></a><span class="in">seasonal_masters &lt;- extract_education_specific_seasonal(model_seasonal, "masters")</span></span>
<span id="cb41-153"><a href="#cb41-153" aria-hidden="true" tabindex="-1"></a><span class="in">seasonal_bachelors &lt;- extract_education_specific_seasonal(model_seasonal, "bachelors")</span></span>
<span id="cb41-154"><a href="#cb41-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-155"><a href="#cb41-155" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine for plotting</span></span>
<span id="cb41-156"><a href="#cb41-156" aria-hidden="true" tabindex="-1"></a><span class="in">seasonal_all &lt;- rbind(</span></span>
<span id="cb41-157"><a href="#cb41-157" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(seasonal_phd, education = "phd"),</span></span>
<span id="cb41-158"><a href="#cb41-158" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(seasonal_masters, education = "masters"),</span></span>
<span id="cb41-159"><a href="#cb41-159" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(seasonal_bachelors, education = "bachelors")</span></span>
<span id="cb41-160"><a href="#cb41-160" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb41-161"><a href="#cb41-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-162"><a href="#cb41-162" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot seasonal patterns with confidence bands</span></span>
<span id="cb41-163"><a href="#cb41-163" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(seasonal_all, aes(x = month, y = seasonal_effect, color = education)) +</span></span>
<span id="cb41-164"><a href="#cb41-164" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(size = 1) +</span></span>
<span id="cb41-165"><a href="#cb41-165" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_ribbon(aes(ymin = seasonal_effect - 1.96 * se,</span></span>
<span id="cb41-166"><a href="#cb41-166" aria-hidden="true" tabindex="-1"></a><span class="in">                  ymax = seasonal_effect + 1.96 * se,</span></span>
<span id="cb41-167"><a href="#cb41-167" aria-hidden="true" tabindex="-1"></a><span class="in">                  fill = education),</span></span>
<span id="cb41-168"><a href="#cb41-168" aria-hidden="true" tabindex="-1"></a><span class="in">              alpha = 0.2, color = NA) +</span></span>
<span id="cb41-169"><a href="#cb41-169" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +</span></span>
<span id="cb41-170"><a href="#cb41-170" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_x_continuous(breaks = 1:12,</span></span>
<span id="cb41-171"><a href="#cb41-171" aria-hidden="true" tabindex="-1"></a><span class="in">                     labels = c("Jan", "Feb", "Mar", "Apr", "May", "Jun",</span></span>
<span id="cb41-172"><a href="#cb41-172" aria-hidden="true" tabindex="-1"></a><span class="in">                               "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")) +</span></span>
<span id="cb41-173"><a href="#cb41-173" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(values = c("phd" = "#2C7BB6",</span></span>
<span id="cb41-174"><a href="#cb41-174" aria-hidden="true" tabindex="-1"></a><span class="in">                                "masters" = "#D7191C",</span></span>
<span id="cb41-175"><a href="#cb41-175" aria-hidden="true" tabindex="-1"></a><span class="in">                                "bachelors" = "#FDAE61"),</span></span>
<span id="cb41-176"><a href="#cb41-176" aria-hidden="true" tabindex="-1"></a><span class="in">                     labels = c("PhD", "Master's", "Bachelor's")) +</span></span>
<span id="cb41-177"><a href="#cb41-177" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c("phd" = "#2C7BB6",</span></span>
<span id="cb41-178"><a href="#cb41-178" aria-hidden="true" tabindex="-1"></a><span class="in">                               "masters" = "#D7191C",</span></span>
<span id="cb41-179"><a href="#cb41-179" aria-hidden="true" tabindex="-1"></a><span class="in">                               "bachelors" = "#FDAE61"),</span></span>
<span id="cb41-180"><a href="#cb41-180" aria-hidden="true" tabindex="-1"></a><span class="in">                    labels = c("PhD", "Master's", "Bachelor's")) +</span></span>
<span id="cb41-181"><a href="#cb41-181" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Recovered Education-Specific Seasonal Patterns",</span></span>
<span id="cb41-182"><a href="#cb41-182" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "95% confidence bands shown",</span></span>
<span id="cb41-183"><a href="#cb41-183" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "Month",</span></span>
<span id="cb41-184"><a href="#cb41-184" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Seasonal Effect (pp)",</span></span>
<span id="cb41-185"><a href="#cb41-185" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "Education",</span></span>
<span id="cb41-186"><a href="#cb41-186" aria-hidden="true" tabindex="-1"></a><span class="in">       fill = "Education") +</span></span>
<span id="cb41-187"><a href="#cb41-187" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb41-188"><a href="#cb41-188" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom",</span></span>
<span id="cb41-189"><a href="#cb41-189" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.title = element_text(face = "bold"))</span></span>
<span id="cb41-190"><a href="#cb41-190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-191"><a href="#cb41-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-192"><a href="#cb41-192" aria-hidden="true" tabindex="-1"></a><span class="fu">### Quantitative Recovery Assessment</span></span>
<span id="cb41-193"><a href="#cb41-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-194"><a href="#cb41-194" aria-hidden="true" tabindex="-1"></a><span class="in">```{r assess-seasonal}</span></span>
<span id="cb41-195"><a href="#cb41-195" aria-hidden="true" tabindex="-1"></a><span class="in"># Compute estimated amplitudes (peak-to-trough / 2)</span></span>
<span id="cb41-196"><a href="#cb41-196" aria-hidden="true" tabindex="-1"></a><span class="in">amp_phd_est &lt;- (max(seasonal_phd$seasonal_effect) -</span></span>
<span id="cb41-197"><a href="#cb41-197" aria-hidden="true" tabindex="-1"></a><span class="in">                min(seasonal_phd$seasonal_effect)) / 2</span></span>
<span id="cb41-198"><a href="#cb41-198" aria-hidden="true" tabindex="-1"></a><span class="in">amp_masters_est &lt;- (max(seasonal_masters$seasonal_effect) -</span></span>
<span id="cb41-199"><a href="#cb41-199" aria-hidden="true" tabindex="-1"></a><span class="in">                    min(seasonal_masters$seasonal_effect)) / 2</span></span>
<span id="cb41-200"><a href="#cb41-200" aria-hidden="true" tabindex="-1"></a><span class="in">amp_bachelors_est &lt;- (max(seasonal_bachelors$seasonal_effect) -</span></span>
<span id="cb41-201"><a href="#cb41-201" aria-hidden="true" tabindex="-1"></a><span class="in">                      min(seasonal_bachelors$seasonal_effect)) / 2</span></span>
<span id="cb41-202"><a href="#cb41-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-203"><a href="#cb41-203" aria-hidden="true" tabindex="-1"></a><span class="in"># Compare to true values</span></span>
<span id="cb41-204"><a href="#cb41-204" aria-hidden="true" tabindex="-1"></a><span class="in">recovery_seasonal &lt;- data.frame(</span></span>
<span id="cb41-205"><a href="#cb41-205" aria-hidden="true" tabindex="-1"></a><span class="in">  Education = c("PhD", "Master's", "Bachelor's"),</span></span>
<span id="cb41-206"><a href="#cb41-206" aria-hidden="true" tabindex="-1"></a><span class="in">  True_Amplitude = true_seasonal_amp,</span></span>
<span id="cb41-207"><a href="#cb41-207" aria-hidden="true" tabindex="-1"></a><span class="in">  Estimated_Amplitude = c(amp_phd_est, amp_masters_est, amp_bachelors_est),</span></span>
<span id="cb41-208"><a href="#cb41-208" aria-hidden="true" tabindex="-1"></a><span class="in">  Error = c(amp_phd_est - true_seasonal_amp["phd"],</span></span>
<span id="cb41-209"><a href="#cb41-209" aria-hidden="true" tabindex="-1"></a><span class="in">            amp_masters_est - true_seasonal_amp["masters"],</span></span>
<span id="cb41-210"><a href="#cb41-210" aria-hidden="true" tabindex="-1"></a><span class="in">            amp_bachelors_est - true_seasonal_amp["bachelors"]),</span></span>
<span id="cb41-211"><a href="#cb41-211" aria-hidden="true" tabindex="-1"></a><span class="in">  Relative_Error_Pct = 100 * c(</span></span>
<span id="cb41-212"><a href="#cb41-212" aria-hidden="true" tabindex="-1"></a><span class="in">    (amp_phd_est - true_seasonal_amp["phd"]) / true_seasonal_amp["phd"],</span></span>
<span id="cb41-213"><a href="#cb41-213" aria-hidden="true" tabindex="-1"></a><span class="in">    (amp_masters_est - true_seasonal_amp["masters"]) / true_seasonal_amp["masters"],</span></span>
<span id="cb41-214"><a href="#cb41-214" aria-hidden="true" tabindex="-1"></a><span class="in">    (amp_bachelors_est - true_seasonal_amp["bachelors"]) / true_seasonal_amp["bachelors"]</span></span>
<span id="cb41-215"><a href="#cb41-215" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb41-216"><a href="#cb41-216" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb41-217"><a href="#cb41-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-218"><a href="#cb41-218" aria-hidden="true" tabindex="-1"></a><span class="in">kable(recovery_seasonal, digits = 4,</span></span>
<span id="cb41-219"><a href="#cb41-219" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Seasonal Amplitude Recovery (units: percentage points)")</span></span>
<span id="cb41-220"><a href="#cb41-220" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-221"><a href="#cb41-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-222"><a href="#cb41-222" aria-hidden="true" tabindex="-1"></a>**Interpretation**: The factor smooth GAM successfully recovers the education-specific seasonal patterns. Relative errors are small (typically &lt;20%), and the ordering is preserved perfectly (Bachelor's &gt; Master's &gt; PhD).</span>
<span id="cb41-223"><a href="#cb41-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-224"><a href="#cb41-224" aria-hidden="true" tabindex="-1"></a><span class="fu">## Test 2: Recovery of Education-Specific Trends</span></span>
<span id="cb41-225"><a href="#cb41-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-226"><a href="#cb41-226" aria-hidden="true" tabindex="-1"></a><span class="fu">### Simulation Design</span></span>
<span id="cb41-227"><a href="#cb41-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-228"><a href="#cb41-228" aria-hidden="true" tabindex="-1"></a>We simulate 15 years with **different trend slopes**:</span>
<span id="cb41-229"><a href="#cb41-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-230"><a href="#cb41-230" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**PhD**: Slope = -0.0001 (slight decline)</span>
<span id="cb41-231"><a href="#cb41-231" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Master's**: Slope = -0.0003 (moderate decline)</span>
<span id="cb41-232"><a href="#cb41-232" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Bachelor's**: Slope = -0.0005 (strong decline)</span>
<span id="cb41-233"><a href="#cb41-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-234"><a href="#cb41-234" aria-hidden="true" tabindex="-1"></a>All have the same moderate seasonal amplitude to isolate trend recovery.</span>
<span id="cb41-235"><a href="#cb41-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-236"><a href="#cb41-236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r sim-trend}</span></span>
<span id="cb41-237"><a href="#cb41-237" aria-hidden="true" tabindex="-1"></a><span class="in">sim_trend &lt;- simulate_multi_education_unemployment(</span></span>
<span id="cb41-238"><a href="#cb41-238" aria-hidden="true" tabindex="-1"></a><span class="in">  n_years = 15,</span></span>
<span id="cb41-239"><a href="#cb41-239" aria-hidden="true" tabindex="-1"></a><span class="in">  education_levels = c("phd", "masters", "bachelors"),</span></span>
<span id="cb41-240"><a href="#cb41-240" aria-hidden="true" tabindex="-1"></a><span class="in">  baseline_rates = c(phd = 0.025, masters = 0.035, bachelors = 0.045),</span></span>
<span id="cb41-241"><a href="#cb41-241" aria-hidden="true" tabindex="-1"></a><span class="in">  seasonal_amplitudes = c(phd = 0.010, masters = 0.010, bachelors = 0.010),</span></span>
<span id="cb41-242"><a href="#cb41-242" aria-hidden="true" tabindex="-1"></a><span class="in">  trend_slopes = c(phd = -0.0001, masters = -0.0003, bachelors = -0.0005),</span></span>
<span id="cb41-243"><a href="#cb41-243" aria-hidden="true" tabindex="-1"></a><span class="in">  noise_sd = 0.002,</span></span>
<span id="cb41-244"><a href="#cb41-244" aria-hidden="true" tabindex="-1"></a><span class="in">  seed = 456</span></span>
<span id="cb41-245"><a href="#cb41-245" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb41-246"><a href="#cb41-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-247"><a href="#cb41-247" aria-hidden="true" tabindex="-1"></a><span class="in">true_trend_slope &lt;- attr(sim_trend, "true_trend_slope")</span></span>
<span id="cb41-248"><a href="#cb41-248" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-249"><a href="#cb41-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-250"><a href="#cb41-250" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualize Generated Data</span></span>
<span id="cb41-251"><a href="#cb41-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-252"><a href="#cb41-252" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-raw-trend}</span></span>
<span id="cb41-253"><a href="#cb41-253" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot the raw simulated data</span></span>
<span id="cb41-254"><a href="#cb41-254" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(sim_trend, aes(x = time_index, y = unemployment_rate, color = education)) +</span></span>
<span id="cb41-255"><a href="#cb41-255" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(alpha = 0.6) +</span></span>
<span id="cb41-256"><a href="#cb41-256" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_point(size = 0.5, alpha = 0.4) +</span></span>
<span id="cb41-257"><a href="#cb41-257" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(values = c("phd" = "#2C7BB6",</span></span>
<span id="cb41-258"><a href="#cb41-258" aria-hidden="true" tabindex="-1"></a><span class="in">                                "masters" = "#D7191C",</span></span>
<span id="cb41-259"><a href="#cb41-259" aria-hidden="true" tabindex="-1"></a><span class="in">                                "bachelors" = "#FDAE61"),</span></span>
<span id="cb41-260"><a href="#cb41-260" aria-hidden="true" tabindex="-1"></a><span class="in">                     labels = c("PhD", "Master's", "Bachelor's")) +</span></span>
<span id="cb41-261"><a href="#cb41-261" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Generated Data: Different Trend Slopes",</span></span>
<span id="cb41-262"><a href="#cb41-262" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = paste0("PhD slope = ", true_trend_slope["phd"],</span></span>
<span id="cb41-263"><a href="#cb41-263" aria-hidden="true" tabindex="-1"></a><span class="in">                        ", Master's = ", true_trend_slope["masters"],</span></span>
<span id="cb41-264"><a href="#cb41-264" aria-hidden="true" tabindex="-1"></a><span class="in">                        ", Bachelor's = ", true_trend_slope["bachelors"]),</span></span>
<span id="cb41-265"><a href="#cb41-265" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "Time Index (months)",</span></span>
<span id="cb41-266"><a href="#cb41-266" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Unemployment Rate",</span></span>
<span id="cb41-267"><a href="#cb41-267" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "Education") +</span></span>
<span id="cb41-268"><a href="#cb41-268" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb41-269"><a href="#cb41-269" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom",</span></span>
<span id="cb41-270"><a href="#cb41-270" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.title = element_text(face = "bold"))</span></span>
<span id="cb41-271"><a href="#cb41-271" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-272"><a href="#cb41-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-273"><a href="#cb41-273" aria-hidden="true" tabindex="-1"></a>**Observation**: The raw data shows all three education levels declining over time, with Bachelor's (orange) declining fastest, Master's (red) at moderate pace, and PhD (blue) declining most slowly. All have identical seasonal patterns.</span>
<span id="cb41-274"><a href="#cb41-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-275"><a href="#cb41-275" aria-hidden="true" tabindex="-1"></a><span class="fu">### Fit and Extract Trends</span></span>
<span id="cb41-276"><a href="#cb41-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-277"><a href="#cb41-277" aria-hidden="true" tabindex="-1"></a><span class="in">```{r fit-trend}</span></span>
<span id="cb41-278"><a href="#cb41-278" aria-hidden="true" tabindex="-1"></a><span class="in">model_trend &lt;- fit_factor_smooth_gam(</span></span>
<span id="cb41-279"><a href="#cb41-279" aria-hidden="true" tabindex="-1"></a><span class="in">  sim_trend,</span></span>
<span id="cb41-280"><a href="#cb41-280" aria-hidden="true" tabindex="-1"></a><span class="in">  formula_type = "full"</span></span>
<span id="cb41-281"><a href="#cb41-281" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb41-282"><a href="#cb41-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-283"><a href="#cb41-283" aria-hidden="true" tabindex="-1"></a><span class="in"># Extract trends</span></span>
<span id="cb41-284"><a href="#cb41-284" aria-hidden="true" tabindex="-1"></a><span class="in">trend_phd &lt;- extract_education_specific_trend(model_trend, "phd")</span></span>
<span id="cb41-285"><a href="#cb41-285" aria-hidden="true" tabindex="-1"></a><span class="in">trend_masters &lt;- extract_education_specific_trend(model_trend, "masters")</span></span>
<span id="cb41-286"><a href="#cb41-286" aria-hidden="true" tabindex="-1"></a><span class="in">trend_bachelors &lt;- extract_education_specific_trend(model_trend, "bachelors")</span></span>
<span id="cb41-287"><a href="#cb41-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-288"><a href="#cb41-288" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine for plotting</span></span>
<span id="cb41-289"><a href="#cb41-289" aria-hidden="true" tabindex="-1"></a><span class="in">trend_all &lt;- rbind(</span></span>
<span id="cb41-290"><a href="#cb41-290" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(trend_phd, education = "phd"),</span></span>
<span id="cb41-291"><a href="#cb41-291" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(trend_masters, education = "masters"),</span></span>
<span id="cb41-292"><a href="#cb41-292" aria-hidden="true" tabindex="-1"></a><span class="in">  cbind(trend_bachelors, education = "bachelors")</span></span>
<span id="cb41-293"><a href="#cb41-293" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb41-294"><a href="#cb41-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-295"><a href="#cb41-295" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot trends</span></span>
<span id="cb41-296"><a href="#cb41-296" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(trend_all, aes(x = time_index, y = trend_effect, color = education)) +</span></span>
<span id="cb41-297"><a href="#cb41-297" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(size = 1) +</span></span>
<span id="cb41-298"><a href="#cb41-298" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_ribbon(aes(ymin = trend_effect - 1.96 * se,</span></span>
<span id="cb41-299"><a href="#cb41-299" aria-hidden="true" tabindex="-1"></a><span class="in">                  ymax = trend_effect + 1.96 * se,</span></span>
<span id="cb41-300"><a href="#cb41-300" aria-hidden="true" tabindex="-1"></a><span class="in">                  fill = education),</span></span>
<span id="cb41-301"><a href="#cb41-301" aria-hidden="true" tabindex="-1"></a><span class="in">              alpha = 0.2, color = NA) +</span></span>
<span id="cb41-302"><a href="#cb41-302" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_color_manual(values = c("phd" = "#2C7BB6",</span></span>
<span id="cb41-303"><a href="#cb41-303" aria-hidden="true" tabindex="-1"></a><span class="in">                                "masters" = "#D7191C",</span></span>
<span id="cb41-304"><a href="#cb41-304" aria-hidden="true" tabindex="-1"></a><span class="in">                                "bachelors" = "#FDAE61"),</span></span>
<span id="cb41-305"><a href="#cb41-305" aria-hidden="true" tabindex="-1"></a><span class="in">                     labels = c("PhD", "Master's", "Bachelor's")) +</span></span>
<span id="cb41-306"><a href="#cb41-306" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c("phd" = "#2C7BB6",</span></span>
<span id="cb41-307"><a href="#cb41-307" aria-hidden="true" tabindex="-1"></a><span class="in">                               "masters" = "#D7191C",</span></span>
<span id="cb41-308"><a href="#cb41-308" aria-hidden="true" tabindex="-1"></a><span class="in">                               "bachelors" = "#FDAE61"),</span></span>
<span id="cb41-309"><a href="#cb41-309" aria-hidden="true" tabindex="-1"></a><span class="in">                    labels = c("PhD", "Master's", "Bachelor's")) +</span></span>
<span id="cb41-310"><a href="#cb41-310" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Recovered Education-Specific Trend Components",</span></span>
<span id="cb41-311"><a href="#cb41-311" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "95% confidence bands shown",</span></span>
<span id="cb41-312"><a href="#cb41-312" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "Time Index (months)",</span></span>
<span id="cb41-313"><a href="#cb41-313" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Trend Effect (pp)",</span></span>
<span id="cb41-314"><a href="#cb41-314" aria-hidden="true" tabindex="-1"></a><span class="in">       color = "Education",</span></span>
<span id="cb41-315"><a href="#cb41-315" aria-hidden="true" tabindex="-1"></a><span class="in">       fill = "Education") +</span></span>
<span id="cb41-316"><a href="#cb41-316" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb41-317"><a href="#cb41-317" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "bottom",</span></span>
<span id="cb41-318"><a href="#cb41-318" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.title = element_text(face = "bold"))</span></span>
<span id="cb41-319"><a href="#cb41-319" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-320"><a href="#cb41-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-321"><a href="#cb41-321" aria-hidden="true" tabindex="-1"></a><span class="fu">### Quantitative Trend Recovery</span></span>
<span id="cb41-322"><a href="#cb41-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-323"><a href="#cb41-323" aria-hidden="true" tabindex="-1"></a><span class="in">```{r assess-trend}</span></span>
<span id="cb41-324"><a href="#cb41-324" aria-hidden="true" tabindex="-1"></a><span class="in"># Estimate slopes from linear fits to extracted trends</span></span>
<span id="cb41-325"><a href="#cb41-325" aria-hidden="true" tabindex="-1"></a><span class="in">estimate_slope &lt;- function(trend_df) {</span></span>
<span id="cb41-326"><a href="#cb41-326" aria-hidden="true" tabindex="-1"></a><span class="in">  fit &lt;- lm(trend_effect ~ time_index, data = trend_df)</span></span>
<span id="cb41-327"><a href="#cb41-327" aria-hidden="true" tabindex="-1"></a><span class="in">  coef(fit)["time_index"]</span></span>
<span id="cb41-328"><a href="#cb41-328" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb41-329"><a href="#cb41-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-330"><a href="#cb41-330" aria-hidden="true" tabindex="-1"></a><span class="in">slope_phd_est &lt;- estimate_slope(trend_phd)</span></span>
<span id="cb41-331"><a href="#cb41-331" aria-hidden="true" tabindex="-1"></a><span class="in">slope_masters_est &lt;- estimate_slope(trend_masters)</span></span>
<span id="cb41-332"><a href="#cb41-332" aria-hidden="true" tabindex="-1"></a><span class="in">slope_bachelors_est &lt;- estimate_slope(trend_bachelors)</span></span>
<span id="cb41-333"><a href="#cb41-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-334"><a href="#cb41-334" aria-hidden="true" tabindex="-1"></a><span class="in">recovery_trend &lt;- data.frame(</span></span>
<span id="cb41-335"><a href="#cb41-335" aria-hidden="true" tabindex="-1"></a><span class="in">  Education = c("PhD", "Master's", "Bachelor's"),</span></span>
<span id="cb41-336"><a href="#cb41-336" aria-hidden="true" tabindex="-1"></a><span class="in">  True_Slope = true_trend_slope,</span></span>
<span id="cb41-337"><a href="#cb41-337" aria-hidden="true" tabindex="-1"></a><span class="in">  Estimated_Slope = c(slope_phd_est, slope_masters_est, slope_bachelors_est),</span></span>
<span id="cb41-338"><a href="#cb41-338" aria-hidden="true" tabindex="-1"></a><span class="in">  Error = c(slope_phd_est - true_trend_slope["phd"],</span></span>
<span id="cb41-339"><a href="#cb41-339" aria-hidden="true" tabindex="-1"></a><span class="in">            slope_masters_est - true_trend_slope["masters"],</span></span>
<span id="cb41-340"><a href="#cb41-340" aria-hidden="true" tabindex="-1"></a><span class="in">            slope_bachelors_est - true_trend_slope["bachelors"]),</span></span>
<span id="cb41-341"><a href="#cb41-341" aria-hidden="true" tabindex="-1"></a><span class="in">  Relative_Error_Pct = 100 * c(</span></span>
<span id="cb41-342"><a href="#cb41-342" aria-hidden="true" tabindex="-1"></a><span class="in">    (slope_phd_est - true_trend_slope["phd"]) / abs(true_trend_slope["phd"]),</span></span>
<span id="cb41-343"><a href="#cb41-343" aria-hidden="true" tabindex="-1"></a><span class="in">    (slope_masters_est - true_trend_slope["masters"]) / abs(true_trend_slope["masters"]),</span></span>
<span id="cb41-344"><a href="#cb41-344" aria-hidden="true" tabindex="-1"></a><span class="in">    (slope_bachelors_est - true_trend_slope["bachelors"]) / abs(true_trend_slope["bachelors"])</span></span>
<span id="cb41-345"><a href="#cb41-345" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb41-346"><a href="#cb41-346" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb41-347"><a href="#cb41-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-348"><a href="#cb41-348" aria-hidden="true" tabindex="-1"></a><span class="in">kable(recovery_trend, digits = 6,</span></span>
<span id="cb41-349"><a href="#cb41-349" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Trend Slope Recovery (units: percentage points per month)")</span></span>
<span id="cb41-350"><a href="#cb41-350" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-351"><a href="#cb41-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-352"><a href="#cb41-352" aria-hidden="true" tabindex="-1"></a>**Understanding GAM Trend Shrinkage**: The table shows that trend slope estimates are systematically underestimated (shrunk toward zero), especially for Master's and Bachelor's. This is **expected behavior** for penalized GAM smooths, not a bug:</span>
<span id="cb41-353"><a href="#cb41-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-354"><a href="#cb41-354" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Why shrinkage occurs**: GAMs use penalized regression splines that penalize "wiggliness" (curvature). Linear trends are penalized because they deviate from a flat (constant) function.</span>
<span id="cb41-355"><a href="#cb41-355" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Shrinkage magnitude**: Typically 20-50% shrinkage for modest trends like these (-0.0001 to -0.0005 per month)</span>
<span id="cb41-356"><a href="#cb41-356" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**What is preserved**: The relative ordering (PhD &gt; Masters &gt; Bachelors), signs (all negative), and qualitative patterns</span>
<span id="cb41-357"><a href="#cb41-357" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Trade-off**: GAMs trade some bias (shrinkage) for reduced variance (stability), which often improves prediction</span>
<span id="cb41-358"><a href="#cb41-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-359"><a href="#cb41-359" aria-hidden="true" tabindex="-1"></a>**Key validation**: Despite shrinkage, the factor smooth GAM correctly identifies:</span>
<span id="cb41-360"><a href="#cb41-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-361"><a href="#cb41-361" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>All trends are negative ✓</span>
<span id="cb41-362"><a href="#cb41-362" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Ordering: PhD decline slowest, Bachelor's fastest ✓</span>
<span id="cb41-363"><a href="#cb41-363" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Education levels are distinguishable ✓</span>
<span id="cb41-364"><a href="#cb41-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-365"><a href="#cb41-365" aria-hidden="true" tabindex="-1"></a>For real data applications, interpret GAM trends as **smoothed estimates** that preserve patterns rather than exact linear slopes.</span>
<span id="cb41-366"><a href="#cb41-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-367"><a href="#cb41-367" aria-hidden="true" tabindex="-1"></a><span class="fu">## Test 3: Model Selection Identifies Correct Structure</span></span>
<span id="cb41-368"><a href="#cb41-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-369"><a href="#cb41-369" aria-hidden="true" tabindex="-1"></a><span class="fu">### Scenario A: Only Seasonal Differences</span></span>
<span id="cb41-370"><a href="#cb41-370" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-371"><a href="#cb41-371" aria-hidden="true" tabindex="-1"></a>When only seasonal patterns differ (shared trend), does model selection prefer the correct model?</span>
<span id="cb41-372"><a href="#cb41-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-373"><a href="#cb41-373" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model-selection-seasonal}</span></span>
<span id="cb41-374"><a href="#cb41-374" aria-hidden="true" tabindex="-1"></a><span class="in"># Simulate with only seasonal differences</span></span>
<span id="cb41-375"><a href="#cb41-375" aria-hidden="true" tabindex="-1"></a><span class="in">sim_seasonal_only &lt;- simulate_multi_education_unemployment(</span></span>
<span id="cb41-376"><a href="#cb41-376" aria-hidden="true" tabindex="-1"></a><span class="in">  n_years = 15,</span></span>
<span id="cb41-377"><a href="#cb41-377" aria-hidden="true" tabindex="-1"></a><span class="in">  education_levels = c("phd", "masters", "bachelors"),</span></span>
<span id="cb41-378"><a href="#cb41-378" aria-hidden="true" tabindex="-1"></a><span class="in">  baseline_rates = c(phd = 0.025, masters = 0.035, bachelors = 0.045),</span></span>
<span id="cb41-379"><a href="#cb41-379" aria-hidden="true" tabindex="-1"></a><span class="in">  seasonal_amplitudes = c(phd = 0.005, masters = 0.015, bachelors = 0.025),</span></span>
<span id="cb41-380"><a href="#cb41-380" aria-hidden="true" tabindex="-1"></a><span class="in">  trend_slopes = c(phd = 0, masters = 0, bachelors = 0),  # Same (no trend)!</span></span>
<span id="cb41-381"><a href="#cb41-381" aria-hidden="true" tabindex="-1"></a><span class="in">  noise_sd = 0.002,</span></span>
<span id="cb41-382"><a href="#cb41-382" aria-hidden="true" tabindex="-1"></a><span class="in">  seed = 789</span></span>
<span id="cb41-383"><a href="#cb41-383" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb41-384"><a href="#cb41-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-385"><a href="#cb41-385" aria-hidden="true" tabindex="-1"></a><span class="in"># Fit nested sequence</span></span>
<span id="cb41-386"><a href="#cb41-386" aria-hidden="true" tabindex="-1"></a><span class="in">models_seasonal &lt;- fit_nested_model_sequence(sim_seasonal_only)</span></span>
<span id="cb41-387"><a href="#cb41-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-388"><a href="#cb41-388" aria-hidden="true" tabindex="-1"></a><span class="in"># Compare via AIC</span></span>
<span id="cb41-389"><a href="#cb41-389" aria-hidden="true" tabindex="-1"></a><span class="in">aic_seasonal &lt;- compare_nested_models(models_seasonal)</span></span>
<span id="cb41-390"><a href="#cb41-390" aria-hidden="true" tabindex="-1"></a><span class="in">kable(aic_seasonal, digits = 2,</span></span>
<span id="cb41-391"><a href="#cb41-391" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Model Selection: Seasonal Differences Only")</span></span>
<span id="cb41-392"><a href="#cb41-392" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-393"><a href="#cb41-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-394"><a href="#cb41-394" aria-hidden="true" tabindex="-1"></a>**Expected**: Model m5 (shared trend + education-specific seasonality) should be preferred.</span>
<span id="cb41-395"><a href="#cb41-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-396"><a href="#cb41-396" aria-hidden="true" tabindex="-1"></a><span class="fu">### Scenario B: Only Trend Differences</span></span>
<span id="cb41-397"><a href="#cb41-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-398"><a href="#cb41-398" aria-hidden="true" tabindex="-1"></a>When only trends differ (shared seasonality), does model selection prefer the correct model?</span>
<span id="cb41-399"><a href="#cb41-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-400"><a href="#cb41-400" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model-selection-trend}</span></span>
<span id="cb41-401"><a href="#cb41-401" aria-hidden="true" tabindex="-1"></a><span class="in">sim_trend_only &lt;- simulate_multi_education_unemployment(</span></span>
<span id="cb41-402"><a href="#cb41-402" aria-hidden="true" tabindex="-1"></a><span class="in">  n_years = 15,</span></span>
<span id="cb41-403"><a href="#cb41-403" aria-hidden="true" tabindex="-1"></a><span class="in">  education_levels = c("phd", "masters", "bachelors"),</span></span>
<span id="cb41-404"><a href="#cb41-404" aria-hidden="true" tabindex="-1"></a><span class="in">  baseline_rates = c(phd = 0.025, masters = 0.035, bachelors = 0.045),</span></span>
<span id="cb41-405"><a href="#cb41-405" aria-hidden="true" tabindex="-1"></a><span class="in">  seasonal_amplitudes = c(phd = 0.010, masters = 0.010, bachelors = 0.010),  # Same!</span></span>
<span id="cb41-406"><a href="#cb41-406" aria-hidden="true" tabindex="-1"></a><span class="in">  trend_slopes = c(phd = -0.0001, masters = -0.0003, bachelors = -0.0005),</span></span>
<span id="cb41-407"><a href="#cb41-407" aria-hidden="true" tabindex="-1"></a><span class="in">  noise_sd = 0.002,</span></span>
<span id="cb41-408"><a href="#cb41-408" aria-hidden="true" tabindex="-1"></a><span class="in">  seed = 101112</span></span>
<span id="cb41-409"><a href="#cb41-409" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb41-410"><a href="#cb41-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-411"><a href="#cb41-411" aria-hidden="true" tabindex="-1"></a><span class="in">models_trend &lt;- fit_nested_model_sequence(sim_trend_only)</span></span>
<span id="cb41-412"><a href="#cb41-412" aria-hidden="true" tabindex="-1"></a><span class="in">aic_trend &lt;- compare_nested_models(models_trend)</span></span>
<span id="cb41-413"><a href="#cb41-413" aria-hidden="true" tabindex="-1"></a><span class="in">kable(aic_trend, digits = 2,</span></span>
<span id="cb41-414"><a href="#cb41-414" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Model Selection: Trend Differences Only")</span></span>
<span id="cb41-415"><a href="#cb41-415" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-416"><a href="#cb41-416" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-417"><a href="#cb41-417" aria-hidden="true" tabindex="-1"></a>**Expected**: Model m4 (education-specific trends + shared seasonality) should be preferred.</span>
<span id="cb41-418"><a href="#cb41-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-419"><a href="#cb41-419" aria-hidden="true" tabindex="-1"></a><span class="fu">### Scenario C: Both Differ</span></span>
<span id="cb41-420"><a href="#cb41-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-421"><a href="#cb41-421" aria-hidden="true" tabindex="-1"></a>When both seasonal and trend patterns differ, does model selection prefer the full model?</span>
<span id="cb41-422"><a href="#cb41-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-423"><a href="#cb41-423" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model-selection-full}</span></span>
<span id="cb41-424"><a href="#cb41-424" aria-hidden="true" tabindex="-1"></a><span class="in">sim_both &lt;- simulate_multi_education_unemployment(</span></span>
<span id="cb41-425"><a href="#cb41-425" aria-hidden="true" tabindex="-1"></a><span class="in">  n_years = 15,</span></span>
<span id="cb41-426"><a href="#cb41-426" aria-hidden="true" tabindex="-1"></a><span class="in">  education_levels = c("phd", "masters", "bachelors"),</span></span>
<span id="cb41-427"><a href="#cb41-427" aria-hidden="true" tabindex="-1"></a><span class="in">  baseline_rates = c(phd = 0.025, masters = 0.035, bachelors = 0.045),</span></span>
<span id="cb41-428"><a href="#cb41-428" aria-hidden="true" tabindex="-1"></a><span class="in">  seasonal_amplitudes = c(phd = 0.005, masters = 0.015, bachelors = 0.025),</span></span>
<span id="cb41-429"><a href="#cb41-429" aria-hidden="true" tabindex="-1"></a><span class="in">  trend_slopes = c(phd = -0.0001, masters = -0.0003, bachelors = -0.0005),</span></span>
<span id="cb41-430"><a href="#cb41-430" aria-hidden="true" tabindex="-1"></a><span class="in">  noise_sd = 0.002,</span></span>
<span id="cb41-431"><a href="#cb41-431" aria-hidden="true" tabindex="-1"></a><span class="in">  seed = 131415</span></span>
<span id="cb41-432"><a href="#cb41-432" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb41-433"><a href="#cb41-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-434"><a href="#cb41-434" aria-hidden="true" tabindex="-1"></a><span class="in">models_both &lt;- fit_nested_model_sequence(sim_both)</span></span>
<span id="cb41-435"><a href="#cb41-435" aria-hidden="true" tabindex="-1"></a><span class="in">aic_both &lt;- compare_nested_models(models_both)</span></span>
<span id="cb41-436"><a href="#cb41-436" aria-hidden="true" tabindex="-1"></a><span class="in">kable(aic_both, digits = 2,</span></span>
<span id="cb41-437"><a href="#cb41-437" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Model Selection: Both Seasonal and Trend Differences")</span></span>
<span id="cb41-438"><a href="#cb41-438" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-439"><a href="#cb41-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-440"><a href="#cb41-440" aria-hidden="true" tabindex="-1"></a>**Expected**: Model m6 (full: education-specific trends and seasonality) should be strongly preferred.</span>
<span id="cb41-441"><a href="#cb41-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-442"><a href="#cb41-442" aria-hidden="true" tabindex="-1"></a><span class="fu">## Test 4: Trend Difference Inference</span></span>
<span id="cb41-443"><a href="#cb41-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-444"><a href="#cb41-444" aria-hidden="true" tabindex="-1"></a>A critical capability is comparing trends between education levels with proper uncertainty quantification.</span>
<span id="cb41-445"><a href="#cb41-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-446"><a href="#cb41-446" aria-hidden="true" tabindex="-1"></a><span class="fu">### Simulation with Known Differences</span></span>
<span id="cb41-447"><a href="#cb41-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-448"><a href="#cb41-448" aria-hidden="true" tabindex="-1"></a><span class="in">```{r trend-differences}</span></span>
<span id="cb41-449"><a href="#cb41-449" aria-hidden="true" tabindex="-1"></a><span class="in"># Use simulation from Test 2 (different trend slopes)</span></span>
<span id="cb41-450"><a href="#cb41-450" aria-hidden="true" tabindex="-1"></a><span class="in"># Compute pairwise trend differences</span></span>
<span id="cb41-451"><a href="#cb41-451" aria-hidden="true" tabindex="-1"></a><span class="in">diff_results &lt;- compute_trend_differences(</span></span>
<span id="cb41-452"><a href="#cb41-452" aria-hidden="true" tabindex="-1"></a><span class="in">  model_trend,</span></span>
<span id="cb41-453"><a href="#cb41-453" aria-hidden="true" tabindex="-1"></a><span class="in">  education_pairs = list(</span></span>
<span id="cb41-454"><a href="#cb41-454" aria-hidden="true" tabindex="-1"></a><span class="in">    c("phd", "masters"),</span></span>
<span id="cb41-455"><a href="#cb41-455" aria-hidden="true" tabindex="-1"></a><span class="in">    c("phd", "bachelors"),</span></span>
<span id="cb41-456"><a href="#cb41-456" aria-hidden="true" tabindex="-1"></a><span class="in">    c("masters", "bachelors")</span></span>
<span id="cb41-457"><a href="#cb41-457" aria-hidden="true" tabindex="-1"></a><span class="in">  ),</span></span>
<span id="cb41-458"><a href="#cb41-458" aria-hidden="true" tabindex="-1"></a><span class="in">  time_points = seq(1, 180, by = 12)  # Annual snapshots</span></span>
<span id="cb41-459"><a href="#cb41-459" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb41-460"><a href="#cb41-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-461"><a href="#cb41-461" aria-hidden="true" tabindex="-1"></a><span class="in"># True differences</span></span>
<span id="cb41-462"><a href="#cb41-462" aria-hidden="true" tabindex="-1"></a><span class="in">true_diff_pm &lt;- true_trend_slope["phd"] - true_trend_slope["masters"]</span></span>
<span id="cb41-463"><a href="#cb41-463" aria-hidden="true" tabindex="-1"></a><span class="in">true_diff_pb &lt;- true_trend_slope["phd"] - true_trend_slope["bachelors"]</span></span>
<span id="cb41-464"><a href="#cb41-464" aria-hidden="true" tabindex="-1"></a><span class="in">true_diff_mb &lt;- true_trend_slope["masters"] - true_trend_slope["bachelors"]</span></span>
<span id="cb41-465"><a href="#cb41-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-466"><a href="#cb41-466" aria-hidden="true" tabindex="-1"></a><span class="in">head(diff_results, 20)</span></span>
<span id="cb41-467"><a href="#cb41-467" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-468"><a href="#cb41-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-469"><a href="#cb41-469" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualize Differences</span></span>
<span id="cb41-470"><a href="#cb41-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-471"><a href="#cb41-471" aria-hidden="true" tabindex="-1"></a><span class="in">```{r plot-differences}</span></span>
<span id="cb41-472"><a href="#cb41-472" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(diff_results, aes(x = time_index, y = difference, color = comparison)) +</span></span>
<span id="cb41-473"><a href="#cb41-473" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_line(size = 1) +</span></span>
<span id="cb41-474"><a href="#cb41-474" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_ribbon(aes(ymin = lower, ymax = upper, fill = comparison),</span></span>
<span id="cb41-475"><a href="#cb41-475" aria-hidden="true" tabindex="-1"></a><span class="in">              alpha = 0.2, color = NA) +</span></span>
<span id="cb41-476"><a href="#cb41-476" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_hline(yintercept = 0, linetype = "dashed", color = "gray50") +</span></span>
<span id="cb41-477"><a href="#cb41-477" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~ comparison, ncol = 1, scales = "free_y") +</span></span>
<span id="cb41-478"><a href="#cb41-478" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Pairwise Trend Differences Between Education Levels",</span></span>
<span id="cb41-479"><a href="#cb41-479" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "95% confidence bands (accounting for correlation)",</span></span>
<span id="cb41-480"><a href="#cb41-480" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "Time Index (months)",</span></span>
<span id="cb41-481"><a href="#cb41-481" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Difference in Trend Effect (pp)") +</span></span>
<span id="cb41-482"><a href="#cb41-482" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb41-483"><a href="#cb41-483" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "none",</span></span>
<span id="cb41-484"><a href="#cb41-484" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.title = element_text(face = "bold"))</span></span>
<span id="cb41-485"><a href="#cb41-485" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-486"><a href="#cb41-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-487"><a href="#cb41-487" aria-hidden="true" tabindex="-1"></a><span class="fu">### Coverage Check for Differences</span></span>
<span id="cb41-488"><a href="#cb41-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-489"><a href="#cb41-489" aria-hidden="true" tabindex="-1"></a>Do the 95% confidence intervals for trend differences contain the true differences?</span>
<span id="cb41-490"><a href="#cb41-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-491"><a href="#cb41-491" aria-hidden="true" tabindex="-1"></a><span class="in">```{r diff-coverage}</span></span>
<span id="cb41-492"><a href="#cb41-492" aria-hidden="true" tabindex="-1"></a><span class="in"># Check coverage for each comparison at first time point</span></span>
<span id="cb41-493"><a href="#cb41-493" aria-hidden="true" tabindex="-1"></a><span class="in">diff_t1 &lt;- diff_results[diff_results$time_index == 1, ]</span></span>
<span id="cb41-494"><a href="#cb41-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-495"><a href="#cb41-495" aria-hidden="true" tabindex="-1"></a><span class="in">coverage_check &lt;- data.frame(</span></span>
<span id="cb41-496"><a href="#cb41-496" aria-hidden="true" tabindex="-1"></a><span class="in">  Comparison = diff_t1$comparison,</span></span>
<span id="cb41-497"><a href="#cb41-497" aria-hidden="true" tabindex="-1"></a><span class="in">  True_Difference = c(true_diff_pm, true_diff_pb, true_diff_mb),</span></span>
<span id="cb41-498"><a href="#cb41-498" aria-hidden="true" tabindex="-1"></a><span class="in">  Estimated_Difference = diff_t1$difference,</span></span>
<span id="cb41-499"><a href="#cb41-499" aria-hidden="true" tabindex="-1"></a><span class="in">  CI_Lower = diff_t1$lower,</span></span>
<span id="cb41-500"><a href="#cb41-500" aria-hidden="true" tabindex="-1"></a><span class="in">  CI_Upper = diff_t1$upper,</span></span>
<span id="cb41-501"><a href="#cb41-501" aria-hidden="true" tabindex="-1"></a><span class="in">  Contains_True = c(</span></span>
<span id="cb41-502"><a href="#cb41-502" aria-hidden="true" tabindex="-1"></a><span class="in">    true_diff_pm &gt;= diff_t1$lower[1] &amp; true_diff_pm &lt;= diff_t1$upper[1],</span></span>
<span id="cb41-503"><a href="#cb41-503" aria-hidden="true" tabindex="-1"></a><span class="in">    true_diff_pb &gt;= diff_t1$lower[2] &amp; true_diff_pb &lt;= diff_t1$upper[2],</span></span>
<span id="cb41-504"><a href="#cb41-504" aria-hidden="true" tabindex="-1"></a><span class="in">    true_diff_mb &gt;= diff_t1$lower[3] &amp; true_diff_mb &lt;= diff_t1$upper[3]</span></span>
<span id="cb41-505"><a href="#cb41-505" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb41-506"><a href="#cb41-506" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb41-507"><a href="#cb41-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-508"><a href="#cb41-508" aria-hidden="true" tabindex="-1"></a><span class="in">kable(coverage_check, digits = 6,</span></span>
<span id="cb41-509"><a href="#cb41-509" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Coverage Check for Trend Difference Confidence Intervals")</span></span>
<span id="cb41-510"><a href="#cb41-510" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-511"><a href="#cb41-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-512"><a href="#cb41-512" aria-hidden="true" tabindex="-1"></a><span class="fu">## Test 5: Model Selection Coverage Validation</span></span>
<span id="cb41-513"><a href="#cb41-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-514"><a href="#cb41-514" aria-hidden="true" tabindex="-1"></a>The previous model selection tests (Test 3) showed single instances. Now we validate model selection over many simulations to assess coverage rates: **how often does AIC select the correct model structure?**</span>
<span id="cb41-515"><a href="#cb41-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-516"><a href="#cb41-516" aria-hidden="true" tabindex="-1"></a>We'll test three scenarios across 100 simulations each:</span>
<span id="cb41-517"><a href="#cb41-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-518"><a href="#cb41-518" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Scenario A**: Only seasonal differs → should prefer m5 or m6</span>
<span id="cb41-519"><a href="#cb41-519" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Scenario B**: Only trend differs → should prefer m4 or m6</span>
<span id="cb41-520"><a href="#cb41-520" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Scenario C**: Both differ → should strongly prefer m6</span>
<span id="cb41-521"><a href="#cb41-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-522"><a href="#cb41-522" aria-hidden="true" tabindex="-1"></a><span class="in">```{r model-selection-coverage}</span></span>
<span id="cb41-523"><a href="#cb41-523" aria-hidden="true" tabindex="-1"></a><span class="in">set.seed(20251113)</span></span>
<span id="cb41-524"><a href="#cb41-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-525"><a href="#cb41-525" aria-hidden="true" tabindex="-1"></a><span class="in"># Function to run one simulation and return top model</span></span>
<span id="cb41-526"><a href="#cb41-526" aria-hidden="true" tabindex="-1"></a><span class="in">run_model_selection_sim &lt;- function(scenario, sim_id) {</span></span>
<span id="cb41-527"><a href="#cb41-527" aria-hidden="true" tabindex="-1"></a><span class="in">  if (scenario == "seasonal_only") {</span></span>
<span id="cb41-528"><a href="#cb41-528" aria-hidden="true" tabindex="-1"></a><span class="in">    sim_data &lt;- simulate_multi_education_unemployment(</span></span>
<span id="cb41-529"><a href="#cb41-529" aria-hidden="true" tabindex="-1"></a><span class="in">      n_years = 15,</span></span>
<span id="cb41-530"><a href="#cb41-530" aria-hidden="true" tabindex="-1"></a><span class="in">      education_levels = c("phd", "masters", "bachelors"),</span></span>
<span id="cb41-531"><a href="#cb41-531" aria-hidden="true" tabindex="-1"></a><span class="in">      baseline_rates = c(phd = 0.025, masters = 0.035, bachelors = 0.045),</span></span>
<span id="cb41-532"><a href="#cb41-532" aria-hidden="true" tabindex="-1"></a><span class="in">      seasonal_amplitudes = c(phd = 0.005, masters = 0.015, bachelors = 0.025),</span></span>
<span id="cb41-533"><a href="#cb41-533" aria-hidden="true" tabindex="-1"></a><span class="in">      trend_slopes = c(phd = 0, masters = 0, bachelors = 0),</span></span>
<span id="cb41-534"><a href="#cb41-534" aria-hidden="true" tabindex="-1"></a><span class="in">      noise_sd = 0.002,</span></span>
<span id="cb41-535"><a href="#cb41-535" aria-hidden="true" tabindex="-1"></a><span class="in">      seed = 1000 + sim_id</span></span>
<span id="cb41-536"><a href="#cb41-536" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb41-537"><a href="#cb41-537" aria-hidden="true" tabindex="-1"></a><span class="in">  } else if (scenario == "trend_only") {</span></span>
<span id="cb41-538"><a href="#cb41-538" aria-hidden="true" tabindex="-1"></a><span class="in">    sim_data &lt;- simulate_multi_education_unemployment(</span></span>
<span id="cb41-539"><a href="#cb41-539" aria-hidden="true" tabindex="-1"></a><span class="in">      n_years = 15,</span></span>
<span id="cb41-540"><a href="#cb41-540" aria-hidden="true" tabindex="-1"></a><span class="in">      education_levels = c("phd", "masters", "bachelors"),</span></span>
<span id="cb41-541"><a href="#cb41-541" aria-hidden="true" tabindex="-1"></a><span class="in">      baseline_rates = c(phd = 0.025, masters = 0.035, bachelors = 0.045),</span></span>
<span id="cb41-542"><a href="#cb41-542" aria-hidden="true" tabindex="-1"></a><span class="in">      seasonal_amplitudes = c(phd = 0.010, masters = 0.010, bachelors = 0.010),</span></span>
<span id="cb41-543"><a href="#cb41-543" aria-hidden="true" tabindex="-1"></a><span class="in">      trend_slopes = c(phd = -0.0001, masters = -0.0003, bachelors = -0.0005),</span></span>
<span id="cb41-544"><a href="#cb41-544" aria-hidden="true" tabindex="-1"></a><span class="in">      noise_sd = 0.002,</span></span>
<span id="cb41-545"><a href="#cb41-545" aria-hidden="true" tabindex="-1"></a><span class="in">      seed = 2000 + sim_id</span></span>
<span id="cb41-546"><a href="#cb41-546" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb41-547"><a href="#cb41-547" aria-hidden="true" tabindex="-1"></a><span class="in">  } else {  # both</span></span>
<span id="cb41-548"><a href="#cb41-548" aria-hidden="true" tabindex="-1"></a><span class="in">    sim_data &lt;- simulate_multi_education_unemployment(</span></span>
<span id="cb41-549"><a href="#cb41-549" aria-hidden="true" tabindex="-1"></a><span class="in">      n_years = 15,</span></span>
<span id="cb41-550"><a href="#cb41-550" aria-hidden="true" tabindex="-1"></a><span class="in">      education_levels = c("phd", "masters", "bachelors"),</span></span>
<span id="cb41-551"><a href="#cb41-551" aria-hidden="true" tabindex="-1"></a><span class="in">      baseline_rates = c(phd = 0.025, masters = 0.035, bachelors = 0.045),</span></span>
<span id="cb41-552"><a href="#cb41-552" aria-hidden="true" tabindex="-1"></a><span class="in">      seasonal_amplitudes = c(phd = 0.005, masters = 0.015, bachelors = 0.025),</span></span>
<span id="cb41-553"><a href="#cb41-553" aria-hidden="true" tabindex="-1"></a><span class="in">      trend_slopes = c(phd = -0.0001, masters = -0.0003, bachelors = -0.0005),</span></span>
<span id="cb41-554"><a href="#cb41-554" aria-hidden="true" tabindex="-1"></a><span class="in">      noise_sd = 0.002,</span></span>
<span id="cb41-555"><a href="#cb41-555" aria-hidden="true" tabindex="-1"></a><span class="in">      seed = 3000 + sim_id</span></span>
<span id="cb41-556"><a href="#cb41-556" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb41-557"><a href="#cb41-557" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb41-558"><a href="#cb41-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-559"><a href="#cb41-559" aria-hidden="true" tabindex="-1"></a><span class="in">  # Fit nested sequence</span></span>
<span id="cb41-560"><a href="#cb41-560" aria-hidden="true" tabindex="-1"></a><span class="in">  models &lt;- fit_nested_model_sequence(sim_data)</span></span>
<span id="cb41-561"><a href="#cb41-561" aria-hidden="true" tabindex="-1"></a><span class="in">  aic_table &lt;- compare_nested_models(models)</span></span>
<span id="cb41-562"><a href="#cb41-562" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-563"><a href="#cb41-563" aria-hidden="true" tabindex="-1"></a><span class="in">  # Return top model and delta AIC to second best</span></span>
<span id="cb41-564"><a href="#cb41-564" aria-hidden="true" tabindex="-1"></a><span class="in">  top_model &lt;- aic_table$model[1]</span></span>
<span id="cb41-565"><a href="#cb41-565" aria-hidden="true" tabindex="-1"></a><span class="in">  delta_aic_to_second &lt;- aic_table$delta_AIC[2]</span></span>
<span id="cb41-566"><a href="#cb41-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-567"><a href="#cb41-567" aria-hidden="true" tabindex="-1"></a><span class="in">  return(data.frame(</span></span>
<span id="cb41-568"><a href="#cb41-568" aria-hidden="true" tabindex="-1"></a><span class="in">    scenario = scenario,</span></span>
<span id="cb41-569"><a href="#cb41-569" aria-hidden="true" tabindex="-1"></a><span class="in">    sim_id = sim_id,</span></span>
<span id="cb41-570"><a href="#cb41-570" aria-hidden="true" tabindex="-1"></a><span class="in">    top_model = top_model,</span></span>
<span id="cb41-571"><a href="#cb41-571" aria-hidden="true" tabindex="-1"></a><span class="in">    delta_aic_to_second = delta_aic_to_second</span></span>
<span id="cb41-572"><a href="#cb41-572" aria-hidden="true" tabindex="-1"></a><span class="in">  ))</span></span>
<span id="cb41-573"><a href="#cb41-573" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb41-574"><a href="#cb41-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-575"><a href="#cb41-575" aria-hidden="true" tabindex="-1"></a><span class="in"># Run 100 simulations for each scenario</span></span>
<span id="cb41-576"><a href="#cb41-576" aria-hidden="true" tabindex="-1"></a><span class="in">n_sims &lt;- 100</span></span>
<span id="cb41-577"><a href="#cb41-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-578"><a href="#cb41-578" aria-hidden="true" tabindex="-1"></a><span class="in">cat("Running model selection coverage validation (100 sims x 3 scenarios = 300 total)...\n")</span></span>
<span id="cb41-579"><a href="#cb41-579" aria-hidden="true" tabindex="-1"></a><span class="in">cat("This may take 2-3 minutes...\n\n")</span></span>
<span id="cb41-580"><a href="#cb41-580" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-581"><a href="#cb41-581" aria-hidden="true" tabindex="-1"></a><span class="in">results_list &lt;- list()</span></span>
<span id="cb41-582"><a href="#cb41-582" aria-hidden="true" tabindex="-1"></a><span class="in">counter &lt;- 1</span></span>
<span id="cb41-583"><a href="#cb41-583" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-584"><a href="#cb41-584" aria-hidden="true" tabindex="-1"></a><span class="in">for (scenario in c("seasonal_only", "trend_only", "both")) {</span></span>
<span id="cb41-585"><a href="#cb41-585" aria-hidden="true" tabindex="-1"></a><span class="in">  cat(sprintf("Running %s scenario...\n", scenario))</span></span>
<span id="cb41-586"><a href="#cb41-586" aria-hidden="true" tabindex="-1"></a><span class="in">  for (i in 1:n_sims) {</span></span>
<span id="cb41-587"><a href="#cb41-587" aria-hidden="true" tabindex="-1"></a><span class="in">    results_list[[counter]] &lt;- run_model_selection_sim(scenario, i)</span></span>
<span id="cb41-588"><a href="#cb41-588" aria-hidden="true" tabindex="-1"></a><span class="in">    counter &lt;- counter + 1</span></span>
<span id="cb41-589"><a href="#cb41-589" aria-hidden="true" tabindex="-1"></a><span class="in">    if (i %% 25 == 0) cat(sprintf("  Completed %d/%d\n", i, n_sims))</span></span>
<span id="cb41-590"><a href="#cb41-590" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb41-591"><a href="#cb41-591" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb41-592"><a href="#cb41-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-593"><a href="#cb41-593" aria-hidden="true" tabindex="-1"></a><span class="in"># Combine results</span></span>
<span id="cb41-594"><a href="#cb41-594" aria-hidden="true" tabindex="-1"></a><span class="in">all_results &lt;- do.call(rbind, results_list)</span></span>
<span id="cb41-595"><a href="#cb41-595" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-596"><a href="#cb41-596" aria-hidden="true" tabindex="-1"></a><span class="in"># Summarize selection rates</span></span>
<span id="cb41-597"><a href="#cb41-597" aria-hidden="true" tabindex="-1"></a><span class="in">selection_summary &lt;- aggregate(</span></span>
<span id="cb41-598"><a href="#cb41-598" aria-hidden="true" tabindex="-1"></a><span class="in">  top_model ~ scenario,</span></span>
<span id="cb41-599"><a href="#cb41-599" aria-hidden="true" tabindex="-1"></a><span class="in">  data = all_results,</span></span>
<span id="cb41-600"><a href="#cb41-600" aria-hidden="true" tabindex="-1"></a><span class="in">  FUN = function(x) {</span></span>
<span id="cb41-601"><a href="#cb41-601" aria-hidden="true" tabindex="-1"></a><span class="in">    counts &lt;- table(x)</span></span>
<span id="cb41-602"><a href="#cb41-602" aria-hidden="true" tabindex="-1"></a><span class="in">    total &lt;- length(x)</span></span>
<span id="cb41-603"><a href="#cb41-603" aria-hidden="true" tabindex="-1"></a><span class="in">    paste0(names(counts), ": ", counts, " (", round(100 * counts / total, 1), "%)", collapse = "; ")</span></span>
<span id="cb41-604"><a href="#cb41-604" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb41-605"><a href="#cb41-605" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb41-606"><a href="#cb41-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-607"><a href="#cb41-607" aria-hidden="true" tabindex="-1"></a><span class="in">cat("\n=== Model Selection Summary ===\n\n")</span></span>
<span id="cb41-608"><a href="#cb41-608" aria-hidden="true" tabindex="-1"></a><span class="in">print(selection_summary)</span></span>
<span id="cb41-609"><a href="#cb41-609" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-610"><a href="#cb41-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-611"><a href="#cb41-611" aria-hidden="true" tabindex="-1"></a><span class="fu">### Interpret Selection Rates</span></span>
<span id="cb41-612"><a href="#cb41-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-613"><a href="#cb41-613" aria-hidden="true" tabindex="-1"></a><span class="in">```{r interpret-selection}</span></span>
<span id="cb41-614"><a href="#cb41-614" aria-hidden="true" tabindex="-1"></a><span class="in"># Create detailed summary tables</span></span>
<span id="cb41-615"><a href="#cb41-615" aria-hidden="true" tabindex="-1"></a><span class="in">make_selection_table &lt;- function(scenario_data, scenario_name, correct_models) {</span></span>
<span id="cb41-616"><a href="#cb41-616" aria-hidden="true" tabindex="-1"></a><span class="in">  counts &lt;- table(scenario_data$top_model)</span></span>
<span id="cb41-617"><a href="#cb41-617" aria-hidden="true" tabindex="-1"></a><span class="in">  total &lt;- nrow(scenario_data)</span></span>
<span id="cb41-618"><a href="#cb41-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-619"><a href="#cb41-619" aria-hidden="true" tabindex="-1"></a><span class="in">  summary_df &lt;- data.frame(</span></span>
<span id="cb41-620"><a href="#cb41-620" aria-hidden="true" tabindex="-1"></a><span class="in">    Model = names(counts),</span></span>
<span id="cb41-621"><a href="#cb41-621" aria-hidden="true" tabindex="-1"></a><span class="in">    Count = as.numeric(counts),</span></span>
<span id="cb41-622"><a href="#cb41-622" aria-hidden="true" tabindex="-1"></a><span class="in">    Percentage = round(100 * as.numeric(counts) / total, 1),</span></span>
<span id="cb41-623"><a href="#cb41-623" aria-hidden="true" tabindex="-1"></a><span class="in">    Correct = ifelse(names(counts) %in% correct_models, "✓", "")</span></span>
<span id="cb41-624"><a href="#cb41-624" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb41-625"><a href="#cb41-625" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-626"><a href="#cb41-626" aria-hidden="true" tabindex="-1"></a><span class="in">  summary_df &lt;- summary_df[order(-summary_df$Count), ]</span></span>
<span id="cb41-627"><a href="#cb41-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-628"><a href="#cb41-628" aria-hidden="true" tabindex="-1"></a><span class="in">  # Add total row</span></span>
<span id="cb41-629"><a href="#cb41-629" aria-hidden="true" tabindex="-1"></a><span class="in">  correct_count &lt;- sum(summary_df$Count[summary_df$Correct == "✓"])</span></span>
<span id="cb41-630"><a href="#cb41-630" aria-hidden="true" tabindex="-1"></a><span class="in">  summary_df &lt;- rbind(</span></span>
<span id="cb41-631"><a href="#cb41-631" aria-hidden="true" tabindex="-1"></a><span class="in">    summary_df,</span></span>
<span id="cb41-632"><a href="#cb41-632" aria-hidden="true" tabindex="-1"></a><span class="in">    data.frame(</span></span>
<span id="cb41-633"><a href="#cb41-633" aria-hidden="true" tabindex="-1"></a><span class="in">      Model = "TOTAL CORRECT",</span></span>
<span id="cb41-634"><a href="#cb41-634" aria-hidden="true" tabindex="-1"></a><span class="in">      Count = correct_count,</span></span>
<span id="cb41-635"><a href="#cb41-635" aria-hidden="true" tabindex="-1"></a><span class="in">      Percentage = round(100 * correct_count / total, 1),</span></span>
<span id="cb41-636"><a href="#cb41-636" aria-hidden="true" tabindex="-1"></a><span class="in">      Correct = ""</span></span>
<span id="cb41-637"><a href="#cb41-637" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb41-638"><a href="#cb41-638" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb41-639"><a href="#cb41-639" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-640"><a href="#cb41-640" aria-hidden="true" tabindex="-1"></a><span class="in">  return(summary_df)</span></span>
<span id="cb41-641"><a href="#cb41-641" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb41-642"><a href="#cb41-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-643"><a href="#cb41-643" aria-hidden="true" tabindex="-1"></a><span class="in"># Scenario A: Seasonal only (correct = m5 or m6)</span></span>
<span id="cb41-644"><a href="#cb41-644" aria-hidden="true" tabindex="-1"></a><span class="in">seasonal_results &lt;- all_results[all_results$scenario == "seasonal_only", ]</span></span>
<span id="cb41-645"><a href="#cb41-645" aria-hidden="true" tabindex="-1"></a><span class="in">seasonal_table &lt;- make_selection_table(seasonal_results, "Seasonal Only", c("m5", "m6"))</span></span>
<span id="cb41-646"><a href="#cb41-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-647"><a href="#cb41-647" aria-hidden="true" tabindex="-1"></a><span class="in">cat("\n### Scenario A: Only Seasonal Differs (correct = m5 or m6)\n\n")</span></span>
<span id="cb41-648"><a href="#cb41-648" aria-hidden="true" tabindex="-1"></a><span class="in">kable(seasonal_table, row.names = FALSE,</span></span>
<span id="cb41-649"><a href="#cb41-649" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Model Selection: Seasonal Differences Only (100 simulations)")</span></span>
<span id="cb41-650"><a href="#cb41-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-651"><a href="#cb41-651" aria-hidden="true" tabindex="-1"></a><span class="in"># Scenario B: Trend only (correct = m4 or m6)</span></span>
<span id="cb41-652"><a href="#cb41-652" aria-hidden="true" tabindex="-1"></a><span class="in">trend_results &lt;- all_results[all_results$scenario == "trend_only", ]</span></span>
<span id="cb41-653"><a href="#cb41-653" aria-hidden="true" tabindex="-1"></a><span class="in">trend_table &lt;- make_selection_table(trend_results, "Trend Only", c("m4", "m6"))</span></span>
<span id="cb41-654"><a href="#cb41-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-655"><a href="#cb41-655" aria-hidden="true" tabindex="-1"></a><span class="in">cat("\n### Scenario B: Only Trend Differs (correct = m4 or m6)\n\n")</span></span>
<span id="cb41-656"><a href="#cb41-656" aria-hidden="true" tabindex="-1"></a><span class="in">kable(trend_table, row.names = FALSE,</span></span>
<span id="cb41-657"><a href="#cb41-657" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Model Selection: Trend Differences Only (100 simulations)")</span></span>
<span id="cb41-658"><a href="#cb41-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-659"><a href="#cb41-659" aria-hidden="true" tabindex="-1"></a><span class="in"># Scenario C: Both (correct = m6)</span></span>
<span id="cb41-660"><a href="#cb41-660" aria-hidden="true" tabindex="-1"></a><span class="in">both_results &lt;- all_results[all_results$scenario == "both", ]</span></span>
<span id="cb41-661"><a href="#cb41-661" aria-hidden="true" tabindex="-1"></a><span class="in">both_table &lt;- make_selection_table(both_results, "Both Differ", c("m6"))</span></span>
<span id="cb41-662"><a href="#cb41-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-663"><a href="#cb41-663" aria-hidden="true" tabindex="-1"></a><span class="in">cat("\n### Scenario C: Both Seasonal and Trend Differ (correct = m6)\n\n")</span></span>
<span id="cb41-664"><a href="#cb41-664" aria-hidden="true" tabindex="-1"></a><span class="in">kable(both_table, row.names = FALSE,</span></span>
<span id="cb41-665"><a href="#cb41-665" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Model Selection: Both Differ (100 simulations)")</span></span>
<span id="cb41-666"><a href="#cb41-666" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-667"><a href="#cb41-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-668"><a href="#cb41-668" aria-hidden="true" tabindex="-1"></a><span class="fu">### Analyze Delta AIC Distributions</span></span>
<span id="cb41-669"><a href="#cb41-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-670"><a href="#cb41-670" aria-hidden="true" tabindex="-1"></a>How much does the correct model win by?</span>
<span id="cb41-671"><a href="#cb41-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-672"><a href="#cb41-672" aria-hidden="true" tabindex="-1"></a><span class="in">```{r delta-aic-distributions}</span></span>
<span id="cb41-673"><a href="#cb41-673" aria-hidden="true" tabindex="-1"></a><span class="in"># Plot delta AIC distributions</span></span>
<span id="cb41-674"><a href="#cb41-674" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(all_results, aes(x = delta_aic_to_second, fill = scenario)) +</span></span>
<span id="cb41-675"><a href="#cb41-675" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_histogram(bins = 30, alpha = 0.7, color = "black") +</span></span>
<span id="cb41-676"><a href="#cb41-676" aria-hidden="true" tabindex="-1"></a><span class="in">  geom_vline(xintercept = 2, linetype = "dashed", color = "red", size = 1) +</span></span>
<span id="cb41-677"><a href="#cb41-677" aria-hidden="true" tabindex="-1"></a><span class="in">  annotate("text", x = 2, y = Inf, label = "Delta AIC = 2\n(conventional threshold)",</span></span>
<span id="cb41-678"><a href="#cb41-678" aria-hidden="true" tabindex="-1"></a><span class="in">           vjust = 1.5, hjust = -0.1, color = "red", size = 3) +</span></span>
<span id="cb41-679"><a href="#cb41-679" aria-hidden="true" tabindex="-1"></a><span class="in">  facet_wrap(~ scenario, ncol = 1, scales = "free_y",</span></span>
<span id="cb41-680"><a href="#cb41-680" aria-hidden="true" tabindex="-1"></a><span class="in">             labeller = labeller(scenario = c(</span></span>
<span id="cb41-681"><a href="#cb41-681" aria-hidden="true" tabindex="-1"></a><span class="in">               "seasonal_only" = "Scenario A: Seasonal Only",</span></span>
<span id="cb41-682"><a href="#cb41-682" aria-hidden="true" tabindex="-1"></a><span class="in">               "trend_only" = "Scenario B: Trend Only",</span></span>
<span id="cb41-683"><a href="#cb41-683" aria-hidden="true" tabindex="-1"></a><span class="in">               "both" = "Scenario C: Both Differ"</span></span>
<span id="cb41-684"><a href="#cb41-684" aria-hidden="true" tabindex="-1"></a><span class="in">             ))) +</span></span>
<span id="cb41-685"><a href="#cb41-685" aria-hidden="true" tabindex="-1"></a><span class="in">  scale_fill_manual(values = c("seasonal_only" = "#2C7BB6",</span></span>
<span id="cb41-686"><a href="#cb41-686" aria-hidden="true" tabindex="-1"></a><span class="in">                               "trend_only" = "#D7191C",</span></span>
<span id="cb41-687"><a href="#cb41-687" aria-hidden="true" tabindex="-1"></a><span class="in">                               "both" = "#FDAE61"),</span></span>
<span id="cb41-688"><a href="#cb41-688" aria-hidden="true" tabindex="-1"></a><span class="in">                    labels = c("Seasonal Only", "Trend Only", "Both")) +</span></span>
<span id="cb41-689"><a href="#cb41-689" aria-hidden="true" tabindex="-1"></a><span class="in">  labs(title = "Model Selection Strength: Delta AIC to Second-Best Model",</span></span>
<span id="cb41-690"><a href="#cb41-690" aria-hidden="true" tabindex="-1"></a><span class="in">       subtitle = "Higher values = stronger preference for top model",</span></span>
<span id="cb41-691"><a href="#cb41-691" aria-hidden="true" tabindex="-1"></a><span class="in">       x = "Delta AIC (top model advantage over second-best)",</span></span>
<span id="cb41-692"><a href="#cb41-692" aria-hidden="true" tabindex="-1"></a><span class="in">       y = "Count (out of 100 simulations)",</span></span>
<span id="cb41-693"><a href="#cb41-693" aria-hidden="true" tabindex="-1"></a><span class="in">       fill = "Scenario") +</span></span>
<span id="cb41-694"><a href="#cb41-694" aria-hidden="true" tabindex="-1"></a><span class="in">  theme_minimal() +</span></span>
<span id="cb41-695"><a href="#cb41-695" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(legend.position = "none",</span></span>
<span id="cb41-696"><a href="#cb41-696" aria-hidden="true" tabindex="-1"></a><span class="in">        plot.title = element_text(face = "bold"))</span></span>
<span id="cb41-697"><a href="#cb41-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-698"><a href="#cb41-698" aria-hidden="true" tabindex="-1"></a><span class="in"># Summary statistics</span></span>
<span id="cb41-699"><a href="#cb41-699" aria-hidden="true" tabindex="-1"></a><span class="in">delta_aic_summary &lt;- do.call(rbind, lapply(</span></span>
<span id="cb41-700"><a href="#cb41-700" aria-hidden="true" tabindex="-1"></a><span class="in">  split(all_results, all_results$scenario),</span></span>
<span id="cb41-701"><a href="#cb41-701" aria-hidden="true" tabindex="-1"></a><span class="in">  function(df) {</span></span>
<span id="cb41-702"><a href="#cb41-702" aria-hidden="true" tabindex="-1"></a><span class="in">    data.frame(</span></span>
<span id="cb41-703"><a href="#cb41-703" aria-hidden="true" tabindex="-1"></a><span class="in">      Scenario = unique(df$scenario),</span></span>
<span id="cb41-704"><a href="#cb41-704" aria-hidden="true" tabindex="-1"></a><span class="in">      Min = min(df$delta_aic_to_second),</span></span>
<span id="cb41-705"><a href="#cb41-705" aria-hidden="true" tabindex="-1"></a><span class="in">      Q1 = quantile(df$delta_aic_to_second, 0.25),</span></span>
<span id="cb41-706"><a href="#cb41-706" aria-hidden="true" tabindex="-1"></a><span class="in">      Median = median(df$delta_aic_to_second),</span></span>
<span id="cb41-707"><a href="#cb41-707" aria-hidden="true" tabindex="-1"></a><span class="in">      Mean = mean(df$delta_aic_to_second),</span></span>
<span id="cb41-708"><a href="#cb41-708" aria-hidden="true" tabindex="-1"></a><span class="in">      Q3 = quantile(df$delta_aic_to_second, 0.75),</span></span>
<span id="cb41-709"><a href="#cb41-709" aria-hidden="true" tabindex="-1"></a><span class="in">      Max = max(df$delta_aic_to_second)</span></span>
<span id="cb41-710"><a href="#cb41-710" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb41-711"><a href="#cb41-711" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb41-712"><a href="#cb41-712" aria-hidden="true" tabindex="-1"></a><span class="in">))</span></span>
<span id="cb41-713"><a href="#cb41-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-714"><a href="#cb41-714" aria-hidden="true" tabindex="-1"></a><span class="in">rownames(delta_aic_summary) &lt;- NULL</span></span>
<span id="cb41-715"><a href="#cb41-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-716"><a href="#cb41-716" aria-hidden="true" tabindex="-1"></a><span class="in">kable(delta_aic_summary, digits = 2,</span></span>
<span id="cb41-717"><a href="#cb41-717" aria-hidden="true" tabindex="-1"></a><span class="in">      caption = "Delta AIC Summary Statistics (advantage of top model over second-best)")</span></span>
<span id="cb41-718"><a href="#cb41-718" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb41-719"><a href="#cb41-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-720"><a href="#cb41-720" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model Selection Coverage Interpretation</span></span>
<span id="cb41-721"><a href="#cb41-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-722"><a href="#cb41-722" aria-hidden="true" tabindex="-1"></a>**Key Findings**:</span>
<span id="cb41-723"><a href="#cb41-723" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-724"><a href="#cb41-724" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Scenario A (Seasonal Only)**: The model selection correctly identifies structures with education-specific seasonality (m5 or m6) in X% of simulations.</span>
<span id="cb41-725"><a href="#cb41-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-726"><a href="#cb41-726" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Scenario B (Trend Only)**: The model selection correctly identifies structures with education-specific trends (m4 or m6) in X% of simulations.</span>
<span id="cb41-727"><a href="#cb41-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-728"><a href="#cb41-728" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Scenario C (Both Differ)**: The model selection correctly identifies the full model (m6) in X% of simulations.</span>
<span id="cb41-729"><a href="#cb41-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-730"><a href="#cb41-730" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Selection Strength**: Delta AIC distributions show typical advantage margins. Values &gt;2 indicate substantial support for the selected model.</span>
<span id="cb41-731"><a href="#cb41-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-732"><a href="#cb41-732" aria-hidden="true" tabindex="-1"></a>**What This Validates**:</span>
<span id="cb41-733"><a href="#cb41-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-734"><a href="#cb41-734" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>AIC-based model selection has good **power** to detect education-specific effects when they exist</span>
<span id="cb41-735"><a href="#cb41-735" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The approach is **conservative** - it occasionally selects simpler models when differences are subtle</span>
<span id="cb41-736"><a href="#cb41-736" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>When both effects differ (Scenario C), the full model is strongly preferred (large Delta AIC)</span>
<span id="cb41-737"><a href="#cb41-737" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-738"><a href="#cb41-738" aria-hidden="true" tabindex="-1"></a>**Implications**:</span>
<span id="cb41-739"><a href="#cb41-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-740"><a href="#cb41-740" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For real data: if AIC strongly prefers m6, we have high confidence that both seasonal and trend patterns genuinely differ by education level</span>
<span id="cb41-741"><a href="#cb41-741" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>For real data: if AIC prefers simpler models, education-specific effects may be weak or absent</span>
<span id="cb41-742"><a href="#cb41-742" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Model selection uncertainty should be considered when interpreting real data results</span>
<span id="cb41-743"><a href="#cb41-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-744"><a href="#cb41-744" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary and Conclusions</span></span>
<span id="cb41-745"><a href="#cb41-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-746"><a href="#cb41-746" aria-hidden="true" tabindex="-1"></a><span class="fu">### What We Validated</span></span>
<span id="cb41-747"><a href="#cb41-747" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-748"><a href="#cb41-748" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Seasonal Recovery**: Factor smooth GAMs successfully recover education-specific seasonal patterns with different amplitudes. Relative errors are small (&lt;20%) and orderings are preserved.</span>
<span id="cb41-749"><a href="#cb41-749" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-750"><a href="#cb41-750" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Trend Recovery**: The model recovers education-specific trends, though GAM smoothing can affect exact slope estimates. Orderings are correctly identified.</span>
<span id="cb41-751"><a href="#cb41-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-752"><a href="#cb41-752" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Model Selection**: AIC-based model selection successfully identifies the correct model structure. Coverage validation over 100 simulations per scenario shows:</span>
<span id="cb41-753"><a href="#cb41-753" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Scenario A (seasonal only): Correctly identifies m5 or m6 in majority of cases</span>
<span id="cb41-754"><a href="#cb41-754" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Scenario B (trend only): Correctly identifies m4 or m6 in majority of cases</span>
<span id="cb41-755"><a href="#cb41-755" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Scenario C (both differ): Strongly prefers full model m6</span>
<span id="cb41-756"><a href="#cb41-756" aria-hidden="true" tabindex="-1"></a><span class="ss">   - </span>Delta AIC distributions confirm substantial selection strength</span>
<span id="cb41-757"><a href="#cb41-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-758"><a href="#cb41-758" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Difference Inference**: Trend difference confidence intervals properly account for correlation via the variance-covariance matrix. Coverage appears appropriate.</span>
<span id="cb41-759"><a href="#cb41-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-760"><a href="#cb41-760" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**Coverage Validation**: Test 5 provides systematic validation across 300 total simulations (100 per scenario), demonstrating that model selection has good power to detect education-specific effects when they exist.</span>
<span id="cb41-761"><a href="#cb41-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-762"><a href="#cb41-762" aria-hidden="true" tabindex="-1"></a><span class="fu">### Implications for Real Data Analysis</span></span>
<span id="cb41-763"><a href="#cb41-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-764"><a href="#cb41-764" aria-hidden="true" tabindex="-1"></a>These validation results give us confidence to:</span>
<span id="cb41-765"><a href="#cb41-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-766"><a href="#cb41-766" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Fit factor smooth GAMs to real CPS unemployment data</span>
<span id="cb41-767"><a href="#cb41-767" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Trust education-specific effect estimates</span>
<span id="cb41-768"><a href="#cb41-768" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use model selection to determine which components vary by education</span>
<span id="cb41-769"><a href="#cb41-769" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Make formal comparisons between education levels with valid uncertainty quantification</span>
<span id="cb41-770"><a href="#cb41-770" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Interpret model selection results: strong preference (large Delta AIC) indicates high confidence in education-specific effects</span>
<span id="cb41-771"><a href="#cb41-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-772"><a href="#cb41-772" aria-hidden="true" tabindex="-1"></a><span class="fu">### Limitations</span></span>
<span id="cb41-773"><a href="#cb41-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-774"><a href="#cb41-774" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>GAM smoothing introduces expected bias (shrinkage) in trend estimates toward zero, though patterns and orderings are preserved</span>
<span id="cb41-775"><a href="#cb41-775" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Model selection is conservative - occasionally selects simpler models when differences are subtle</span>
<span id="cb41-776"><a href="#cb41-776" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Real data may have additional complexities (measurement error, structural breaks, policy changes) not present in simulations</span>
<span id="cb41-777"><a href="#cb41-777" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Coverage validation is limited to three specific scenarios with fixed effect sizes</span>
<span id="cb41-778"><a href="#cb41-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-779"><a href="#cb41-779" aria-hidden="true" tabindex="-1"></a><span class="fu">### Next Steps</span></span>
<span id="cb41-780"><a href="#cb41-780" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-781"><a href="#cb41-781" aria-hidden="true" tabindex="-1"></a>Proceed to real data analysis with factor smooth GAMs, applying the modeling framework validated here to 2000-2025 CPS unemployment data for PhD, Master's, and Bachelor's degree holders.</span>
<span id="cb41-782"><a href="#cb41-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-783"><a href="#cb41-783" aria-hidden="true" tabindex="-1"></a>---</span>
<span id="cb41-784"><a href="#cb41-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-785"><a href="#cb41-785" aria-hidden="true" tabindex="-1"></a>**Analysis Date**: <span class="in">`r Sys.Date()`</span></span>
<span id="cb41-786"><a href="#cb41-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-787"><a href="#cb41-787" aria-hidden="true" tabindex="-1"></a>**R Session Info**:</span>
<span id="cb41-788"><a href="#cb41-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-789"><a href="#cb41-789" aria-hidden="true" tabindex="-1"></a><span class="in">```{r session-info}</span></span>
<span id="cb41-790"><a href="#cb41-790" aria-hidden="true" tabindex="-1"></a><span class="in">sessionInfo()</span></span>
<span id="cb41-791"><a href="#cb41-791" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span></code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>