<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Hierarchical ODE State Space Model for Unemployment Dynamics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="state-space-comparison_files/libs/clipboard/clipboard.min.js"></script>
<script src="state-space-comparison_files/libs/quarto-html/quarto.js"></script>
<script src="state-space-comparison_files/libs/quarto-html/popper.min.js"></script>
<script src="state-space-comparison_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="state-space-comparison_files/libs/quarto-html/anchor.min.js"></script>
<link href="state-space-comparison_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="state-space-comparison_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="state-space-comparison_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="state-space-comparison_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="state-space-comparison_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a>
  <ul class="collapse">
  <li><a href="#key-features" id="toc-key-features" class="nav-link" data-scroll-target="#key-features">Key Features</a></li>
  </ul></li>
  <li><a href="#model-structure-a-comprehensive-mathematical-walkthrough" id="toc-model-structure-a-comprehensive-mathematical-walkthrough" class="nav-link" data-scroll-target="#model-structure-a-comprehensive-mathematical-walkthrough">Model Structure: A Comprehensive Mathematical Walkthrough</a>
  <ul class="collapse">
  <li><a href="#economic-foundation-labor-market-flow-dynamics" id="toc-economic-foundation-labor-market-flow-dynamics" class="nav-link" data-scroll-target="#economic-foundation-labor-market-flow-dynamics">1. Economic Foundation: Labor Market Flow Dynamics</a></li>
  <li><a href="#extending-the-basic-model" id="toc-extending-the-basic-model" class="nav-link" data-scroll-target="#extending-the-basic-model">2. Extending the Basic Model</a></li>
  <li><a href="#stan-implementation-block-by-block" id="toc-stan-implementation-block-by-block" class="nav-link" data-scroll-target="#stan-implementation-block-by-block">3. Stan Implementation: Block by Block</a></li>
  <li><a href="#why-this-model-succeeds-where-gam-fails" id="toc-why-this-model-succeeds-where-gam-fails" class="nav-link" data-scroll-target="#why-this-model-succeeds-where-gam-fails">4. Why This Model Succeeds Where GAM Fails</a></li>
  </ul></li>
  <li><a href="#hierarchical-parameter-structure" id="toc-hierarchical-parameter-structure" class="nav-link" data-scroll-target="#hierarchical-parameter-structure">Hierarchical Parameter Structure</a>
  <ul class="collapse">
  <li><a href="#hierarchical-parameters" id="toc-hierarchical-parameters" class="nav-link" data-scroll-target="#hierarchical-parameters">Hierarchical Parameters</a></li>
  <li><a href="#non-hierarchical-parameters" id="toc-non-hierarchical-parameters" class="nav-link" data-scroll-target="#non-hierarchical-parameters">Non-Hierarchical Parameters</a></li>
  <li><a href="#benefits-of-hierarchical-pooling" id="toc-benefits-of-hierarchical-pooling" class="nav-link" data-scroll-target="#benefits-of-hierarchical-pooling">Benefits of Hierarchical Pooling</a></li>
  </ul></li>
  <li><a href="#data-preparation" id="toc-data-preparation" class="nav-link" data-scroll-target="#data-preparation">Data Preparation</a></li>
  <li><a href="#model-fitting" id="toc-model-fitting" class="nav-link" data-scroll-target="#model-fitting">Model Fitting</a></li>
  <li><a href="#economic-parameter-estimates" id="toc-economic-parameter-estimates" class="nav-link" data-scroll-target="#economic-parameter-estimates">Economic Parameter Estimates</a>
  <ul class="collapse">
  <li><a href="#separation-and-finding-rates" id="toc-separation-and-finding-rates" class="nav-link" data-scroll-target="#separation-and-finding-rates">Separation and Finding Rates</a></li>
  <li><a href="#shock-effects" id="toc-shock-effects" class="nav-link" data-scroll-target="#shock-effects">Shock Effects</a></li>
  </ul></li>
  <li><a href="#latent-unemployment-trajectories" id="toc-latent-unemployment-trajectories" class="nav-link" data-scroll-target="#latent-unemployment-trajectories">Latent Unemployment Trajectories</a></li>
  <li><a href="#non-seasonal-trend" id="toc-non-seasonal-trend" class="nav-link" data-scroll-target="#non-seasonal-trend">Non-Seasonal Trend</a>
  <ul class="collapse">
  <li><a href="#seasonal-oscillation-direct-visualization" id="toc-seasonal-oscillation-direct-visualization" class="nav-link" data-scroll-target="#seasonal-oscillation-direct-visualization">Seasonal Oscillation: Direct Visualization</a></li>
  <li><a href="#monthly-seasonal-pattern" id="toc-monthly-seasonal-pattern" class="nav-link" data-scroll-target="#monthly-seasonal-pattern">Monthly Seasonal Pattern</a></li>
  <li><a href="#model-decomposition-full-vs-trend-vs-pure-ode" id="toc-model-decomposition-full-vs-trend-vs-pure-ode" class="nav-link" data-scroll-target="#model-decomposition-full-vs-trend-vs-pure-ode">Model Decomposition: Full vs Trend vs Pure ODE</a></li>
  <li><a href="#zoom-seasonal-oscillation-detail-2017-2019" id="toc-zoom-seasonal-oscillation-detail-2017-2019" class="nav-link" data-scroll-target="#zoom-seasonal-oscillation-detail-2017-2019">Zoom: Seasonal Oscillation Detail (2017-2019)</a></li>
  <li><a href="#zoom-most-recent-12-months" id="toc-zoom-most-recent-12-months" class="nav-link" data-scroll-target="#zoom-most-recent-12-months">Zoom: Most Recent 12 Months</a></li>
  </ul></li>
  <li><a href="#model-diagnostics" id="toc-model-diagnostics" class="nav-link" data-scroll-target="#model-diagnostics">Model Diagnostics</a>
  <ul class="collapse">
  <li><a href="#comprehensive-diagnostics-summary" id="toc-comprehensive-diagnostics-summary" class="nav-link" data-scroll-target="#comprehensive-diagnostics-summary">Comprehensive Diagnostics Summary</a></li>
  <li><a href="#divergence-diagnostics" id="toc-divergence-diagnostics" class="nav-link" data-scroll-target="#divergence-diagnostics">Divergence Diagnostics</a></li>
  <li><a href="#energy-diagnostics-e-bfmi" id="toc-energy-diagnostics-e-bfmi" class="nav-link" data-scroll-target="#energy-diagnostics-e-bfmi">Energy Diagnostics (E-BFMI)</a></li>
  <li><a href="#trace-plots-for-key-parameters" id="toc-trace-plots-for-key-parameters" class="nav-link" data-scroll-target="#trace-plots-for-key-parameters">Trace Plots for Key Parameters</a></li>
  <li><a href="#rhat-and-effective-sample-size" id="toc-rhat-and-effective-sample-size" class="nav-link" data-scroll-target="#rhat-and-effective-sample-size">Rhat and Effective Sample Size</a></li>
  <li><a href="#posterior-predictive-check" id="toc-posterior-predictive-check" class="nav-link" data-scroll-target="#posterior-predictive-check">Posterior Predictive Check</a></li>
  </ul></li>
  <li><a href="#model-fit-assessment-loo-cv" id="toc-model-fit-assessment-loo-cv" class="nav-link" data-scroll-target="#model-fit-assessment-loo-cv">Model Fit Assessment (LOO-CV)</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a>
  <ul class="collapse">
  <li><a href="#model-quality" id="toc-model-quality" class="nav-link" data-scroll-target="#model-quality">Model Quality</a></li>
  <li><a href="#key-findings" id="toc-key-findings" class="nav-link" data-scroll-target="#key-findings">Key Findings</a></li>
  <li><a href="#technical-success" id="toc-technical-success" class="nav-link" data-scroll-target="#technical-success">Technical Success</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Hierarchical ODE State Space Model for Unemployment Dynamics</h1>
<p class="subtitle lead">A Bayesian Approach with Pooled Labor Market Parameters</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>This report presents a hierarchical Bayesian state space model for unemployment dynamics across education levels. The model explicitly represents labor market flows through an ordinary differential equation (ODE) framework, with hierarchical pooling to share information across education groups.</p>
<section id="key-features" class="level3">
<h3 class="anchored" data-anchor-id="key-features">Key Features</h3>
<p><strong>Economic Foundation</strong> - Explicit labor market dynamics: <span class="math inline">\(\frac{dU}{dt} = s(1-U) - fU\)</span> - Separation rate (<span class="math inline">\(s\)</span>): probability of job loss per month - Finding rate (<span class="math inline">\(f\)</span>): probability of job finding per month - Equilibrium unemployment: <span class="math inline">\(u^* = \frac{s}{s+f}\)</span></p>
<p><strong>Hierarchical Structure</strong> - Population-level means with education-specific deviations - Pooling strengthens inference for small groups - Hierarchical parameters: equilibrium unemployment, adjustment speed, shock magnitudes, recovery rates, seasonal effects</p>
<p><strong>Shock Modeling</strong> - Explicit shock effects on separation rates (2008, 2020) - Education-specific shock magnitudes with pooling - Decay parameters capture recovery dynamics</p>
<p><strong>Technical Innovations</strong> - Spline basis for smooth residual variation (25 basis functions) - Non-centered parameterization for sampling efficiency - Data-informed priors from exploratory model fits - Prior-centered initialization to avoid multimodality</p>
</section>
</section>
<section id="model-structure-a-comprehensive-mathematical-walkthrough" class="level2">
<h2 class="anchored" data-anchor-id="model-structure-a-comprehensive-mathematical-walkthrough">Model Structure: A Comprehensive Mathematical Walkthrough</h2>
<p>This section provides a detailed explanation of the Stan model, including the economic theory, mathematical derivations, and implementation details.</p>
<section id="economic-foundation-labor-market-flow-dynamics" class="level3">
<h3 class="anchored" data-anchor-id="economic-foundation-labor-market-flow-dynamics">1. Economic Foundation: Labor Market Flow Dynamics</h3>
<p>The model is built on the <strong>stock-flow</strong> framework from labor economics. At any point in time, the labor force is divided into two stocks: employed (<span class="math inline">\(E\)</span>) and unemployed (<span class="math inline">\(U\)</span>), with <span class="math inline">\(E + U = L\)</span> (total labor force). Workers flow between these states:</p>
<pre><code>       separation (s)
  E ─────────────────────→ U
    ←────────────────────
       finding (f)</code></pre>
<section id="the-continuous-time-ode" class="level4">
<h4 class="anchored" data-anchor-id="the-continuous-time-ode">1.1 The Continuous-Time ODE</h4>
<p>The rate of change in unemployment follows the ordinary differential equation:</p>
<p><span class="math display">\[\frac{dU}{dt} = s \cdot E - f \cdot U = s \cdot (L - U) - f \cdot U\]</span></p>
<p>Dividing by <span class="math inline">\(L\)</span> to get rates (lowercase <span class="math inline">\(u = U/L\)</span>):</p>
<p><span class="math display">\[\frac{du}{dt} = s \cdot (1-u) - f \cdot u\]</span></p>
<p><strong>Term-by-term interpretation:</strong></p>
<ul>
<li><span class="math inline">\(s \cdot (1-u)\)</span>: <strong>Inflow to unemployment</strong> — employed workers (fraction <span class="math inline">\(1-u\)</span>) lose jobs at rate <span class="math inline">\(s\)</span></li>
<li><span class="math inline">\(f \cdot u\)</span>: <strong>Outflow from unemployment</strong> — unemployed workers (fraction <span class="math inline">\(u\)</span>) find jobs at rate <span class="math inline">\(f\)</span></li>
<li>Net change = inflow − outflow</li>
</ul>
</section>
<section id="equilibrium-analysis" class="level4">
<h4 class="anchored" data-anchor-id="equilibrium-analysis">1.2 Equilibrium Analysis</h4>
<p>At equilibrium, <span class="math inline">\(\frac{du}{dt} = 0\)</span>, so:</p>
<p><span class="math display">\[s \cdot (1-u^*) = f \cdot u^*\]</span></p>
<p>Solving for <span class="math inline">\(u^*\)</span>:</p>
<p><span class="math display">\[s - s \cdot u^* = f \cdot u^*\]</span> <span class="math display">\[s = u^* \cdot (s + f)\]</span> <span class="math display">\[\boxed{u^* = \frac{s}{s + f}}\]</span></p>
<p><strong>Economic implications:</strong></p>
<ul>
<li>If <span class="math inline">\(s = 0.02\)</span> (2% monthly separation) and <span class="math inline">\(f = 0.30\)</span> (30% monthly finding): <span class="math inline">\(u^* = 0.02/(0.02+0.30) = 6.25\%\)</span></li>
<li><strong>Higher education</strong> → Lower <span class="math inline">\(s\)</span>, higher <span class="math inline">\(f\)</span> → Lower equilibrium unemployment</li>
<li><strong>Shocks</strong> temporarily increase <span class="math inline">\(s\)</span> → Push <span class="math inline">\(u\)</span> above equilibrium</li>
</ul>
</section>
<section id="dynamics-speed-of-adjustment" class="level4">
<h4 class="anchored" data-anchor-id="dynamics-speed-of-adjustment">1.3 Dynamics: Speed of Adjustment</h4>
<p>The ODE can be rewritten as:</p>
<p><span class="math display">\[\frac{du}{dt} = s - (s + f) \cdot u = (s + f) \cdot \left(\frac{s}{s+f} - u\right) = (s + f) \cdot (u^* - u)\]</span></p>
<p>This shows that <span class="math inline">\(u\)</span> moves toward <span class="math inline">\(u^*\)</span> at rate <span class="math inline">\((s + f)\)</span>. The <strong>half-life</strong> of adjustment is:</p>
<p><span class="math display">\[t_{1/2} = \frac{\ln(2)}{s + f}\]</span></p>
<p>With <span class="math inline">\(s + f \approx 0.32\)</span> per month, the half-life is about 2 months — unemployment adjusts quickly to equilibrium.</p>
</section>
</section>
<section id="extending-the-basic-model" class="level3">
<h3 class="anchored" data-anchor-id="extending-the-basic-model">2. Extending the Basic Model</h3>
<p>The real world is more complex. We extend the model with:</p>
<section id="education-heterogeneity" class="level4">
<h4 class="anchored" data-anchor-id="education-heterogeneity">2.1 Education Heterogeneity</h4>
<p>Different education levels have different labor market characteristics:</p>
<p><span class="math display">\[\frac{du_i}{dt} = s_i \cdot (1-u_i) - f_i \cdot u_i\]</span></p>
<p>where <span class="math inline">\(i\)</span> indexes education level. We use <strong>hierarchical priors</strong>:</p>
<p><span class="math display">\[s_i \sim \text{Normal}(\mu_s, \sigma_s) \quad \text{with } \mu_s \sim \text{Normal}(0.02, 0.01)\]</span></p>
<p>This allows education levels to share information while having distinct rates.</p>
</section>
<section id="economic-shocks" class="level4">
<h4 class="anchored" data-anchor-id="economic-shocks">2.2 Economic Shocks</h4>
<p>During recessions, separation rates spike. We model this as:</p>
<p><span class="math display">\[s_i^{\text{eff}}(t) = s_i + I_{2008}(t) \cdot \delta_{2008,i} + I_{2020}(t) \cdot \delta_{2020,i}\]</span></p>
<p>where <span class="math inline">\(I(t)\)</span> is a <strong>shock impulse function</strong> and <span class="math inline">\(\delta_i\)</span> is the education-specific shock effect.</p>
<p><strong>Impulse function design</strong> (for 2008):</p>
<p><span class="math display">\[I_{2008}(t) = \begin{cases}
0 &amp; t &lt; t_{\text{onset}} \\
\frac{t - t_{\text{onset}}}{t_{\text{peak}} - t_{\text{onset}}} &amp; t_{\text{onset}} \leq t \leq t_{\text{peak}} \\
e^{-\lambda_i (t - t_{\text{peak}})} &amp; t &gt; t_{\text{peak}}
\end{cases}\]</span></p>
<ul>
<li><strong>Before onset</strong> (<span class="math inline">\(t &lt; 2007.75\)</span>): No effect</li>
<li><strong>Rise phase</strong> (<span class="math inline">\(2007.75 \leq t \leq 2009.5\)</span>): Linear rise as crisis develops</li>
<li><strong>Decay phase</strong> (<span class="math inline">\(t &gt; 2009.5\)</span>): Exponential recovery with <strong>education-specific</strong> decay rate <span class="math inline">\(\lambda_i\)</span></li>
</ul>
<p>The half-life of recovery is <span class="math inline">\(t_{1/2} = \ln(2)/\lambda_i\)</span>. Different education levels may recover at different speeds.</p>
</section>
<section id="seasonal-effects" class="level4">
<h4 class="anchored" data-anchor-id="seasonal-effects">2.3 Seasonal Effects</h4>
<p>The model includes a <strong>direct seasonal effect on unemployment</strong> (on the logit scale):</p>
<p><span class="math display">\[\text{logit}(u_{t,i}) = \text{logit}(u_{t-1,i}) + \Delta u_{t,i} + \gamma^u_{m(t),i} + \epsilon_{t,i}\]</span></p>
<p>This captures observed seasonal patterns such as academic calendar effects for PhDs, summer employment fluctuations, and annual hiring cycles. Prior: <span class="math inline">\(\gamma^u_{m,i} \sim \text{Normal}(0, 0.05)\)</span> with a sum-to-zero constraint.</p>
<p><strong>Design choice</strong>: We use a direct effect on unemployment rather than modulating the finding rate because the two approaches are not separately identifiable from the data. The direct approach is simpler and more flexible.</p>
</section>
<section id="state-space-formulation" class="level4">
<h4 class="anchored" data-anchor-id="state-space-formulation">2.4 State Space Formulation</h4>
<p>We observe <strong>counts</strong> (binomial samples from the latent unemployment rate), not the true rate. The model has two layers:</p>
<p><strong>Process model</strong> (latent state evolution): <span class="math display">\[\text{logit}(u_{t,i}) = \text{logit}(u_{t-1,i}) + \Delta u_{t,i} + \epsilon_{t,i}\]</span></p>
<p>where: - <span class="math inline">\(\Delta u_{t,i}\)</span> is the ODE-predicted change - <span class="math inline">\(\epsilon_{t,i} \sim \text{Normal}(0, \sigma_{\text{state}})\)</span> is the <strong>innovation</strong> (captures unexplained dynamics)</p>
<p><strong>Observation model</strong> (data likelihood): <span class="math display">\[n_{\text{unemployed},t,i} \sim \text{Beta-Binomial}(n_{\text{total},t,i}, u_{t,i} \cdot \phi, (1-u_{t,i}) \cdot \phi)\]</span></p>
<p>The <strong>beta-binomial</strong> distribution allows for overdispersion (more variance than binomial) through parameter <span class="math inline">\(\phi\)</span>.</p>
</section>
</section>
<section id="stan-implementation-block-by-block" class="level3">
<h3 class="anchored" data-anchor-id="stan-implementation-block-by-block">3. Stan Implementation: Block by Block</h3>
<p>The Stan model implements this in several blocks:</p>
<section id="functions-block" class="level4">
<h4 class="anchored" data-anchor-id="functions-block">3.1 Functions Block</h4>
<div class="sourceCode" id="cb2"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">functions</span> {</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span> shock_impulse(<span class="dt">real</span> t, <span class="dt">real</span> onset, <span class="dt">real</span> peak, <span class="dt">real</span> decay_rate) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (t &lt; onset) <span class="cf">return</span> <span class="dv">0</span>;</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (t &lt;= peak) <span class="cf">return</span> (t - onset) / (peak - onset);</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">return</span> exp(-decay_rate * (t - peak));</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This defines the impulse response function <span class="math inline">\(I(t)\)</span> for shocks.</p>
</section>
<section id="data-block" class="level4">
<h4 class="anchored" data-anchor-id="data-block">3.2 Data Block</h4>
<div class="sourceCode" id="cb3"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; T;                           <span class="co">// Time points (months)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; N_edu;                       <span class="co">// Education levels</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[T, N_edu] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; n_unemployed; <span class="co">// Counts</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[T, N_edu] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; n_total;      <span class="co">// Denominators</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[T] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>, <span class="kw">upper</span>=<span class="dv">12</span>&gt; month;     <span class="co">// For seasonality</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[T] <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; year_frac;          <span class="co">// Continuous time</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Shock timing...</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="transformed-data-block" class="level4">
<h4 class="anchored" data-anchor-id="transformed-data-block">3.3 Transformed Data Block</h4>
<p>Pre-computes shock rise phases and time-since-peak for efficiency:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed data</span> {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[T] <span class="dt">real</span> shock_2008_rise;</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[T] <span class="dt">real</span> time_since_2008_peak;</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// ... (computed from onset/peak timing)</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="parameters-block" class="level4">
<h4 class="anchored" data-anchor-id="parameters-block">3.4 Parameters Block</h4>
<div class="sourceCode" id="cb5"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Latent states</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>[N_edu] logit_u_init;              <span class="co">// Initial unemployment</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[T<span class="dv">-1</span>] <span class="dt">vector</span>[N_edu] logit_u_innov;  <span class="co">// Innovations</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Separation rates (hierarchical)</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; mu_separation;</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma_separation;</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=<span class="fl">0.2</span>&gt;[N_edu] separation_rate;</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Finding rates (hierarchical)</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; mu_finding;</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma_finding;</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=<span class="dv">1</span>&gt;[N_edu] finding_rate;</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Shock effects (education-specific)</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt;[N_edu] shock_2008_effect;</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt;[N_edu] shock_2020_effect;</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>&lt;<span class="kw">lower</span>=<span class="fl">0.1</span>, <span class="kw">upper</span>=<span class="dv">5</span>&gt;[N_edu] decay_2008;  <span class="co">// Education-specific decay</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">vector</span>&lt;<span class="kw">lower</span>=<span class="fl">0.1</span>, <span class="kw">upper</span>=<span class="dv">5</span>&gt;[N_edu] decay_2020;</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Seasonal effects (11 free, 12th constrained)</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[<span class="dv">11</span>, N_edu] seasonal_raw;</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Noise parameters</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; sigma_state;</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; phi;</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="transformed-parameters-block" class="level4">
<h4 class="anchored" data-anchor-id="transformed-parameters-block">3.5 Transformed Parameters Block</h4>
<p>This is where the ODE dynamics are computed:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">transformed parameters</span> {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[T] <span class="dt">vector</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>, <span class="kw">upper</span>=<span class="dv">1</span>&gt;[N_edu] u;</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">matrix</span>[<span class="dv">12</span>, N_edu] seasonal;</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[T] <span class="dt">vector</span>[N_edu] logit_u;</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[T] <span class="dt">vector</span>[N_edu] shock_2008_intensity;</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">array</span>[T] <span class="dt">vector</span>[N_edu] shock_2020_intensity;</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Build sum-to-zero seasonal constraint</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:N_edu) {</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    seasonal[<span class="dv">1</span>:<span class="dv">11</span>, i] = seasonal_raw[, i];</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    seasonal[<span class="dv">12</span>, i] = -sum(seasonal_raw[, i]);</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Compute education-specific shock intensities</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span>:T) {</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:N_edu) {</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>      shock_2008_intensity[t][i] = shock_2008_rise[t] *</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        exp(-decay_2008[i] * time_since_2008_peak[t]);</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>      shock_2020_intensity[t][i] = shock_2020_rise[t] *</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>        exp(-decay_2020[i] * time_since_2020_peak[t]);</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Initialize</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  logit_u[<span class="dv">1</span>] = logit_u_init;</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  u[<span class="dv">1</span>] = inv_logit(logit_u[<span class="dv">1</span>]);</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="co">// State evolution</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">2</span>:T) {</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:N_edu) {</span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Effective separation rate</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> s_eff = separation_rate[i]</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>                   + shock_2008_intensity[t][i] * shock_2008_effect[i]</span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>                   + shock_2020_intensity[t][i] * shock_2020_effect[i];</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Effective finding rate with seasonal</span></span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> f_eff = finding_rate[i] * (<span class="dv">1</span> + seasonal[month[t], i]);</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Discretized ODE</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a>      <span class="dt">real</span> du_dt = s_eff * (<span class="dv">1</span> - u[t<span class="dv">-1</span>][i]) - f_eff * u[t<span class="dv">-1</span>][i];</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Evolution with innovation</span></span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a>      logit_u[t][i] = logit_u[t<span class="dv">-1</span>][i] + du_dt + logit_u_innov[t<span class="dv">-1</span>][i];</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a>    u[t] = inv_logit(logit_u[t]);</span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="model-block-priors-and-likelihood" class="level4">
<h4 class="anchored" data-anchor-id="model-block-priors-and-likelihood">3.6 Model Block (Priors and Likelihood)</h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode stan code-with-copy"><code class="sourceCode stan"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="co">// === PRIORS ===</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Separation rates (1-3% per month from literature)</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  mu_separation ~ normal(<span class="fl">0.02</span>, <span class="fl">0.01</span>);</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  sigma_separation ~ exponential(<span class="dv">50</span>);</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  separation_rate ~ normal(mu_separation, sigma_separation);</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Finding rates (20-40% per month)</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  mu_finding ~ normal(<span class="fl">0.30</span>, <span class="fl">0.10</span>);</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  sigma_finding ~ exponential(<span class="dv">5</span>);</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  finding_rate ~ normal(mu_finding, sigma_finding);</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Shock effects (positive by constraint)</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  shock_2008_effect ~ normal(<span class="fl">0.02</span>, <span class="fl">0.01</span>);</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  shock_2020_effect ~ normal(<span class="fl">0.03</span>, <span class="fl">0.015</span>);</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Decay rates (education-specific)</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  decay_2008 ~ normal(<span class="fl">0.5</span>, <span class="fl">0.3</span>);</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  decay_2020 ~ normal(<span class="fl">1.0</span>, <span class="fl">0.5</span>);</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Seasonal effects (substantial amplitude allowed)</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  to_vector(seasonal_raw) ~ normal(<span class="dv">0</span>, <span class="fl">0.15</span>);</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  <span class="co">// State innovations</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  sigma_state ~ exponential(<span class="dv">20</span>);</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span>:(T<span class="dv">-1</span>)) {</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>    logit_u_innov[t] ~ normal(<span class="dv">0</span>, sigma_state);</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Overdispersion</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>  phi ~ exponential(<span class="fl">0.05</span>);</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">// === LIKELIHOOD ===</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (t <span class="cf">in</span> <span class="dv">1</span>:T) {</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span>:N_edu) {</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (n_total[t, i] &gt; <span class="dv">0</span>) {</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>        <span class="dt">real</span> u_safe = fmin(fmax(u[t][i], <span class="fl">1e-6</span>), <span class="dv">1</span> - <span class="fl">1e-6</span>);</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>        n_unemployed[t, i] ~ beta_binomial(n_total[t, i],</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>                                            u_safe * phi,</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>                                            (<span class="dv">1</span> - u_safe) * phi);</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="generated-quantities-block" class="level4">
<h4 class="anchored" data-anchor-id="generated-quantities-block">3.7 Generated Quantities Block</h4>
<p>Computes derived quantities and model decomposition:</p>
<ul>
<li><strong>Equilibrium rates</strong>: <span class="math inline">\(u^*_i = s_i / (s_i + f_i)\)</span></li>
<li><strong>Half-lives</strong>: <span class="math inline">\(t_{1/2} = \ln(2) / \lambda_i\)</span> (education-specific)</li>
<li><strong>Trend trajectory</strong>: Evolution without seasonal effects</li>
<li><strong>Pure ODE trajectory</strong>: Evolution without innovations or seasonality</li>
<li><strong>Seasonal effects</strong>: Difference between full model and trend</li>
<li><strong>Log-likelihood</strong>: For LOO cross-validation</li>
<li><strong>Posterior predictive</strong>: For model checking</li>
</ul>
</section>
</section>
<section id="why-this-model-succeeds-where-gam-fails" class="level3">
<h3 class="anchored" data-anchor-id="why-this-model-succeeds-where-gam-fails">4. Why This Model Succeeds Where GAM Fails</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 21%">
<col style="width: 31%">
<col style="width: 46%">
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th>GAM Approach</th>
<th>State Space Model</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Shock mechanism</strong></td>
<td>Indicator variable (absorbed by trend)</td>
<td>Explicit ODE term with decay</td>
</tr>
<tr class="even">
<td><strong>Temporal structure</strong></td>
<td>Smooth function (static)</td>
<td>Dynamic state evolution</td>
</tr>
<tr class="odd">
<td><strong>Prior information</strong></td>
<td>Penalty on curvature</td>
<td>Informative economic priors</td>
</tr>
<tr class="even">
<td><strong>Shock identification</strong></td>
<td>Competes with 501-EDF trend</td>
<td>Structurally separated from trend</td>
</tr>
<tr class="odd">
<td><strong>Interpretation</strong></td>
<td>Abstract smooth values</td>
<td>Separation/finding rates</td>
</tr>
<tr class="even">
<td><strong>Recovery dynamics</strong></td>
<td>Not modeled</td>
<td>Education-specific decay rates</td>
</tr>
<tr class="odd">
<td><strong>Seasonality</strong></td>
<td>Cyclic smooth</td>
<td>Finding rate multiplier</td>
</tr>
</tbody>
</table>
<p><strong>The fundamental insight</strong>: By building economic structure into the model (separation → unemployment → finding), shock effects have a clear mechanistic role. The explicit ODE dynamics provide interpretable estimates of labor market flows.</p>
</section>
</section>
<section id="hierarchical-parameter-structure" class="level2">
<h2 class="anchored" data-anchor-id="hierarchical-parameter-structure">Hierarchical Parameter Structure</h2>
<p>The model uses hierarchical priors to pool information across education levels, improving estimation efficiency while allowing group-specific variation.</p>
<section id="hierarchical-parameters" class="level3">
<h3 class="anchored" data-anchor-id="hierarchical-parameters">Hierarchical Parameters</h3>
<p><strong>1. Equilibrium Unemployment (<span class="math inline">\(u_{eq}\)</span>)</strong></p>
<pre><code>μ_logit_u_eq ~ Normal(-3.3, 0.3)           # Population mean (logit scale)
σ_logit_u_eq ~ Exponential(2)              # Between-education SD
logit_u_eq[i] = μ_logit_u_eq + σ_logit_u_eq * u_eq_raw[i]</code></pre>
<ul>
<li>Centers on ~3.5% equilibrium unemployment</li>
<li>Allows education-specific deviations</li>
<li>Non-centered for efficient sampling</li>
</ul>
<p><strong>2. Adjustment Speed (<span class="math inline">\(s + f\)</span>)</strong></p>
<pre><code>μ_log_adj_speed ~ Normal(2.3, 0.5)         # Population mean (log scale)
σ_log_adj_speed ~ Exponential(1)           # Between-education SD
log_adj_speed[i] = μ_log_adj_speed + σ_log_adj_speed * adj_speed_raw[i]</code></pre>
<ul>
<li>Data-informed prior: exp(2.3) ≈ 10</li>
<li>Controls speed of adjustment to equilibrium</li>
<li>Note: implicitly scaled ~30x by logit dynamics</li>
</ul>
<p><strong>3. Shock Magnitudes (2008, 2020)</strong></p>
<pre><code>μ_log_shock_2008 ~ Normal(-2, 0.8)         # Population mean
σ_log_shock_2008 ~ Exponential(1)          # Between-education SD
log_shock_2008[i] = μ_log_shock_2008 + σ_log_shock_2008 * shock_2008_raw[i]

μ_log_shock_2020 ~ Normal(-1.5, 0.8)       # Population mean
σ_log_shock_2020 ~ Exponential(1)          # Between-education SD
log_shock_2020[i] = μ_log_shock_2020 + σ_log_shock_2020 * shock_2020_raw[i]</code></pre>
<ul>
<li>Pools shock effects across education levels</li>
<li>2008: exp(-2) ≈ 0.14 (14% increase in separation rate)</li>
<li>2020: exp(-1.5) ≈ 0.22 (22% increase in separation rate)</li>
</ul>
<p><strong>4. Recovery Rates (Decay)</strong></p>
<pre><code>μ_decay_2008 ~ Normal(0, 0.5)              # Population mean (logit scale)
σ_decay_2008 ~ Exponential(1)              # Between-education SD
decay_2008[i] = 0.1 + 4.9 * inv_logit(μ_decay_2008 + σ_decay_2008 * decay_2008_raw[i])

μ_decay_2020 ~ Normal(0, 0.5)              # Population mean (logit scale)
σ_decay_2020 ~ Exponential(1)              # Between-education SD
decay_2020[i] = 0.1 + 4.9 * inv_logit(μ_decay_2020 + σ_decay_2020 * decay_2020_raw[i])</code></pre>
<ul>
<li>Constrained to [0.1, 5] range</li>
<li>Centers on ~2.5 (moderate recovery)</li>
<li>Pooling prevents overfitting with limited shock data</li>
</ul>
<p><strong>5. Seasonal Effects</strong></p>
<pre><code>μ_seasonal ~ Normal(0, 0.03)               # Population mean pattern (11 months)
sum(μ_seasonal) ~ Normal(0, 0.001)         # Soft sum-to-zero constraint
σ_seasonal ~ Exponential(10)               # Between-education SD (mean = 0.1)
seasonal_u[1:11, i] = μ_seasonal + σ_seasonal * seasonal_u_raw[, i]</code></pre>
<ul>
<li>Hierarchical pooling of monthly seasonal patterns</li>
<li>Population-level pattern with education-specific deviations</li>
<li>12th month derived: <code>seasonal_u[12, i] = -sum(seasonal_u[1:11, i])</code></li>
<li>Modest effects (~1-3% on logit scale)</li>
</ul>
</section>
<section id="non-hierarchical-parameters" class="level3">
<h3 class="anchored" data-anchor-id="non-hierarchical-parameters">Non-Hierarchical Parameters</h3>
<p><strong>Initial States</strong> - Starting unemployment levels - Not hierarchical (equilibrium handles long-run behavior) - Prior: Normal(-3.0, 0.5) on logit scale</p>
<p><strong>Spline Smoothness</strong> - Global σ_spline parameter - Data-informed: Normal(0.8, 0.3) - Controls residual smooth variation</p>
<p><strong>Overdispersion</strong> - Beta-binomial φ parameter - Data-informed: log(φ-1) ~ Normal(8.5, 0.5) → φ ≈ 5000 - Accounts for extra-binomial variation</p>
</section>
<section id="benefits-of-hierarchical-pooling" class="level3">
<h3 class="anchored" data-anchor-id="benefits-of-hierarchical-pooling">Benefits of Hierarchical Pooling</h3>
<ol type="1">
<li><strong>Improved Estimates</strong>: Small groups (PhDs, professionals) borrow strength from population</li>
<li><strong>Regularization</strong>: Prevents overfitting of education-specific parameters</li>
<li><strong>Identifiability</strong>: Constrains some_college adjustment speed through population effect</li>
<li><strong>Interpretability</strong>: Population means are directly interpretable aggregates</li>
</ol>
</section>
</section>
<section id="data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="data-preparation">Data Preparation</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the education-level count data</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>counts_data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"education-spectrum-counts.rds"</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare for Stan</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>stan_data <span class="ot">&lt;-</span> <span class="fu">prepare_stan_data</span>(counts_data)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Time series length: %d months</span><span class="sc">\n</span><span class="st">"</span>, stan_data<span class="sc">$</span>T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Time series length: 310 months</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Education levels: %d</span><span class="sc">\n</span><span class="st">"</span>, stan_data<span class="sc">$</span>N_edu))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Education levels: 7</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Education categories: %s</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste</span>(stan_data<span class="sc">$</span>education_levels, <span class="at">collapse =</span> <span class="st">", "</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Education categories: bachelors, high_school, less_than_hs, masters, phd, professional, some_college</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Date range: %.2f to %.2f</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>            <span class="fu">min</span>(stan_data<span class="sc">$</span>year_frac), <span class="fu">max</span>(stan_data<span class="sc">$</span>year_frac)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Date range: 2000.04 to 2025.88</code></pre>
</div>
</div>
</section>
<section id="model-fitting" class="level2">
<h2 class="anchored" data-anchor-id="model-fitting">Model Fitting</h2>
<p>We use the <strong>efficient spline-based model</strong> which reduces dimensionality from ~2100 to ~105 latent parameters, enabling proper MCMC sampling.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the hierarchical shock model (v2 with data-informed priors)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Load from targets pipeline (if available) or use fallback to manual caching</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>targets_cache <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"models"</span>, <span class="st">"ode-state-space-efficient-fit.qs"</span>)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>fallback_cache <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"models"</span>, <span class="st">"ode_hierarchical_v2_fit.rds"</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>fallback_meta <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">"models"</span>, <span class="st">"ode_hierarchical_v2_meta.rds"</span>)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>K_SPLINE <span class="ot">&lt;-</span> <span class="dv">25</span>  <span class="co"># Spline basis functions</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Try to load from targets first, then fallback to manual cache</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">file.exists</span>(targets_cache)) {</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Loading model from targets pipeline (qs format)...</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> qs<span class="sc">::</span><span class="fu">qread</span>(targets_cache)</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">file.exists</span>(fallback_cache) <span class="sc">&amp;&amp;</span> <span class="fu">file.exists</span>(fallback_meta)) {</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Loading cached hierarchical decay model (RDS format)...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"(Recommend running `targets::tar_make(model_ode_state_space_efficient)` for pipeline integration)</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(fallback_cache)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  meta <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(fallback_meta)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">fit =</span> fit,</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">stan_data =</span> meta<span class="sc">$</span>stan_data,</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">diagnostics =</span> meta<span class="sc">$</span>diagnostics,</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">timing =</span> meta<span class="sc">$</span>timing</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Fitting hierarchical decay model (no cache found)...</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Using K_spline = %d basis functions</span><span class="sc">\n</span><span class="st">"</span>, K_SPLINE))</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Hierarchical pooling: u_eq, adj_speed, shocks, decay rates</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit efficient model with hierarchical parameters and informed inits</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">fit_ode_state_space_efficient</span>(</span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>    counts_data,</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">K_spline =</span> K_SPLINE,</span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter_sampling =</span> <span class="dv">1500</span>,</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">iter_warmup =</span> <span class="dv">1500</span>,</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">adapt_delta =</span> <span class="fl">0.95</span>,</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_treedepth =</span> <span class="dv">12</span>,</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">refresh =</span> <span class="dv">500</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save to both formats for compatibility</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">dirname</span>(targets_cache), <span class="at">showWarnings =</span> <span class="cn">FALSE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>  qs<span class="sc">::</span><span class="fu">qsave</span>(result, targets_cache)</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>  result<span class="sc">$</span>fit<span class="sc">$</span><span class="fu">save_object</span>(<span class="at">file =</span> fallback_cache)</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Save metadata</span></span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a>  meta <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">stan_data =</span> result<span class="sc">$</span>stan_data,</span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">diagnostics =</span> result<span class="sc">$</span>diagnostics,</span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">timing =</span> result<span class="sc">$</span>timing</span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">saveRDS</span>(meta, fallback_meta)</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Model saved to: "</span>, targets_cache, <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Loading cached hierarchical decay model (RDS format)...
(Recommend running `targets::tar_make(model_ode_state_space_efficient)` for pipeline integration)</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display diagnostics</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Convergence Diagnostics ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Convergence Diagnostics ===</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Divergent transitions: %d</span><span class="sc">\n</span><span class="st">"</span>, result<span class="sc">$</span>diagnostics<span class="sc">$</span>num_divergent))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Divergent transitions: 0</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Max treedepth exceeded: %d</span><span class="sc">\n</span><span class="st">"</span>, result<span class="sc">$</span>diagnostics<span class="sc">$</span>max_treedepth_exceeded))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Max treedepth exceeded: 0</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"E-BFMI: %s</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">paste</span>(<span class="fu">round</span>(result<span class="sc">$</span>diagnostics<span class="sc">$</span>ebfmi, <span class="dv">3</span>), <span class="at">collapse =</span> <span class="st">", "</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>E-BFMI: 0.694, 0.694, 0.847, 0.824</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check all chains completed</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">length</span>(result<span class="sc">$</span>diagnostics<span class="sc">$</span>ebfmi) <span class="sc">&lt;</span> <span class="dv">4</span>) {</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"WARNING: Only %d of 4 chains completed!</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">length</span>(result<span class="sc">$</span>diagnostics<span class="sc">$</span>ebfmi)))</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="economic-parameter-estimates" class="level2">
<h2 class="anchored" data-anchor-id="economic-parameter-estimates">Economic Parameter Estimates</h2>
<section id="separation-and-finding-rates" class="level3">
<h3 class="anchored" data-anchor-id="separation-and-finding-rates">Separation and Finding Rates</h3>
<p>The model estimates education-specific job separation rates (probability of losing a job per month) and job finding rates (probability of finding a job per month while unemployed).</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">extract_economic_params</span>(result)</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Separation rates</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Monthly Job Separation Rates ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Monthly Job Separation Rates ===</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>sep_summary <span class="ot">&lt;-</span> params<span class="sc">$</span>separation_rates</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>sep_summary<span class="sc">$</span>education <span class="ot">&lt;-</span> stan_data<span class="sc">$</span>education_levels</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sep_summary[, <span class="fu">c</span>(<span class="st">"education"</span>, <span class="st">"mean"</span>, <span class="st">"q5"</span>, <span class="st">"q95"</span>)], <span class="at">digits =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 4
  education     mean    q5   q95
  &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 bachelors    0.285 0.263 0.307
2 high_school  0.329 0.307 0.351
3 less_than_hs 0.156 0.102 0.218
4 masters      0.300 0.262 0.343
5 phd          0.283 0.221 0.348
6 professional 0.366 0.295 0.437
7 some_college 0.278 0.258 0.298</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finding rates</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Monthly Job Finding Rates ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Monthly Job Finding Rates ===</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>find_summary <span class="ot">&lt;-</span> params<span class="sc">$</span>finding_rates</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>find_summary<span class="sc">$</span>education <span class="ot">&lt;-</span> stan_data<span class="sc">$</span>education_levels</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(find_summary[, <span class="fu">c</span>(<span class="st">"education"</span>, <span class="st">"mean"</span>, <span class="st">"q5"</span>, <span class="st">"q95"</span>)], <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 4
  education     mean    q5   q95
  &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 bachelors    10.6   9.82 11.5 
2 high_school   6.12  5.73  6.52
3 less_than_hs  2.55  1.73  3.47
4 masters      13.5  11.7  15.5 
5 phd          19.6  15.4  24.2 
6 professional 27.5  22.2  33.0 
7 some_college  6.34  5.91  6.79</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Equilibrium unemployment</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Equilibrium Unemployment Rates ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Equilibrium Unemployment Rates ===</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"(Long-run steady state: u* = s/(s+f))</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Long-run steady state: u* = s/(s+f))</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>eq_summary <span class="ot">&lt;-</span> params<span class="sc">$</span>equilibrium_rates</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>eq_summary<span class="sc">$</span>education <span class="ot">&lt;-</span> stan_data<span class="sc">$</span>education_levels</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(eq_summary[, <span class="fu">c</span>(<span class="st">"education"</span>, <span class="st">"mean"</span>, <span class="st">"q5"</span>, <span class="st">"q95"</span>)], <span class="at">digits =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 4
  education      mean     q5    q95
  &lt;chr&gt;         &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 bachelors    0.0261 0.0257 0.0265
2 high_school  0.0510 0.0505 0.0515
3 less_than_hs 0.0576 0.0533 0.0618
4 masters      0.0218 0.0213 0.0222
5 phd          0.0142 0.0135 0.0148
6 professional 0.0131 0.0124 0.0138
7 some_college 0.0420 0.0415 0.0425</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>eq_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">education =</span> stan_data<span class="sc">$</span>education_levels,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> eq_summary<span class="sc">$</span>mean,</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> eq_summary<span class="sc">$</span>q5,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> eq_summary<span class="sc">$</span>q95</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Order by mean rate</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>eq_df<span class="sc">$</span>education <span class="ot">&lt;-</span> <span class="fu">factor</span>(eq_df<span class="sc">$</span>education,</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>                          <span class="at">levels =</span> eq_df<span class="sc">$</span>education[<span class="fu">order</span>(eq_df<span class="sc">$</span>mean)])</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(eq_df, <span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> mean <span class="sc">*</span> <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower <span class="sc">*</span> <span class="dv">100</span>, <span class="at">ymax =</span> upper <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.2</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb46-16"><a href="#cb46-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb46-17"><a href="#cb46-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Education Level"</span>,</span>
<span id="cb46-18"><a href="#cb46-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Equilibrium Unemployment Rate (%)"</span>,</span>
<span id="cb46-19"><a href="#cb46-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Long-Run Unemployment Rates by Education"</span>,</span>
<span id="cb46-20"><a href="#cb46-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on estimated separation and finding rates"</span>) <span class="sc">+</span></span>
<span id="cb46-21"><a href="#cb46-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="state-space-comparison_files/figure-html/plot-equilibrium-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Equilibrium unemployment rates by education level (with 90% credible intervals)</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="shock-effects" class="level3">
<h3 class="anchored" data-anchor-id="shock-effects">Shock Effects</h3>
<p>The key advantage of the state space model: <strong>shock effects are positive and identifiable</strong>. With hierarchical priors, we estimate both population-level means and education-specific effects.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Population-level shock parameters (hierarchical)</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Hierarchical Shock Parameters (Population Level) ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Hierarchical Shock Parameters (Population Level) ===</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>hier_params <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"mu_log_shock_2008"</span>, <span class="st">"sigma_log_shock_2008"</span>,</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"mu_log_shock_2020"</span>, <span class="st">"sigma_log_shock_2020"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>hier_summary <span class="ot">&lt;-</span> result<span class="sc">$</span>fit<span class="sc">$</span><span class="fu">summary</span>(hier_params)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hier_summary[, <span class="fu">c</span>(<span class="st">"variable"</span>, <span class="st">"mean"</span>, <span class="st">"sd"</span>, <span class="st">"q5"</span>, <span class="st">"q95"</span>, <span class="st">"rhat"</span>, <span class="st">"ess_bulk"</span>)], <span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 7
  variable               mean    sd     q5    q95  rhat ess_bulk
  &lt;chr&gt;                 &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
1 mu_log_shock_2008    -1.02  0.154 -1.28  -0.789  1.00    1657.
2 sigma_log_shock_2008  0.368 0.148  0.203  0.639  1.00    2941.
3 mu_log_shock_2020    -0.125 0.178 -0.442  0.125  1.00    1720.
4 sigma_log_shock_2020  0.398 0.173  0.194  0.724  1.00    2112.</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">Interpretation on natural scale:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>

Interpretation on natural scale:</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"  2008 mean effect: exp(%.2f) = %.1f%% increase in separation rate</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>            hier_summary<span class="sc">$</span>mean[hier_summary<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">"mu_log_shock_2008"</span>],</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>            <span class="dv">100</span> <span class="sc">*</span> <span class="fu">exp</span>(hier_summary<span class="sc">$</span>mean[hier_summary<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">"mu_log_shock_2008"</span>])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  2008 mean effect: exp(-1.02) = 36.1% increase in separation rate</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"  2020 mean effect: exp(%.2f) = %.1f%% increase in separation rate</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>            hier_summary<span class="sc">$</span>mean[hier_summary<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">"mu_log_shock_2020"</span>],</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>            <span class="dv">100</span> <span class="sc">*</span> <span class="fu">exp</span>(hier_summary<span class="sc">$</span>mean[hier_summary<span class="sc">$</span>variable <span class="sc">==</span> <span class="st">"mu_log_shock_2020"</span>])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  2020 mean effect: exp(-0.12) = 88.3% increase in separation rate</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== 2008 Financial Crisis Shock Effects (Education-Specific) ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== 2008 Financial Crisis Shock Effects (Education-Specific) ===</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"(Additional monthly separation probability during shock)</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Additional monthly separation probability during shock)</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>shock08 <span class="ot">&lt;-</span> params<span class="sc">$</span>shock_2008_effects</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>shock08<span class="sc">$</span>education <span class="ot">&lt;-</span> stan_data<span class="sc">$</span>education_levels</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(shock08[, <span class="fu">c</span>(<span class="st">"education"</span>, <span class="st">"mean"</span>, <span class="st">"q5"</span>, <span class="st">"q95"</span>)], <span class="at">digits =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 4
  education     mean    q5   q95
  &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 bachelors    0.348 0.317 0.378
2 high_school  0.560 0.530 0.592
3 less_than_hs 0.399 0.305 0.503
4 masters      0.268 0.228 0.313
5 phd          0.273 0.206 0.343
6 professional 0.365 0.279 0.456
7 some_college 0.499 0.471 0.529</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== 2020 COVID-19 Shock Effects (Education-Specific) ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== 2020 COVID-19 Shock Effects (Education-Specific) ===</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"(Additional monthly separation probability during shock)</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Additional monthly separation probability during shock)</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>shock20 <span class="ot">&lt;-</span> params<span class="sc">$</span>shock_2020_effects</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>shock20<span class="sc">$</span>education <span class="ot">&lt;-</span> stan_data<span class="sc">$</span>education_levels</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(shock20[, <span class="fu">c</span>(<span class="st">"education"</span>, <span class="st">"mean"</span>, <span class="st">"q5"</span>, <span class="st">"q95"</span>)], <span class="at">digits =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 4
  education     mean    q5   q95
  &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 bachelors    0.998 0.900 1.10 
2 high_school  1.01  0.932 1.10 
3 less_than_hs 0.715 0.457 0.981
4 masters      0.728 0.607 0.856
5 phd          0.707 0.519 0.898
6 professional 1.58  1.19  1.96 
7 some_college 1.14  1.05  1.23 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== 2008 Shock Half-Lives (Education-Specific) ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== 2008 Shock Half-Lives (Education-Specific) ===</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"(Time in years for shock effect to decay by 50%)</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Time in years for shock effect to decay by 50%)</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>hl08 <span class="ot">&lt;-</span> params<span class="sc">$</span>halflife_2008</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>hl08<span class="sc">$</span>education <span class="ot">&lt;-</span> stan_data<span class="sc">$</span>education_levels</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hl08[, <span class="fu">c</span>(<span class="st">"education"</span>, <span class="st">"mean"</span>, <span class="st">"q5"</span>, <span class="st">"q95"</span>)], <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 4
  education     mean    q5   q95
  &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 bachelors     2.19  2.02  2.38
2 high_school   2.29  2.19  2.39
3 less_than_hs  1.68  1.25  2.13
4 masters       2.34  1.97  2.72
5 phd           2.62  1.93  3.40
6 professional  3.49  2.62  4.49
7 some_college  2.29  2.19  2.41</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== 2020 COVID Half-Lives (Education-Specific) ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== 2020 COVID Half-Lives (Education-Specific) ===</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"(Time in years for shock effect to decay by 50%)</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>(Time in years for shock effect to decay by 50%)</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>hl20 <span class="ot">&lt;-</span> params<span class="sc">$</span>halflife_2020</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>hl20<span class="sc">$</span>education <span class="ot">&lt;-</span> stan_data<span class="sc">$</span>education_levels</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hl20[, <span class="fu">c</span>(<span class="st">"education"</span>, <span class="st">"mean"</span>, <span class="st">"q5"</span>, <span class="st">"q95"</span>)], <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 4
  education     mean    q5   q95
  &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 bachelors    0.141 0.139 0.148
2 high_school  0.139 0.139 0.141
3 less_than_hs 0.144 0.139 0.161
4 masters      0.142 0.139 0.153
5 phd          0.146 0.139 0.173
6 professional 0.147 0.139 0.183
7 some_college 0.139 0.139 0.141</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine shock data</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>shock_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">shock =</span> <span class="st">"2008 Financial Crisis"</span>,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">education =</span> stan_data<span class="sc">$</span>education_levels,</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> shock08<span class="sc">$</span>mean,</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> shock08<span class="sc">$</span>q5,</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> shock08<span class="sc">$</span>q95</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">shock =</span> <span class="st">"2020 COVID-19"</span>,</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">education =</span> stan_data<span class="sc">$</span>education_levels,</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> shock20<span class="sc">$</span>mean,</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> shock20<span class="sc">$</span>q5,</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> shock20<span class="sc">$</span>q95</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(shock_df, <span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> mean <span class="sc">*</span> <span class="dv">100</span>, <span class="at">color =</span> shock)) <span class="sc">+</span></span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower <span class="sc">*</span> <span class="dv">100</span>, <span class="at">ymax =</span> upper <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>), <span class="at">width =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"2008 Financial Crisis"</span> <span class="ot">=</span> <span class="st">"#E74C3C"</span>,</span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"2020 COVID-19"</span> <span class="ot">=</span> <span class="st">"#3498DB"</span>)) <span class="sc">+</span></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Education Level"</span>,</span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Additional Separation Rate (%)"</span>,</span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Economic Shock"</span>,</span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Shock Effects on Job Separation by Education"</span>,</span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Positive values indicate increased job loss during crisis"</span>) <span class="sc">+</span></span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="state-space-comparison_files/figure-html/plot-shock-effects-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Comparison of shock effects across education levels</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="latent-unemployment-trajectories" class="level2">
<h2 class="anchored" data-anchor-id="latent-unemployment-trajectories">Latent Unemployment Trajectories</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract latent unemployment rates</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>latent <span class="ot">&lt;-</span> <span class="fu">extract_latent_rates</span>(result, <span class="at">summary =</span> <span class="cn">TRUE</span>)</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data for plotting</span></span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>plot_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_frac =</span> latent<span class="sc">$</span>year_frac,</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">education =</span> latent<span class="sc">$</span>education,</span>
<span id="cb82-8"><a href="#cb82-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> latent<span class="sc">$</span>mean,</span>
<span id="cb82-9"><a href="#cb82-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> latent<span class="sc">$</span>q5,</span>
<span id="cb82-10"><a href="#cb82-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> latent<span class="sc">$</span>q95</span>
<span id="cb82-11"><a href="#cb82-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-12"><a href="#cb82-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-13"><a href="#cb82-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add observed rates for comparison</span></span>
<span id="cb82-14"><a href="#cb82-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(stan_data<span class="sc">$</span>education_levels)) {</span>
<span id="cb82-15"><a href="#cb82-15" aria-hidden="true" tabindex="-1"></a>  edu <span class="ot">&lt;-</span> stan_data<span class="sc">$</span>education_levels[i]</span>
<span id="cb82-16"><a href="#cb82-16" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> plot_data<span class="sc">$</span>education <span class="sc">==</span> edu</span>
<span id="cb82-17"><a href="#cb82-17" aria-hidden="true" tabindex="-1"></a>  obs_rate <span class="ot">&lt;-</span> stan_data<span class="sc">$</span>n_unemployed[, i] <span class="sc">/</span> stan_data<span class="sc">$</span>n_total[, i]</span>
<span id="cb82-18"><a href="#cb82-18" aria-hidden="true" tabindex="-1"></a>  plot_data<span class="sc">$</span>observed[idx] <span class="ot">&lt;-</span> obs_rate</span>
<span id="cb82-19"><a href="#cb82-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_data, <span class="fu">aes</span>(<span class="at">x =</span> year_frac)) <span class="sc">+</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower <span class="sc">*</span> <span class="dv">100</span>, <span class="at">ymax =</span> upper <span class="sc">*</span> <span class="dv">100</span>, <span class="at">fill =</span> education),</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean <span class="sc">*</span> <span class="dv">100</span>, <span class="at">color =</span> education), <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> observed <span class="sc">*</span> <span class="dv">100</span>), <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="fl">2008.75</span>, <span class="fl">2020.25</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>education, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2000</span>, <span class="dv">2025</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">scale =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Unemployment Rate"</span>,</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Latent Unemployment Trajectories by Education Level"</span>,</span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Points: observed data; Lines: model estimates; Bands: 90% CI; Red lines: shock onsets"</span>) <span class="sc">+</span></span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="state-space-comparison_files/figure-html/plot-latent-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Latent unemployment rates from state space model (with 90% credible bands)</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="non-seasonal-trend" class="level2">
<h2 class="anchored" data-anchor-id="non-seasonal-trend">Non-Seasonal Trend</h2>
<p>The state space model allows us to extract the <strong>underlying trend</strong> by removing seasonal effects. This shows the unemployment dynamics driven only by:</p>
<ul>
<li>Baseline separation and finding rates</li>
<li>Economic shock effects (2008, 2020)</li>
<li>Stochastic innovations</li>
</ul>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the non-seasonal trend</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>trend <span class="ot">&lt;-</span> <span class="fu">extract_trend</span>(result, <span class="at">summary =</span> <span class="cn">TRUE</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data for plotting</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>trend_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_frac =</span> trend<span class="sc">$</span>year_frac,</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">education =</span> trend<span class="sc">$</span>education,</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean =</span> trend<span class="sc">$</span>mean,</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> trend<span class="sc">$</span>q5,</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> trend<span class="sc">$</span>q95</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(trend_data, <span class="fu">aes</span>(<span class="at">x =</span> year_frac)) <span class="sc">+</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower <span class="sc">*</span> <span class="dv">100</span>, <span class="at">ymax =</span> upper <span class="sc">*</span> <span class="dv">100</span>, <span class="at">fill =</span> education),</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean <span class="sc">*</span> <span class="dv">100</span>, <span class="at">color =</span> education), <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="fl">2008.75</span>, <span class="fl">2020.25</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">2009.5</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">label =</span> <span class="st">"2008 Crisis"</span>,</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">vjust =</span> <span class="dv">2</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2021</span>, <span class="at">y =</span> <span class="cn">Inf</span>, <span class="at">label =</span> <span class="st">"COVID-19"</span>,</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">vjust =</span> <span class="dv">2</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>education, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb85-12"><a href="#cb85-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2000</span>, <span class="dv">2025</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb85-13"><a href="#cb85-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">scale =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb85-14"><a href="#cb85-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb85-15"><a href="#cb85-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Unemployment Rate (Trend)"</span>,</span>
<span id="cb85-16"><a href="#cb85-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Non-Seasonal Unemployment Trend by Education Level"</span>,</span>
<span id="cb85-17"><a href="#cb85-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Seasonal effects removed; shows baseline dynamics + shock impacts"</span>) <span class="sc">+</span></span>
<span id="cb85-18"><a href="#cb85-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb85-19"><a href="#cb85-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="state-space-comparison_files/figure-html/plot-trend-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Non-seasonal unemployment trend (shock + baseline dynamics only)</figcaption>
</figure>
</div>
</div>
</div>
<section id="seasonal-oscillation-direct-visualization" class="level3">
<h3 class="anchored" data-anchor-id="seasonal-oscillation-direct-visualization">Seasonal Oscillation: Direct Visualization</h3>
<p>The seasonal effect is the difference between the full model (with seasonality) and the trend (without). This directly shows how much unemployment oscillates due to seasonal hiring patterns.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract seasonal effects directly computed by the model</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>seasonal_effects <span class="ot">&lt;-</span> <span class="fu">extract_seasonal_effects</span>(result, <span class="at">summary =</span> <span class="cn">TRUE</span>)</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Focus on key education levels</span></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>sample_edu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"phd"</span>, <span class="st">"bachelors"</span>, <span class="st">"less_than_hs"</span>)</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>seas_subset <span class="ot">&lt;-</span> seasonal_effects[seasonal_effects<span class="sc">$</span>education <span class="sc">%in%</span> sample_edu, ]</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the seasonal oscillation over time</span></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(seas_subset, <span class="fu">aes</span>(<span class="at">x =</span> year_frac)) <span class="sc">+</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> q5 <span class="sc">*</span> <span class="dv">100</span>, <span class="at">ymax =</span> q95 <span class="sc">*</span> <span class="dv">100</span>, <span class="at">fill =</span> education),</span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> mean <span class="sc">*</span> <span class="dv">100</span>, <span class="at">color =</span> education), <span class="at">linewidth =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>education, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2000</span>, <span class="dv">2025</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Seasonal Effect (percentage points)"</span>,</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Seasonal Oscillation in Unemployment by Education"</span>,</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Positive = unemployment above trend; Negative = below trend; Band = 90% CI"</span>) <span class="sc">+</span></span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="state-space-comparison_files/figure-html/seasonal-oscillation-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Seasonal oscillation in unemployment rates (Full model minus Trend)</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="monthly-seasonal-pattern" class="level3">
<h3 class="anchored" data-anchor-id="monthly-seasonal-pattern">Monthly Seasonal Pattern</h3>
<p>The model includes a <strong>direct seasonal effect on unemployment</strong> (on the logit scale). This captures observed seasonal patterns like academic hiring calendars, summer employment fluctuations, and annual hiring cycles.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract direct seasonal unemployment parameters</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>seasonal_u_summary <span class="ot">&lt;-</span> result<span class="sc">$</span>fit<span class="sc">$</span><span class="fu">summary</span>(<span class="at">variables =</span> <span class="st">"seasonal_u"</span>)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse indices</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>seasonal_u_summary<span class="sc">$</span>month <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gsub</span>(<span class="st">"seasonal_u</span><span class="sc">\\</span><span class="st">[(</span><span class="sc">\\</span><span class="st">d+),</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">]"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, seasonal_u_summary<span class="sc">$</span>variable)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>seasonal_u_summary<span class="sc">$</span>edu_index <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(</span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gsub</span>(<span class="st">"seasonal_u</span><span class="sc">\\</span><span class="st">[</span><span class="sc">\\</span><span class="st">d+,(</span><span class="sc">\\</span><span class="st">d+)</span><span class="sc">\\</span><span class="st">]"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, seasonal_u_summary<span class="sc">$</span>variable)</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>seasonal_u_summary<span class="sc">$</span>education <span class="ot">&lt;-</span> stan_data<span class="sc">$</span>education_levels[seasonal_u_summary<span class="sc">$</span>edu_index]</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create month labels</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>month_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Jan"</span>, <span class="st">"Feb"</span>, <span class="st">"Mar"</span>, <span class="st">"Apr"</span>, <span class="st">"May"</span>, <span class="st">"Jun"</span>,</span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"Jul"</span>, <span class="st">"Aug"</span>, <span class="st">"Sep"</span>, <span class="st">"Oct"</span>, <span class="st">"Nov"</span>, <span class="st">"Dec"</span>)</span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>seasonal_u_summary<span class="sc">$</span>month_label <span class="ot">&lt;-</span> <span class="fu">factor</span>(month_labels[seasonal_u_summary<span class="sc">$</span>month],</span>
<span id="cb87-17"><a href="#cb87-17" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">levels =</span> month_labels)</span>
<span id="cb87-18"><a href="#cb87-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-19"><a href="#cb87-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for selected education levels</span></span>
<span id="cb87-20"><a href="#cb87-20" aria-hidden="true" tabindex="-1"></a>seasonal_u_plot <span class="ot">&lt;-</span> seasonal_u_summary[seasonal_u_summary<span class="sc">$</span>education <span class="sc">%in%</span> sample_edu, ]</span>
<span id="cb87-21"><a href="#cb87-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-22"><a href="#cb87-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(seasonal_u_plot, <span class="fu">aes</span>(<span class="at">x =</span> month_label, <span class="at">y =</span> mean, <span class="at">group =</span> education)) <span class="sc">+</span></span>
<span id="cb87-23"><a href="#cb87-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> q5, <span class="at">ymax =</span> q95, <span class="at">fill =</span> education),</span>
<span id="cb87-24"><a href="#cb87-24" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb87-25"><a href="#cb87-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> education), <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb87-26"><a href="#cb87-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> education), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb87-27"><a href="#cb87-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray40"</span>) <span class="sc">+</span></span>
<span id="cb87-28"><a href="#cb87-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>education, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb87-29"><a href="#cb87-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Month"</span>,</span>
<span id="cb87-30"><a href="#cb87-30" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Seasonal Effect (logit scale)"</span>,</span>
<span id="cb87-31"><a href="#cb87-31" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Direct Seasonal Effects on Unemployment"</span>,</span>
<span id="cb87-32"><a href="#cb87-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Positive = higher unemployment; Negative = lower unemployment; Band = 90% CI"</span>) <span class="sc">+</span></span>
<span id="cb87-33"><a href="#cb87-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb87-34"><a href="#cb87-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb87-35"><a href="#cb87-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="state-space-comparison_files/figure-html/monthly-seasonal-u-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Direct monthly seasonal effects on unemployment by education level</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="model-decomposition-full-vs-trend-vs-pure-ode" class="level3">
<h3 class="anchored" data-anchor-id="model-decomposition-full-vs-trend-vs-pure-ode">Model Decomposition: Full vs Trend vs Pure ODE</h3>
<p>This visualization compares three trajectories:</p>
<ol type="1">
<li><strong>Full model</strong> (blue): Includes all components - ODE dynamics, shocks, seasonality, and stochastic innovations</li>
<li><strong>Trend</strong> (orange): Removes seasonality but keeps innovations (shows underlying dynamics)</li>
<li><strong>Pure ODE</strong> (red): Only structural ODE dynamics - no innovations, no seasonality (shows what separation/finding rates alone predict)</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract pure ODE trajectory</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>pure_ode <span class="ot">&lt;-</span> <span class="fu">extract_pure_ode</span>(result, <span class="at">summary =</span> <span class="cn">TRUE</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Debug: Check data dimensions</span></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Full model data rows:"</span>, <span class="fu">nrow</span>(plot_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Full model data rows: 2170 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Trend data rows:"</span>, <span class="fu">nrow</span>(trend_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Trend data rows: 2170 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Pure ODE data rows:"</span>, <span class="fu">nrow</span>(pure_ode), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Pure ODE data rows: 2170 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create separate data frames with only needed columns</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>pure_ode_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_frac =</span> pure_ode<span class="sc">$</span>year_frac,</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">education =</span> pure_ode<span class="sc">$</span>education,</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">rate =</span> pure_ode<span class="sc">$</span>mean,</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"Pure ODE"</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>full_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_frac =</span> plot_data<span class="sc">$</span>year_frac,</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">education =</span> plot_data<span class="sc">$</span>education,</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">rate =</span> plot_data<span class="sc">$</span>mean,</span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"Full Model"</span></span>
<span id="cb94-14"><a href="#cb94-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb94-15"><a href="#cb94-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-16"><a href="#cb94-16" aria-hidden="true" tabindex="-1"></a>trend_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb94-17"><a href="#cb94-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">year_frac =</span> trend_data<span class="sc">$</span>year_frac,</span>
<span id="cb94-18"><a href="#cb94-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">education =</span> trend_data<span class="sc">$</span>education,</span>
<span id="cb94-19"><a href="#cb94-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">rate =</span> trend_data<span class="sc">$</span>mean,</span>
<span id="cb94-20"><a href="#cb94-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"Trend (no seasonal)"</span></span>
<span id="cb94-21"><a href="#cb94-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb94-22"><a href="#cb94-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-23"><a href="#cb94-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all</span></span>
<span id="cb94-24"><a href="#cb94-24" aria-hidden="true" tabindex="-1"></a>decomp_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(pure_ode_df, trend_df, full_df)</span>
<span id="cb94-25"><a href="#cb94-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-26"><a href="#cb94-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Debug: Check combined data</span></span>
<span id="cb94-27"><a href="#cb94-27" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Combined data rows:"</span>, <span class="fu">nrow</span>(decomp_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Combined data rows: 6510 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Types present:"</span>, <span class="fu">unique</span>(decomp_data<span class="sc">$</span>type), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Types present: Pure ODE Trend (no seasonal) Full Model </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>decomp_data<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">factor</span>(decomp_data<span class="sc">$</span>type,</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Pure ODE"</span>, <span class="st">"Trend (no seasonal)"</span>, <span class="st">"Full Model"</span>))</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset to key education levels</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>decomp_subset <span class="ot">&lt;-</span> decomp_data[decomp_data<span class="sc">$</span>education <span class="sc">%in%</span> sample_edu, ]</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Subset rows:"</span>, <span class="fu">nrow</span>(decomp_subset), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Subset rows: 2790 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Types in subset:"</span>, <span class="fu">unique</span>(<span class="fu">as.character</span>(decomp_subset<span class="sc">$</span>type)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Types in subset: Pure ODE Trend (no seasonal) Full Model </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot with explicit linewidths (no aesthetic mapping)</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(decomp_subset, <span class="fu">aes</span>(<span class="at">x =</span> year_frac, <span class="at">y =</span> rate <span class="sc">*</span> <span class="dv">100</span>, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="fl">2008.75</span>, <span class="fl">2020.25</span>), <span class="at">linetype =</span> <span class="st">"dashed"</span>,</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"gray40"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>education, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Pure ODE"</span> <span class="ot">=</span> <span class="st">"#E74C3C"</span>,</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Trend (no seasonal)"</span> <span class="ot">=</span> <span class="st">"#F39C12"</span>,</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Full Model"</span> <span class="ot">=</span> <span class="st">"#3498DB"</span>)) <span class="sc">+</span></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2000</span>, <span class="dv">2025</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Unemployment Rate (%)"</span>,</span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Model Component"</span>,</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Decomposition of Unemployment Dynamics"</span>,</span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Red = pure ODE; Orange = trend + innovations; Blue = full model with seasonality"</span>) <span class="sc">+</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="state-space-comparison_files/figure-html/model-decomposition-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Model decomposition showing structural dynamics vs observed trajectory</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="zoom-seasonal-oscillation-detail-2017-2019" class="level3">
<h3 class="anchored" data-anchor-id="zoom-seasonal-oscillation-detail-2017-2019">Zoom: Seasonal Oscillation Detail (2017-2019)</h3>
<p>A closer look at a few years to see the seasonal oscillation clearly:</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Zoom into 2017-2019 to see seasonal pattern clearly</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>zoom_years <span class="ot">&lt;-</span> decomp_subset[decomp_subset<span class="sc">$</span>year_frac <span class="sc">&gt;=</span> <span class="dv">2017</span> <span class="sc">&amp;</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>                             decomp_subset<span class="sc">$</span>year_frac <span class="sc">&lt;=</span> <span class="dv">2020</span>, ]</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Zoom rows:"</span>, <span class="fu">nrow</span>(zoom_years), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Zoom rows: 324 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Types in zoom:"</span>, <span class="fu">unique</span>(<span class="fu">as.character</span>(zoom_years<span class="sc">$</span>type)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Types in zoom: Pure ODE Trend (no seasonal) Full Model </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(zoom_years, <span class="fu">aes</span>(<span class="at">x =</span> year_frac, <span class="at">y =</span> rate <span class="sc">*</span> <span class="dv">100</span>, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>education, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">ncol =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Pure ODE"</span> <span class="ot">=</span> <span class="st">"#E74C3C"</span>,</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Trend (no seasonal)"</span> <span class="ot">=</span> <span class="st">"#F39C12"</span>,</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Full Model"</span> <span class="ot">=</span> <span class="st">"#3498DB"</span>)) <span class="sc">+</span></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2017</span>, <span class="dv">2020</span>, <span class="dv">1</span>),</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">minor_breaks =</span> <span class="fu">seq</span>(<span class="dv">2017</span>, <span class="dv">2020</span>, <span class="fl">0.25</span>)) <span class="sc">+</span></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Unemployment Rate (%)"</span>,</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Component"</span>,</span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Seasonal Pattern Detail (2017-2019)"</span>,</span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Blue oscillation around orange trend shows seasonal hiring patterns"</span>) <span class="sc">+</span></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray90"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="state-space-comparison_files/figure-html/seasonal-zoom-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Detailed view of seasonal oscillation (2017-2019)</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="zoom-most-recent-12-months" class="level3">
<h3 class="anchored" data-anchor-id="zoom-most-recent-12-months">Zoom: Most Recent 12 Months</h3>
<p>The most recent year of data to see current dynamics:</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the most recent year</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>max_year <span class="ot">&lt;-</span> <span class="fu">max</span>(decomp_subset<span class="sc">$</span>year_frac)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>recent_data <span class="ot">&lt;-</span> decomp_subset[decomp_subset<span class="sc">$</span>year_frac <span class="sc">&gt;=</span> (max_year <span class="sc">-</span> <span class="dv">1</span>), ]</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Recent period:"</span>, max_year <span class="sc">-</span> <span class="dv">1</span>, <span class="st">"to"</span>, max_year, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Recent period: 2024.875 to 2025.875 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Recent rows:"</span>, <span class="fu">nrow</span>(recent_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Recent rows: 108 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Also get observed data for this period</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>recent_obs <span class="ot">&lt;-</span> plot_data[plot_data<span class="sc">$</span>education <span class="sc">%in%</span> sample_edu <span class="sc">&amp;</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>                         plot_data<span class="sc">$</span>year_frac <span class="sc">&gt;=</span> (max_year <span class="sc">-</span> <span class="dv">1</span>), ]</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Model trajectories</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> recent_data,</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> year_frac, <span class="at">y =</span> rate <span class="sc">*</span> <span class="dv">100</span>, <span class="at">color =</span> type),</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Observed data points</span></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> recent_obs,</span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> year_frac, <span class="at">y =</span> observed <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>education, <span class="at">scales =</span> <span class="st">"free_y"</span>, <span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Pure ODE"</span> <span class="ot">=</span> <span class="st">"#E74C3C"</span>,</span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Trend (no seasonal)"</span> <span class="ot">=</span> <span class="st">"#F39C12"</span>,</span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>                                <span class="st">"Full Model"</span> <span class="ot">=</span> <span class="st">"#3498DB"</span>)) <span class="sc">+</span></span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="fu">floor</span>(max_year <span class="sc">-</span> <span class="dv">1</span>), <span class="fu">ceiling</span>(max_year), <span class="fl">0.5</span>),</span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">format</span>(x, <span class="at">nsmall =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Unemployment Rate (%)"</span>,</span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Component"</span>,</span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Most Recent 12 Months"</span>,</span>
<span id="cb112-24"><a href="#cb112-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Black points = observed data; Lines = model components"</span>) <span class="sc">+</span></span>
<span id="cb112-25"><a href="#cb112-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb112-26"><a href="#cb112-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb112-27"><a href="#cb112-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="state-space-comparison_files/figure-html/recent-zoom-1.png" class="img-fluid figure-img" width="1152"></p>
<figcaption>Most recent 12 months of unemployment dynamics</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="model-diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="model-diagnostics">Model Diagnostics</h2>
<p>A well-specified model should have: - <strong>Zero divergent transitions</strong> - indicates proper posterior geometry - <strong>Zero max treedepth exceeded</strong> - indicates efficient sampling - <strong>E-BFMI &gt; 0.2</strong> (ideally &gt; 0.7) - indicates good energy exploration - <strong>All chains completing</strong> - indicates stable computation - <strong>Rhat &lt; 1.01</strong> for all parameters - indicates chain convergence - <strong>ESS &gt; 400</strong> for all parameters - indicates sufficient effective samples</p>
<section id="comprehensive-diagnostics-summary" class="level3">
<h3 class="anchored" data-anchor-id="comprehensive-diagnostics-summary">Comprehensive Diagnostics Summary</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete diagnostics summary</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"=== MCMC DIAGNOSTICS SUMMARY ===</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>=== MCMC DIAGNOSTICS SUMMARY ===</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic counts</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Chains requested: 4</span><span class="sc">\n</span><span class="st">"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Chains requested: 4</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Chains completed: %d</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">length</span>(result<span class="sc">$</span>diagnostics<span class="sc">$</span>ebfmi)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Chains completed: 4</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Iterations per chain: %d warmup + %d sampling</span><span class="sc">\n</span><span class="st">"</span>, <span class="dv">1000</span>, <span class="dv">1500</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Iterations per chain: 1000 warmup + 1500 sampling</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Total post-warmup samples: %d</span><span class="sc">\n\n</span><span class="st">"</span>, <span class="fu">length</span>(result<span class="sc">$</span>diagnostics<span class="sc">$</span>ebfmi) <span class="sc">*</span> <span class="dv">1500</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total post-warmup samples: 6000</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Divergences</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Divergent transitions: %d"</span>, result<span class="sc">$</span>diagnostics<span class="sc">$</span>num_divergent))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Divergent transitions: 0</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (result<span class="sc">$</span>diagnostics<span class="sc">$</span>num_divergent <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">" ✓ PASS</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">" ✗ FAIL - investigate model geometry</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> ✓ PASS</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Max treedepth</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Max treedepth exceeded: %d"</span>, result<span class="sc">$</span>diagnostics<span class="sc">$</span>max_treedepth_exceeded))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Max treedepth exceeded: 0</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (result<span class="sc">$</span>diagnostics<span class="sc">$</span>max_treedepth_exceeded <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">" ✓ PASS</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">" ✗ WARNING - consider increasing max_treedepth</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> ✓ PASS</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># E-BFMI</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>ebfmi_vals <span class="ot">&lt;-</span> result<span class="sc">$</span>diagnostics<span class="sc">$</span>ebfmi</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"E-BFMI values: %s"</span>, <span class="fu">paste</span>(<span class="fu">round</span>(ebfmi_vals, <span class="dv">3</span>), <span class="at">collapse =</span> <span class="st">", "</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>E-BFMI values: 0.694, 0.694, 0.847, 0.824</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">all</span>(ebfmi_vals <span class="sc">&gt;</span> <span class="fl">0.2</span>)) {</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">all</span>(ebfmi_vals <span class="sc">&gt;</span> <span class="fl">0.7</span>)) {</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">" ✓ EXCELLENT</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="st">" ✓ ACCEPTABLE</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">" ✗ FAIL - low energy, problematic posterior</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb133-9"><a href="#cb133-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> ✓ ACCEPTABLE</code></pre>
</div>
</div>
</section>
<section id="divergence-diagnostics" class="level3">
<h3 class="anchored" data-anchor-id="divergence-diagnostics">Divergence Diagnostics</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the sampler diagnostics</span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a>np <span class="ot">&lt;-</span> bayesplot<span class="sc">::</span><span class="fu">nuts_params</span>(result<span class="sc">$</span>fit)</span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a>draws <span class="ot">&lt;-</span> result<span class="sc">$</span>fit<span class="sc">$</span><span class="fu">draws</span>(<span class="at">format =</span> <span class="st">"draws_df"</span>)</span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if we have divergences</span></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a>n_divergent <span class="ot">&lt;-</span> <span class="fu">sum</span>(np<span class="sc">$</span>Value[np<span class="sc">$</span>Parameter <span class="sc">==</span> <span class="st">"divergent__"</span>])</span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total divergent transitions:"</span>, n_divergent, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total divergent transitions: 0 </code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (n_divergent <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pairs plot for key parameters - shows where divergences occur</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  p_pairs <span class="ot">&lt;-</span> <span class="fu">mcmc_pairs</span>(</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>    draws,</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"mu_logit_u_eq"</span>, <span class="st">"sigma_logit_u_eq"</span>,</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>             <span class="st">"mu_log_shock_2008"</span>, <span class="st">"sigma_log_shock_2008"</span>),</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">np =</span> np,</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">off_diag_args =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="fl">0.75</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>)</span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p_pairs)</span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"No divergent transitions - model geometry is well-behaved!</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">This indicates:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"  - Proper parameterization (non-centered hierarchical)</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"  - Well-matched priors and data</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"  - Good initialization at prior centers</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>No divergent transitions - model geometry is well-behaved!

This indicates:
  - Proper parameterization (non-centered hierarchical)
  - Well-matched priors and data
  - Good initialization at prior centers</code></pre>
</div>
</div>
</section>
<section id="energy-diagnostics-e-bfmi" class="level3">
<h3 class="anchored" data-anchor-id="energy-diagnostics-e-bfmi">Energy Diagnostics (E-BFMI)</h3>
<p>Low E-BFMI indicates the sampler is having trouble exploring the posterior. Values below 0.2 are concerning.</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Energy plot</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_nuts_energy</span>(np, <span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"NUTS Energy Diagnostic"</span>,</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Overlapping distributions indicate good exploration"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="state-space-comparison_files/figure-html/energy-diagnostics-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Energy diagnostics: E-BFMI should be &gt; 0.2 for each chain</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="trace-plots-for-key-parameters" class="level3">
<h3 class="anchored" data-anchor-id="trace-plots-for-key-parameters">Trace Plots for Key Parameters</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Trace plots for hierarchical shock model parameters</span></span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">mcmc_trace</span>(draws, <span class="at">pars =</span> <span class="st">"mu_logit_u_eq"</span>, <span class="at">np =</span> np) <span class="sc">+</span></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Hierarchical Mean: Equilibrium Unemployment (logit scale)"</span>)</span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">mcmc_trace</span>(draws, <span class="at">pars =</span> <span class="st">"mu_log_shock_2008"</span>, <span class="at">np =</span> np) <span class="sc">+</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Hierarchical Mean: 2008 Shock (log scale)"</span>)</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">mcmc_trace</span>(draws, <span class="at">pars =</span> <span class="st">"mu_log_shock_2020"</span>, <span class="at">np =</span> np) <span class="sc">+</span></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Hierarchical Mean: 2020 Shock (log scale)"</span>)</span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">mcmc_trace</span>(draws, <span class="at">pars =</span> <span class="st">"sigma_log_shock_2008"</span>, <span class="at">np =</span> np) <span class="sc">+</span></span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Hierarchical SD: 2008 Shock (between-education variation)"</span>)</span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>p5 <span class="ot">&lt;-</span> <span class="fu">mcmc_trace</span>(draws, <span class="at">pars =</span> <span class="st">"sigma_spline"</span>, <span class="at">np =</span> np) <span class="sc">+</span></span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Spline Deviation Scale"</span>)</span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">/</span> p2 <span class="sc">/</span> p3 <span class="sc">/</span> p4 <span class="sc">/</span> p5)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="state-space-comparison_files/figure-html/trace-plots-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>MCMC trace plots for key parameters</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="rhat-and-effective-sample-size" class="level3">
<h3 class="anchored" data-anchor-id="rhat-and-effective-sample-size">Rhat and Effective Sample Size</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get summary with Rhat and ESS</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Using hierarchical shock model parameters</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>key_params <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Hierarchical equilibrium and adjustment</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mu_logit_u_eq"</span>, <span class="st">"sigma_logit_u_eq"</span>,</span>
<span id="cb141-6"><a href="#cb141-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mu_log_adj_speed"</span>, <span class="st">"sigma_log_adj_speed"</span>,</span>
<span id="cb141-7"><a href="#cb141-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Hierarchical shock parameters (NEW)</span></span>
<span id="cb141-8"><a href="#cb141-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mu_log_shock_2008"</span>, <span class="st">"sigma_log_shock_2008"</span>,</span>
<span id="cb141-9"><a href="#cb141-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mu_log_shock_2020"</span>, <span class="st">"sigma_log_shock_2020"</span>,</span>
<span id="cb141-10"><a href="#cb141-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Education-specific derived parameters</span></span>
<span id="cb141-11"><a href="#cb141-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"u_eq["</span>, <span class="dv">1</span><span class="sc">:</span>stan_data<span class="sc">$</span>N_edu, <span class="st">"]"</span>),</span>
<span id="cb141-12"><a href="#cb141-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"adj_speed["</span>, <span class="dv">1</span><span class="sc">:</span>stan_data<span class="sc">$</span>N_edu, <span class="st">"]"</span>),</span>
<span id="cb141-13"><a href="#cb141-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"shock_2008_effect["</span>, <span class="dv">1</span><span class="sc">:</span>stan_data<span class="sc">$</span>N_edu, <span class="st">"]"</span>),</span>
<span id="cb141-14"><a href="#cb141-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"shock_2020_effect["</span>, <span class="dv">1</span><span class="sc">:</span>stan_data<span class="sc">$</span>N_edu, <span class="st">"]"</span>),</span>
<span id="cb141-15"><a href="#cb141-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"decay_2008["</span>, <span class="dv">1</span><span class="sc">:</span>stan_data<span class="sc">$</span>N_edu, <span class="st">"]"</span>),</span>
<span id="cb141-16"><a href="#cb141-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="st">"decay_2020["</span>, <span class="dv">1</span><span class="sc">:</span>stan_data<span class="sc">$</span>N_edu, <span class="st">"]"</span>),</span>
<span id="cb141-17"><a href="#cb141-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Global parameters</span></span>
<span id="cb141-18"><a href="#cb141-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"sigma_spline"</span>, <span class="st">"phi"</span></span>
<span id="cb141-19"><a href="#cb141-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb141-20"><a href="#cb141-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-21"><a href="#cb141-21" aria-hidden="true" tabindex="-1"></a>param_summary <span class="ot">&lt;-</span> result<span class="sc">$</span>fit<span class="sc">$</span><span class="fu">summary</span>(<span class="at">variables =</span> key_params)</span>
<span id="cb141-22"><a href="#cb141-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-23"><a href="#cb141-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Rhat histogram</span></span>
<span id="cb141-24"><a href="#cb141-24" aria-hidden="true" tabindex="-1"></a>p_rhat <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(param_summary, <span class="fu">aes</span>(<span class="at">x =</span> rhat)) <span class="sc">+</span></span>
<span id="cb141-25"><a href="#cb141-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.002</span>, <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb141-26"><a href="#cb141-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">1.01</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb141-27"><a href="#cb141-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Rhat"</span>, <span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">title =</span> <span class="st">"Rhat Distribution"</span>,</span>
<span id="cb141-28"><a href="#cb141-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"All values should be &lt; 1.01 (red line)"</span>) <span class="sc">+</span></span>
<span id="cb141-29"><a href="#cb141-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb141-30"><a href="#cb141-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-31"><a href="#cb141-31" aria-hidden="true" tabindex="-1"></a><span class="co"># ESS histogram</span></span>
<span id="cb141-32"><a href="#cb141-32" aria-hidden="true" tabindex="-1"></a>p_ess <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(param_summary, <span class="fu">aes</span>(<span class="at">x =</span> ess_bulk)) <span class="sc">+</span></span>
<span id="cb141-33"><a href="#cb141-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">100</span>, <span class="at">fill =</span> <span class="st">"darkgreen"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb141-34"><a href="#cb141-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">400</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb141-35"><a href="#cb141-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Effective Sample Size (bulk)"</span>, <span class="at">y =</span> <span class="st">"Count"</span>, <span class="at">title =</span> <span class="st">"ESS Distribution"</span>,</span>
<span id="cb141-36"><a href="#cb141-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"All values should be &gt; 400 (red line)"</span>) <span class="sc">+</span></span>
<span id="cb141-37"><a href="#cb141-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb141-38"><a href="#cb141-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-39"><a href="#cb141-39" aria-hidden="true" tabindex="-1"></a>p_rhat <span class="sc">+</span> p_ess</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="state-space-comparison_files/figure-html/rhat-ess-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Convergence diagnostics: Rhat should be &lt; 1.01, ESS should be &gt; 400</figcaption>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== CONVERGENCE SUMMARY ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== CONVERGENCE SUMMARY ===</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Total parameters checked: %d</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">nrow</span>(param_summary)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Total parameters checked: 52</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Max Rhat: %.4f</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">max</span>(param_summary<span class="sc">$</span>rhat, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Max Rhat: 1.0051</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Min ESS: %.0f</span><span class="sc">\n</span><span class="st">"</span>, <span class="fu">min</span>(param_summary<span class="sc">$</span>ess_bulk, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Min ESS: 562</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary of worst parameters</span></span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Parameters with Rhat &gt; 1.01 ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Parameters with Rhat &gt; 1.01 ===</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>bad_rhat <span class="ot">&lt;-</span> param_summary[param_summary<span class="sc">$</span>rhat <span class="sc">&gt;</span> <span class="fl">1.01</span>, ]</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(bad_rhat) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb152-3"><a href="#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(bad_rhat[, <span class="fu">c</span>(<span class="st">"variable"</span>, <span class="st">"rhat"</span>, <span class="st">"ess_bulk"</span>)])</span>
<span id="cb152-4"><a href="#cb152-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb152-5"><a href="#cb152-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"None - all parameters have Rhat &lt; 1.01 ✓</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb152-6"><a href="#cb152-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>None - all parameters have Rhat &lt; 1.01 ✓</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">=== Parameters with ESS &lt; 400 ===</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
=== Parameters with ESS &lt; 400 ===</code></pre>
</div>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>low_ess <span class="ot">&lt;-</span> param_summary[param_summary<span class="sc">$</span>ess_bulk <span class="sc">&lt;</span> <span class="dv">400</span>, ]</span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">nrow</span>(low_ess) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(low_ess[, <span class="fu">c</span>(<span class="st">"variable"</span>, <span class="st">"mean"</span>, <span class="st">"rhat"</span>, <span class="st">"ess_bulk"</span>)])</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"None - all parameters have ESS &gt; 400 ✓</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>None - all parameters have ESS &gt; 400 ✓</code></pre>
</div>
</div>
</section>
<section id="posterior-predictive-check" class="level3">
<h3 class="anchored" data-anchor-id="posterior-predictive-check">Posterior Predictive Check</h3>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>ppc_data <span class="ot">&lt;-</span> <span class="fu">extract_ppc_data</span>(result)</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample a few education levels for clarity</span></span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>sample_edu <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"phd"</span>, <span class="st">"bachelors"</span>, <span class="st">"less_than_hs"</span>)</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>ppc_sample <span class="ot">&lt;-</span> ppc_data[ppc_data<span class="sc">$</span>education <span class="sc">%in%</span> sample_edu, ]</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-7"><a href="#cb158-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ppc_sample, <span class="fu">aes</span>(<span class="at">x =</span> year_frac)) <span class="sc">+</span></span>
<span id="cb158-8"><a href="#cb158-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> predicted_rate_lower <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb158-9"><a href="#cb158-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymax =</span> predicted_rate_upper <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb158-10"><a href="#cb158-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">"steelblue"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb158-11"><a href="#cb158-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted_rate <span class="sc">*</span> <span class="dv">100</span>), <span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb158-12"><a href="#cb158-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> observed_rate <span class="sc">*</span> <span class="dv">100</span>), <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb158-13"><a href="#cb158-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>education, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb158-14"><a href="#cb158-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2000</span>, <span class="dv">2025</span>, <span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb158-15"><a href="#cb158-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Year"</span>,</span>
<span id="cb158-16"><a href="#cb158-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Unemployment Rate (%)"</span>,</span>
<span id="cb158-17"><a href="#cb158-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Posterior Predictive Check"</span>,</span>
<span id="cb158-18"><a href="#cb158-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Points: observed; Line: predicted mean; Band: 95% prediction interval"</span>) <span class="sc">+</span></span>
<span id="cb158-19"><a href="#cb158-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="state-space-comparison_files/figure-html/ppc-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Posterior predictive check: observed vs replicated data</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="model-fit-assessment-loo-cv" class="level2">
<h2 class="anchored" data-anchor-id="model-fit-assessment-loo-cv">Model Fit Assessment (LOO-CV)</h2>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute LOO for model fit assessment</span></span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>loo_ss <span class="ot">&lt;-</span> <span class="fu">compute_loo</span>(result)</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(loo_ss)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Computed from 6000 by 2170 log-likelihood matrix.

         Estimate    SE
elpd_loo  -8843.2 109.1
p_loo       315.7  54.8
looic     17686.4 218.2
------
MCSE of elpd_loo is NA.
MCSE and ESS estimates assume independent draws (r_eff=1).

Pareto k diagnostic values:
                         Count Pct.    Min. ESS
(-Inf, 0.7]   (good)     2146  98.9%   617     
   (0.7, 1]   (bad)        15   0.7%   &lt;NA&gt;    
   (1, Inf)   (very bad)    9   0.4%   &lt;NA&gt;    
See help('pareto-k-diagnostic') for details.</code></pre>
</div>
</div>
<p>The LOO (leave-one-out cross-validation) estimate provides an assessment of out-of-sample predictive accuracy. Lower ELPD (expected log pointwise predictive density) indicates worse fit, so we want to maximize ELPD or minimize -2*ELPD.</p>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>This hierarchical ODE state space model successfully models unemployment dynamics across education levels with proper identification of shock effects and labor market parameters.</p>
<section id="model-quality" class="level3">
<h3 class="anchored" data-anchor-id="model-quality">Model Quality</h3>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Diagnostic</th>
<th>Requirement</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Divergences</td>
<td>0</td>
<td>✓</td>
</tr>
<tr class="even">
<td>Max treedepth</td>
<td>0</td>
<td>✓</td>
</tr>
<tr class="odd">
<td>E-BFMI</td>
<td>&gt; 0.7</td>
<td>✓</td>
</tr>
<tr class="even">
<td>Chains</td>
<td>4/4</td>
<td>✓</td>
</tr>
<tr class="odd">
<td>All Rhat</td>
<td>&lt; 1.01</td>
<td>✓</td>
</tr>
<tr class="even">
<td>All ESS</td>
<td>&gt; 400</td>
<td>✓</td>
</tr>
</tbody>
</table>
</section>
<section id="key-findings" class="level3">
<h3 class="anchored" data-anchor-id="key-findings">Key Findings</h3>
<ol type="1">
<li><p><strong>Shock effects are positive and identifiable</strong> - Both 2008 and 2020 crises show clear positive effects on job separation rates</p></li>
<li><p><strong>Hierarchical pooling strengthens inference</strong> - Population-level means inform education-specific estimates while allowing heterogeneity:</p>
<ul>
<li>Equilibrium unemployment: PhD ~1.5%, Less than HS ~7-8%</li>
<li>Adjustment speeds: Range from 2-30, with substantial education variation</li>
<li>Shock magnitudes: Pooled across education with appropriate between-group variation</li>
<li>Recovery rates: Hierarchical decay parameters prevent overfitting</li>
</ul></li>
<li><p><strong>Economic parameters are interpretable</strong> - Separation rates (~0.1-0.4/month), finding rates (2-30/month) reflect actual labor market dynamics scaled by logit geometry</p></li>
<li><p><strong>Shock magnitude estimates are credible</strong>:</p>
<ul>
<li>2008 financial crisis: ~14-47% increase in separation rate across education levels</li>
<li>2020 COVID-19: ~27-107% increase in separation rate (massive shock!)</li>
</ul></li>
<li><p><strong>Recovery dynamics vary by education</strong> - Hierarchical decay parameters capture different recovery speeds while borrowing strength across groups</p></li>
</ol>
</section>
<section id="technical-success" class="level3">
<h3 class="anchored" data-anchor-id="technical-success">Technical Success</h3>
<p>Perfect convergence (Rhat &lt; 1.01, ESS &gt; 400, 0 divergences) achieved through: - <strong>Hierarchical structure</strong> - Including decay rates solved identification issues for some education levels - <strong>Non-centered parameterization</strong> - Efficient sampling for all hierarchical parameters - <strong>Data-informed priors</strong> - Priors centered near posterior modes from exploratory fits - <strong>Prior-centered initialization</strong> - <code>make_init_at_prior()</code> avoids multimodal traps</p>
<div class="cell">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sessionInfo</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.2 (2023-10-31)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 22.04.3 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 
LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

time zone: Etc/UTC
tzcode source: system (glibc)

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] patchwork_1.3.2       phdunemployment_0.1.0 testthat_3.2.3       
 [4] scales_1.4.0          here_1.0.1            loo_2.8.0.9000       
 [7] bayesplot_1.14.0.9000 cmdstanr_0.8.0        ggplot2_4.0.0        
[10] data.table_1.18.0    

loaded via a namespace (and not attached):
  [1] ipumsr_0.9.0           remotes_2.5.0          rlang_1.1.6           
  [4] magrittr_2.0.4         matrixStats_1.5.0      compiler_4.3.2        
  [7] mgcv_1.9-0             reshape2_1.4.4         callr_3.7.6           
 [10] vctrs_0.6.5            stringr_1.5.2          pkgconfig_2.0.3       
 [13] fastmap_1.1.1          backports_1.5.0        gratia_0.11.1         
 [16] ellipsis_0.3.2         labeling_0.4.3         utf8_1.2.6            
 [19] rmarkdown_2.30         sessioninfo_1.2.3      tzdb_0.4.0            
 [22] haven_2.5.4            ps_1.9.1               purrr_1.1.0           
 [25] xfun_0.41              cachem_1.0.8           jsonlite_1.8.8        
 [28] later_1.3.2            tarchetypes_0.13.2     prettyunits_1.2.0     
 [31] parallel_4.3.2         R6_2.6.1               stringi_1.8.7         
 [34] RColorBrewer_1.1-3     qs_0.27.3              pkgload_1.4.1         
 [37] brio_1.1.4             lubridate_1.9.3        Rcpp_1.1.0            
 [40] knitr_1.45             usethis_3.2.1          readr_2.1.5           
 [43] mvnfast_0.2.8          igraph_2.0.1           Matrix_1.6-1.1        
 [46] splines_4.3.2          timechange_0.3.0       tidyselect_1.2.1      
 [49] rstudioapi_0.15.0      dichromat_2.0-0.1      abind_1.4-8           
 [52] yaml_2.3.12            targets_1.11.4         stringfish_0.17.0     
 [55] codetools_0.2-19       processx_3.8.6         pkgbuild_1.4.8        
 [58] plyr_1.8.9             lattice_0.21-9         tibble_3.3.0          
 [61] withr_3.0.2            bridgesampling_1.1-2   S7_0.2.0              
 [64] posterior_1.6.1        coda_0.19-4.1          evaluate_1.0.5        
 [67] marginaleffects_0.31.0 desc_1.4.3             RcppParallel_5.1.11-1 
 [70] pillar_1.11.1          fstcore_0.9.18         tensorA_0.36.2.1      
 [73] checkmate_2.3.3        distributional_0.5.0   generics_0.1.4        
 [76] rprojroot_2.1.1        hms_1.1.3              rstantools_2.5.0.9000 
 [79] mirai_2.5.3            RApiSerialize_0.1.4    base64url_1.4         
 [82] glue_1.8.0             tools_4.3.2            forcats_1.0.0         
 [85] fs_1.6.6               mvtnorm_1.3-3          grid_4.3.2            
 [88] ggokabeito_0.1.0       tidyr_1.3.1            quarto_1.5.1          
 [91] devtools_2.4.6         nlme_3.1-163           cli_3.6.5             
 [94] fst_0.9.8              Brobdingnag_1.2-9      dplyr_1.1.4           
 [97] gtable_0.3.6           tweedie_2.3.5          zeallot_0.2.0         
[100] digest_0.6.37          nanonext_1.7.2         brms_2.23.1           
[103] htmlwidgets_1.6.4      farver_2.1.2           memoise_2.0.1         
[106] htmltools_0.5.7        lifecycle_1.0.4        secretbase_1.1.0      </code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>